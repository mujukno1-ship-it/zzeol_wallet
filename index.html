<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ì©”ì–´ì§€ê°‘ v6.4 PRO</title>
<style>
:root{
  --bg:#0b1218;--panel:#0e1722;--line:#1f2a37;--txt:#e5e7eb;--sub:#9aa4b2;
  --up:#2dd4bf;--down:#fb7185;--warn:#f59e0b;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--txt);font:14px/1.4 "ë§‘ì€ ê³ ë”•",sans-serif}
.wrap{max-width:1200px;margin:25px auto;padding:0 15px}
.panel{background:var(--panel);border:1px solid var(--line);border-radius:10px;margin-bottom:15px}
.hdr{display:flex;justify-content:space-between;align-items:center;padding:12px 16px}
.badge{padding:4px 8px;border-radius:8px;background:#132033;font-weight:700;font-size:12px}
.badge.online{background:#0d2b1c;color:#7be6b0}
.clock{color:var(--sub)}
.btn{background:#0d2236;color:#b9d1ff;border:1px solid #213247;border-radius:8px;padding:8px 12px;cursor:pointer}
.btn:hover{filter:brightness(1.1)}
.searchbar{display:flex;gap:8px;margin-bottom:12px}
.searchbar input{flex:1;padding:10px 12px;border:1px solid var(--line);border-radius:8px;background:#0b131d;color:var(--txt)}
.one-line{display:grid;grid-template-columns:150px repeat(7,1fr);gap:8px}
.cell{background:#0b131d;border:1px solid var(--line);border-radius:8px;padding:10px;text-align:center}
.tbl-wrap{max-height:420px;overflow:auto;border:1px solid var(--line);border-radius:10px}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid var(--line)}
th{background:#0e1722;position:sticky;top:0}
.pill{padding:2px 6px;border-radius:8px;font-weight:700}
.pill.up{color:var(--up);border:1px solid var(--up)}
.pill.down{color:var(--down);border:1px solid var(--down)}
.pill.warn{color:var(--warn);border:1px solid var(--warn)}
.muted{color:var(--sub)}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel hdr">
    <div><span class="badge">ì©”ì–´ì§€ê°‘ v6.4 PRO</span> <span id="net" class="badge">OFFLINE</span></div>
    <div class="clock" id="clock"></div>
  </div>

  <div class="searchbar">
    <input id="q" placeholder="ì½”ì¸ ê²€ìƒ‰ (ì˜ˆ: ë¹„íŠ¸ì½”ì¸ / ETH / KRW-ETH)" />
    <button class="btn" id="btnSearch">ê²€ìƒ‰</button>
    <button class="btn" id="btnReset">ì´ˆê¸°í™”</button>
  </div>

  <div class="panel">
    <div class="one-line muted" style="margin-bottom:6px">
      <div class="cell">ì½”ì¸ëª…</div><div class="cell">í˜„ì¬ê°€</div><div class="cell">ë³€ë™ë¥ </div>
      <div class="cell">ë§¤ìˆ˜</div><div class="cell">ë§¤ë„</div><div class="cell">ì†ì ˆ</div>
      <div class="cell">ìœ„í—˜ë„</div><div class="cell">ì©”ì–´í•œë§ˆë””</div>
    </div>
    <div class="one-line" id="selectedRow">
      <div class="cell" colspan="8">ì—†ìŒ</div>
    </div>
  </div>

  <div class="panel">
    <h3 style="padding:10px 15px 0 15px;margin:0">ğŸ”¥ ê¸‰ë“±ì½”ì¸ Top10</h3>
    <div class="tbl-wrap"><table><thead>
      <tr><th>#</th><th>ì½”ì¸ëª…</th><th>í˜„ì¬ê°€</th><th>ë³€ë™ë¥ </th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th></tr>
    </thead><tbody id="tblUp"></tbody></table></div>
  </div>

  <div class="panel">
    <h3 style="padding:10px 15px 0 15px;margin:0">ğŸ’§ ê¸‰ë½ì½”ì¸ Top10</h3>
    <div class="tbl-wrap"><table><thead>
      <tr><th>#</th><th>ì½”ì¸ëª…</th><th>í˜„ì¬ê°€</th><th>ë³€ë™ë¥ </th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th></tr>
    </thead><tbody id="tblDown"></tbody></table></div>
  </div>
</div>

<script>
const API=(p)=>`/api/upbit?path=${encodeURIComponent(p)}`;
const state={online:false,markets:[],tickers:[],nameMap:{}};
const $=(s)=>document.querySelector(s);
function fmt(n){return isNaN(n)?'â€”':(+n).toLocaleString('ko-KR')}
function priceUnit(p){if(p>2e6)return 1000;if(p>1e6)return 500;if(p>5e5)return 100;if(p>1e5)return 50;if(p>1e4)return 10;if(p>1e3)return 1;if(p>100)return 0.1;if(p>10)return 0.01;if(p>1)return 0.001;if(p>0.1)return 0.0001;return 0.00001;}
function rateSpan(r){if(!r)return 'â€”';let c=r>0?'up':'down';return `<span class="pill ${c}">${(r*100).toFixed(2)}%</span>`}
function riskLabelByRate(r){if(r==null)return'â€”';r=Math.abs(r*100);if(r>=10)return'3(ì£¼ì˜)';if(r>=5)return'2(ë³´í†µ)';return'1(ì•ˆì •)'}
function msgByRate(r){if(r>=0.08)return'ğŸš€ í­ë“±';if(r>=0.04)return'ğŸ”¥ ë¶ˆì¥';if(r<=-0.08)return'âš ï¸ ê¸‰ë½';return'ğŸ‘€ ê´€ë§';}

async function loadMarkets(){
 const r=await fetch(API('/v1/market/all?isDetails=true'));
 const d=await r.json();
 state.markets=d.filter(x=>x.market.startsWith('KRW-'));
 state.nameMap=Object.fromEntries(state.markets.map(m=>[m.market.split('-')[1],m.korean_name]));
}
async function loadTickers(){
 const mk=state.markets.map(m=>m.market);
 const r=await fetch(API('/v1/ticker?markets='+mk.slice(0,100).join(',')));
 const d=await r.json();
 state.tickers=d;state.online=true;
}

function renderSelected(tk){
 const row=$('#selectedRow');
 if(!tk){row.innerHTML='<div class="cell">ì—†ìŒ</div>';return;}
 const p=tk.trade_price, r=tk.signed_change_rate;
 const u=priceUnit(p), adj=1+Math.min(0.1,Math.abs(r));
 const buy=p-2*u*adj, sell=p+2*u*adj, stop=p-5*u*adj;
 row.innerHTML=`<div class="cell"><b>${state.nameMap[tk.market.split('-')[1]]}</b></div>
 <div class="cell">${fmt(p)}</div>
 <div class="cell">${rateSpan(r)}</div>
 <div class="cell">${fmt(buy)}</div>
 <div class="cell">${fmt(sell)}</div>
 <div class="cell">${fmt(stop)}</div>
 <div class="cell">${riskLabelByRate(r)}</div>
 <div class="cell">${msgByRate(r)}</div>`;
}

function renderTables(){
 const up=$('#tblUp'),dn=$('#tblDown');
 up.innerHTML='';dn.innerHTML='';
 const arr=state.tickers.map(t=>({...t,ko:state.nameMap[t.market.split('-')[1]]}));
 const ups=arr.filter(t=>t.signed_change_rate>0).sort((a,b)=>b.signed_change_rate-a.signed_change_rate).slice(0,10);
 const dns=arr.filter(t=>t.signed_change_rate<0).sort((a,b)=>a.signed_change_rate-b.signed_change_rate).slice(0,10);
 function rowHTML(t,i){const p=t.trade_price,r=t.signed_change_rate,u=priceUnit(p),adj=1+Math.min(0.1,Math.abs(r));
  const buy=p-2*u*adj,sell=p+2*u*adj,stop=p-5*u*adj;
  return `<tr onclick="renderSelected(state.tickers.find(x=>x.market==='${t.market}'))">
  <td>${i+1}</td><td>${t.ko}</td><td>${fmt(p)}</td><td>${rateSpan(r)}</td>
  <td>${fmt(buy)}</td><td>${fmt(sell)}</td><td>${fmt(stop)}</td>
  <td>${riskLabelByRate(r)}</td><td>${msgByRate(r)}</td></tr>`;}
 ups.forEach((t,i)=>up.insertAdjacentHTML('beforeend',rowHTML(t,i)));
 dns.forEach((t,i)=>dn.insertAdjacentHTML('beforeend',rowHTML(t,i)));
}

async function loop(){try{
  if(!state.markets.length)await loadMarkets();
  await loadTickers();renderTables();
}catch(e){state.online=false}finally{setTimeout(loop,4000)}}
loop();
setInterval(()=>{const n=new Date();$('#clock').textContent=n.toLocaleTimeString('ko-KR')},1000);
</script>
</body>
</html>
