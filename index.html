<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì©”ì–´ì§€ê°‘ v5.3 âš¡</title>
  <style>
    body { background:#0d1117; color:#e6edf3; font-family: 'Pretendard', sans-serif; text-align:center; }
    h1 { color:#00e6b8; margin:20px; }
    table { width:90%; margin:0 auto; border-collapse:collapse; }
    th,td { padding:10px; border-bottom:1px solid #2d333b; }
    th { color:#58a6ff; }
    tr:hover { background:#161b22; }
    .status { font-weight:bold; color:#0f0; margin:10px; }
  </style>
</head>
<body>
  <h1>ì©”ì–´ì§€ê°‘ v5.3 âš¡ <span class="status">OFFLINE</span></h1>
  <input id="search" placeholder="ì½”ì¸ ê²€ìƒ‰ (ì˜ˆ: ì´ë”ë¦¬ì›€ / ETH / KRW-ETH)" style="width:60%;padding:10px;font-size:16px;">
  <button onclick="searchCoin()">ê²€ìƒ‰</button>
  <button onclick="init()">ì´ˆê¸°í™”</button>

  <h2>ğŸ”¥ ê¸‰ë“±ì½”ì¸ ì‹¤ì‹œê°„ í”¼ë“œ (5%â†‘, 10ì–µâ†‘)</h2>
  <table>
    <thead>
      <tr>
        <th>ì½”ì¸ëª…(í•œê¸€)</th><th>í˜„ì¬ê°€</th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th>
      </tr>
    </thead>
    <tbody id="feed"></tbody>
  </table>

  <script>
    const FEED = document.getElementById('feed');
    const STATUS = document.querySelector('.status');
    const PROXY = "https://corsproxy.io/?";
    const UPBIT_TICKERS = "https://api.upbit.com/v1/ticker?markets=";
    const UPBIT_MARKET_ALL = PROXY + "https://api.upbit.com/v1/market/all";

    // --- í•œê¸€ëª… ë§¤í•‘ ---
    let nameMap = {};

    async function loadMarkets() {
      try {
        const res = await fetch(UPBIT_MARKET_ALL);
        const data = await res.json();
        data.filter(x=>x.market.startsWith("KRW-")).forEach(x=>{
          nameMap[x.market] = x.korean_name;
        });
        STATUS.textContent = "ONLINE";
        STATUS.style.color = "#00ff90";
        return Object.keys(nameMap);
      } catch {
        STATUS.textContent = "OFFLINE (ì¬ì‹œë„ì¤‘)";
        STATUS.style.color = "red";
        return [];
      }
    }

    async function loadTickers() {
      const markets = await loadMarkets();
      if (!markets.length) return;
      const res = await fetch(PROXY + UPBIT_TICKERS + markets.join(","));
      const data = await res.json();
      FEED.innerHTML = "";

      data.filter(t=>t.acc_trade_price_24h > 1000000000 && t.signed_change_rate > 0.05)
          .sort((a,b)=>b.signed_change_rate - a.signed_change_rate)
          .forEach(t=>{
            const name = nameMap[t.market] || t.market;
            const change = (t.signed_change_rate*100).toFixed(2);
            const row = `
              <tr>
                <td>${name}</td>
                <td>${t.trade_price.toLocaleString()}ì›</td>
                <td>${(t.trade_price*0.99).toLocaleString()}</td>
                <td>${(t.trade_price*1.01).toLocaleString()}</td>
                <td>${(t.trade_price*0.97).toLocaleString()}</td>
                <td>${change}%</td>
                <td>${change>10?"ğŸš€ í­ë“± ëª¨ë“œ!":"ğŸ”¥ ì˜ˆì—´ì¤‘"}</td>
              </tr>`;
            FEED.insertAdjacentHTML('beforeend', row);
          });
    }

    async function searchCoin() {
      const query = document.getElementById('search').value.toUpperCase();
      if (!query) return;
      const res = await fetch(PROXY + "https://api.upbit.com/v1/ticker?markets=KRW-" + query);
      const data = await res.json();
      FEED.innerHTML = `
        <tr>
          <td>${query}</td>
          <td>${data[0].trade_price.toLocaleString()}ì›</td>
          <td>${(data[0].trade_price*0.99).toLocaleString()}</td>
          <td>${(data[0].trade_price*1.01).toLocaleString()}</td>
          <td>${(data[0].trade_price*0.97).toLocaleString()}</td>
          <td>${(data[0].signed_change_rate*100).toFixed(2)}%</td>
          <td>${data[0].signed_change_rate>0?"ìƒìŠ¹ íë¦„":"í•˜ë½ ì£¼ì˜"}</td>
        </tr>`;
    }

    function init() { FEED.innerHTML = ""; document.getElementById('search').value = ""; }

    setInterval(loadTickers, 15000); // 15ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸
    loadTickers(); // ì²« ë¡œë“œ
  </script>
</body>
</html>
