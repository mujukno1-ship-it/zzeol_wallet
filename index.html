<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì©”ì–´ì§€ê°‘ v4.9 â€” ì‹¤ì‹œê°„ + ê¸‰ë“± í”¼ë“œ(ì•ˆì •/í•œê¸€)</title>
  <!-- íŒŒë¹„ì½˜ 404 ë°©ì§€ -->
  <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
  <style>
    :root{--bg:#0d1117;--panel:#161b22;--line:#2d333b;--text:#e6edf3;--muted:#9fb1c1;--up:#16c784;--down:#ea3943;--chip:#223045}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Apple SD Gothic Neo}
    .wrap{max-width:1150px;margin:24px auto;padding:0 16px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    h1{margin:0;font-size:18px;display:flex;gap:8px;align-items:center}
    .badge{background:var(--chip);border:1px solid #283752;color:var(--muted);padding:4px 8px;border-radius:999px;font-size:12px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 2px 10px rgba(0,0,0,.25);margin-top:12px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    input,button{background:#0e141b;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px}
    input{flex:1;min-width:260px}
    button{cursor:pointer} button:hover{background:#1a2330}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid var(--line);text-align:center}
    .price{font-weight:800;font-size:28px}
    .diff.up{color:var(--up)} .diff.down{color:var(--down)} .muted{color:var(--muted)}
    @keyframes flash{0%{background:rgba(255,255,0,.18)}100%{background:transparent}}
    .flash{animation:flash 1s ease-out 1}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ì©”ì–´ì§€ê°‘ <span class="badge">v4.9</span> <span class="badge" id="net">OFFLINE</span></h1>
      <div class="badge" id="clock">KST â€” --:--:--</div>
    </header>

    <!-- ê²€ìƒ‰ -->
    <div class="card">
      <div class="row">
        <input id="q" placeholder="ì½”ì¸ ê²€ìƒ‰ (ì˜ˆ: ì´ë”ë¦¬ì›€ / ETH / KRW-ETH)" autocomplete="off" />
        <button id="btnSearch">ê²€ìƒ‰</button>
        <button id="btnClear">ì´ˆê¸°í™”</button>
      </div>
      <div id="searchError" class="muted" style="color:#ff6b6b;display:none;margin-top:6px"></div>
    </div>

    <!-- ì„ íƒ ì½”ì¸ (WebSocket ì‹¤ì‹œê°„) -->
    <div class="card" id="result" style="display:none">
      <div class="row" style="justify-content:space-between;align-items:end">
        <div>
          <div style="font-weight:700;font-size:18px">ì„ íƒëœ ì½”ì¸: <span id="selName" class="muted">-</span></div>
          <div id="selMarket" class="badge" style="margin-top:6px">â€”</div>
        </div>
        <div style="text-align:right">
          <div id="nowPrice" class="price">â€”</div>
          <div id="nowChange" class="diff">â€”</div>
        </div>
      </div>
      <table style="margin-top:10px">
        <thead>
          <tr class="muted"><th>í˜„ì¬ê°€</th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th><th class="muted">ì—°ê²°</th></tr>
        </thead>
        <tbody>
          <tr>
            <td id="c_price">â€”</td>
            <td id="c_buy">â€”</td>
            <td id="c_sell">â€”</td>
            <td id="c_stop">â€”</td>
            <td id="c_risk">â€”</td>
            <td id="c_comment">â€”</td>
            <td id="wsState" class="muted">â€”</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- ğŸ”¥ ê¸‰ë“± í”¼ë“œ -->
    <div class="card" id="hotCard">
      <div class="row" style="justify-content:space-between">
        <h3 style="margin:0">ğŸ”¥ ê¸‰ë“±ì½”ì¸ ì‹¤ì‹œê°„ í”¼ë“œ (5%â†‘, 10ì–µâ†‘)</h3>
        <button id="btnFeedClear">í”¼ë“œ ë¹„ìš°ê¸°</button>
      </div>
      <table>
        <thead>
          <tr class="muted"><th>ì½”ì¸ëª…(í•œê¸€)</th><th>í˜„ì¬ê°€</th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th></tr>
        </thead>
        <tbody id="hotFeed"></tbody>
      </table>
      <div class="muted" style="font-size:12px;margin-top:6px">â€» ìƒˆë¡œ ê°ì§€ë˜ë©´ í•­ìƒ ë§¨ ìœ„ë¡œ ì´ë™. (ìµœëŒ€ 100ê°œ, 24ì‹œê°„ ë³´ê´€)</div>
    </div>
  </div>

  <!-- ìŠ¤í¬ë¦½íŠ¸: DOM ìƒì„± ì´í›„ ì‹¤í–‰ -->
  <script>
    const $=id=>document.getElementById(id);

    /* ===== ì‹œê³„/ì˜¨ë¼ì¸ ===== */
    function tick(){
      const clock=$('clock'), net=$('net'); if(!clock||!net) return;
      const now=new Date(), utc=now.getTime()+now.getTimezoneOffset()*60000, kst=new Date(utc+9*3600000);
      clock.textContent='KST â€” '+kst.toLocaleTimeString('ko-KR',{hour12:false});
      const on=navigator.onLine; net.textContent=on?'ONLINE':'OFFLINE'; net.style.background=on?'#123922':'#3a1a1a';
    }

    /* ===== í˜¸ê°€ë‹¨ìœ„/í¬ë§· ===== */
    function getTick(p){if(p>=2e6)return 1e3;if(p>=1e6)return 500;if(p>=5e5)return 100;if(p>=1e5)return 50;if(p>=1e4)return 10;if(p>=1e3)return 5;if(p>=100)return 1;if(p>=10)return .1;if(p>=1)return .01;if(p>=.1)return .001;if(p>=.01)return .0001;if(p>=.001)return .00001;if(p>=.0001)return .000001;if(p>=.00001)return .0000001;if(p>=.000001)return .00000001;return .000000001;}
    function fmtKRW(x){const t=getTick(x),d=(t.toString().split('.')[1]||'').length,r=Math.round(x/t)*t;return r.toLocaleString('ko-KR',{minimumFractionDigits:d,maximumFractionDigits:d});}
    const riskText=r=>{const v=Math.abs(r*100);return v<1?'1(ì•ˆì •)':v<3?'2(ë³´í†µ)':'3(ì£¼ì˜)';};
    const zzeolComment=r=>r>0.08?'ğŸš€ í­ë“± ëª¨ë“œ!':r>0.05?'ğŸ”¥ ë¶ˆì¥ ì‹ í˜¸!':r>0.02?'ğŸ“ˆ ìƒìŠ¹ íƒ„ë ¥':r>-0.02?'âš–ï¸ ê´€ë§':'ğŸ’€ í•˜ë½ ë¦¬ìŠ¤í¬';

    /* ===== ë„¤íŠ¸ì›Œí¬ ìœ í‹¸(ì¬ì‹œë„/íƒ€ì„ì•„ì›ƒ) ===== */
    async function fetchJSON(url,{timeout=7000,retries=2,backoff=500}={}){
      for(let i=0;i<=retries;i++){
        const ctrl=new AbortController();const t=setTimeout(()=>ctrl.abort(),timeout);
        try{
          const res=await fetch(url,{signal:ctrl.signal,cache:'no-store'});
          if(!res.ok) throw new Error('HTTP '+res.status);
          return await res.json();
        }catch(e){
          if(i===retries) throw e;
          await new Promise(r=>setTimeout(r, backoff*Math.pow(2,i)));
        }finally{ clearTimeout(t); }
      }
    }

    /* ===== ë§ˆì¼“ & í•œê¸€ëª… ë§µ ===== */
    let MARKETS=[]; const NAME_KO=new Map(); const SYM=m=>m.replace('KRW-','');
    async function ensureMarkets(){
      if(MARKETS.length) return MARKETS;
      const all=await fetchJSON('https://api.upbit.com/v1/market/all?isDetails=false');
      MARKETS=all.filter(x=>x.market.startsWith('KRW-'));
      for(const m of MARKETS) NAME_KO.set(m.market, m.korean_name || SYM(m.market));
      return MARKETS;
    }

    /* ===== ê²€ìƒ‰ + WebSocket ì‹¤ì‹œê°„ ===== */
    let ws=null, wsTimer=null, wsHB=null, wsBackoff=1000;
    function wsState(s){ const el=$('wsState'); if(el) el.textContent=s; }
    function openWS(market){
      if(ws){try{ws.close();}catch{} ws=null;} if(wsTimer){clearTimeout(wsTimer);} if(wsHB){clearInterval(wsHB);}
      wsState('ì—°ê²°ì¤‘â€¦'); const url='wss://api.upbit.com/websocket/v1'; ws=new WebSocket(url); ws.binaryType='arraybuffer';
      ws.onopen=()=>{ ws.send(JSON.stringify([{ticket:'zzeol'},{type:'ticker',codes:[market],isOnlyRealtime:true}])); wsState('ì—°ê²°ë¨'); wsBackoff=1000; wsHB=setInterval(()=>{try{ws.send(JSON.stringify([{ticket:'ping'}]));}catch{}},15000); };
      ws.onmessage=ev=>{ const txt=new TextDecoder('utf-8').decode(new Uint8Array(ev.data)); let t; try{t=JSON.parse(txt);}catch{return;} if((t.type||t.ty)!=='ticker') return;
        const price=t.trade_price??t.tp, rate=(t.signed_change_rate??t.scr)??0, change=(t.change??t.c)||'EVEN';
        $('nowPrice').textContent=fmtKRW(price)+' ì›'; $('nowChange').className='diff '+(change==='RISE'?'up':change==='FALL'?'down':''); $('nowChange').textContent=`${change==='RISE'?'+':''}${(rate*100).toFixed(2)}%`;
        $('c_price').textContent=fmtKRW(price); $('c_buy').textContent=fmtKRW(price*0.988); $('c_sell').textContent=fmtKRW(price*1.012); $('c_stop').textContent=fmtKRW(price*0.975); $('c_risk').textContent=riskText(rate); $('c_comment').textContent=zzeolComment(rate);
      };
      ws.onclose=()=>{ wsState('ì¬ì—°ê²° ëŒ€ê¸°â€¦'); wsTimer=setTimeout(()=>openWS(market), wsBackoff); wsBackoff=Math.min(wsBackoff*2,15000); };
      ws.onerror=()=>{ try{ws.close();}catch{} };
    }
    async function doSearch(){
      const err=$('searchError'); if(err) err.style.display='none';
      const q=($('q')?.value||'').trim(); if(!q){$('q')?.focus();return;}
      try{
        const list=await ensureMarkets(); const s=q.toLowerCase();
        const exact=list.find(x=>x.korean_name.toLowerCase()===s||(x.english_name||'').toLowerCase()===s||x.market.toLowerCase()===s||SYM(x.market).toLowerCase()===s);
        const coin=exact||list.find(x=>x.korean_name.toLowerCase().includes(s)||(x.english_name||'').toLowerCase().includes(s)||x.market.toLowerCase().includes(s)||SYM(x.market).toLowerCase().includes(s));
        if(!coin){ if(err){err.textContent='ì¼ì¹˜í•˜ëŠ” ì½”ì¸ì„ ëª» ì°¾ì•˜ì–´. (ì˜ˆ: ì´ë”ë¦¬ì›€ / ETH / KRW-ETH)'; err.style.display='block';} return; }
        $('result').style.display='block'; $('selName').textContent=coin.korean_name; $('selMarket').textContent=coin.market; wsState('ì—°ê²° ì¤€ë¹„â€¦'); openWS(coin.market);
      }catch(e){ console.error(e); if(err){err.textContent='ì—…ë¹„íŠ¸ ì—°ê²°ì— ë¬¸ì œê°€ ìˆì–´. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì¤˜!'; err.style.display='block';} }
    }
    $('btnSearch')?.addEventListener('click', doSearch);
    $('q')?.addEventListener('keydown', e=>{ if(e.key==='Enter') doSearch(); });
    $('btnClear')?.addEventListener('click', ()=>{ if($('q')) $('q').value=''; $('result').style.display='none'; $('searchError').style.display='none'; if(ws){try{ws.close();}catch{} ws=null;} });

    /* ===== ê¸‰ë“± í”¼ë“œ(í•œê¸€/ì €ì¥/ì¬ì •ë ¬/ë‚´êµ¬ì„±) ===== */
    const FEED_KEY='zzeol_hot_feed_v1', FEED_TTL_HOURS=24;
    const rowBySym=new Map(); let storeCache=[];
    function feedEl(){ return $('hotFeed'); }
    function loadStore(){ try{ const raw=localStorage.getItem(FEED_KEY); if(!raw) return []; const now=Date.now(); return JSON.parse(raw).filter(x=>now-x.ts<FEED_TTL_HOURS*3600*1000).slice(0,100);}catch{return [];} }
    function saveStore(items){ try{ localStorage.setItem(FEED_KEY, JSON.stringify(items.slice(0,100))); }catch(e){ console.warn('feed save failed',e); } }
    function renderFeed(items){
      const el=feedEl(); if(!el) return; el.innerHTML=''; rowBySym.clear();
      for(const it of items){
        const tr=document.createElement('tr'); tr.style.textAlign='center';
        tr.innerHTML=`<td>ğŸ’¥ ${it.nameKo||it.sym}</td><td>${it.price}</td><td>${it.buy}</td><td>${it.sell}</td><td>${it.stop}</td><td>${it.risk}</td><td>${it.comment}</td>`;
        el.appendChild(tr); rowBySym.set(it.sym,tr);
      }
      storeCache=items;
    }
    $('btnFeedClear')?.addEventListener('click', ()=>{ localStorage.removeItem(FEED_KEY); renderFeed([]); alert('ê¸‰ë“± í”¼ë“œë¥¼ ë¹„ì› ìŠµë‹ˆë‹¤.'); });
    function upsertFront(entry){ storeCache=[entry, ...storeCache.filter(x=>x.sym!==entry.sym)]; saveStore(storeCache); }

    function chunk(a,s){const o=[];for(let i=0;i<a.length;i+=s)o.push(a.slice(i,i+s));return o;}
    async function getTickersBatch(markets){ const out=[]; for(const c of chunk(markets,60)){ const part=await fetchJSON('https://api.upbit.com/v1/ticker?markets='+c.join(','),{timeout:8000,retries:2}); out.push(...part);} return out; }

    async function loadHotOnce(){
      const list=await ensureMarkets(); const tickers=await getTickersBatch(list.map(x=>x.market));
      const hot=tickers.filter(t=>t.signed_change_rate>0.05 && t.acc_trade_price_24h>10_000_000_000).sort((a,b)=>b.signed_change_rate-a.signed_change_rate);
      const el=feedEl(); if(!el) return;

      for(const t of hot){
        const market=t.market, sym=SYM(market), nameKo=NAME_KO.get(market)||sym;
        const p=t.trade_price, rate=t.signed_change_rate;
        const entry={ts:Date.now(), sym, nameKo, price:fmtKRW(p), buy:fmtKRW(p*0.988), sell:fmtKRW(p*1.012), stop:fmtKRW(p*0.975), risk:riskText(rate), comment:zzeolComment(rate)};
        if(rowBySym.has(sym)){
          const tr=rowBySym.get(sym);
          tr.innerHTML=`<td>ğŸ’¥ ${entry.nameKo}</td><td>${entry.price}</td><td>${entry.buy}</td><td>${entry.sell}</td><td>${entry.stop}</td><td>${entry.risk}</td><td>${entry.comment}</td>`;
          tr.classList.add('flash'); el.prepend(tr); setTimeout(()=>tr.classList.remove('flash'),900); upsertFront(entry);
        }else{
          const tr=document.createElement('tr'); tr.style.textAlign='center'; tr.classList.add('flash');
          tr.innerHTML=`<td>ğŸ’¥ ${entry.nameKo}</td><td>${entry.price}</td><td>${entry.buy}</td><td>${entry.sell}</td><td>${entry.stop}</td><td>${entry.risk}</td><td>${entry.comment}</td>`;
          el.prepend(tr); setTimeout(()=>tr.classList.remove('flash'),900); rowBySym.set(sym,tr); upsertFront(entry);
        }
      }
    }

    /* ===== ë¶€íŒ… ìˆœì„œ ===== */
    window.addEventListener('DOMContentLoaded', async ()=>{
      tick(); setInterval(tick,1000);       // ì‹œê³„/ì˜¨ë¼ì¸
      await ensureMarkets();                 // í•œê¸€ëª… ë§µ ì¤€ë¹„
      const boot=loadStore(); if(boot.length) renderFeed(boot);  // ì €ì¥ ë³µì›
      await loadHotOnce(); setInterval(loadHotOnce, 60000);      // ê¸‰ë“± ê°ì§€
    });
  </script>
 
</body>
</html>


