<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì©”ì–´ì§€ê°‘ v5.5 â€” ê¸‰ë“± Top10 + ê¸‰ë½ Top10</title>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
  <style>
    :root{--bg:#0d1117;--panel:#161b22;--line:#2d333b;--text:#e6edf3;--muted:#9fb1c1;--up:#16c784;--down:#ea3943;--chip:#223045}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Apple SD Gothic Neo}
    .wrap{max-width:1150px;margin:24px auto;padding:0 16px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    h1{margin:0;font-size:18px;display:flex;gap:8px;align-items:center}
    .badge{background:var(--chip);border:1px solid #283752;color:var(--muted);padding:4px 8px;border-radius:999px;font-size:12px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 2px 10px rgba(0,0,0,.25);margin-top:12px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    input,button{background:#0e141b;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px}
    input{flex:1;min-width:260px}
    button{cursor:pointer} button:hover{background:#1a2330}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid var(--line);text-align:center}
    .muted{color:var(--muted)}
    .chg.up{color:var(--up);font-weight:700}
    .chg.down{color:var(--down);font-weight:700}
    .risk.r1{color:#88f36b}.risk.r2{color:#ffd75e}.risk.r3{color:#ff6b6b}
    .title{display:flex;align-items:center;gap:8px}
    .title .tag{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--line);background:#0e141b}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ì©”ì–´ì§€ê°‘ <span class="badge">v5.5</span> <span class="badge" id="net">OFFLINE</span></h1>
      <div class="badge" id="clock">KST â€” --:--:--</div>
    </header>

    <!-- ê²€ìƒ‰ -->
    <div class="card">
      <div class="row">
        <input id="q" placeholder="ì½”ì¸ ê²€ìƒ‰ (ì˜ˆ: ì´ë”ë¦¬ì›€ / ETH / KRW-ETH)" autocomplete="off" />
        <button id="btnSearch">ê²€ìƒ‰</button>
        <button id="btnClear">ì´ˆê¸°í™”</button>
      </div>
      <div id="searchError" class="muted" style="color:#ff6b6b;display:none;margin-top:6px"></div>
    </div>

    <!-- ì„ íƒëœ ì½”ì¸ (ê²€ìƒ‰ ê²°ê³¼) -->
    <div class="card" id="result" style="display:none">
      <div class="title"><b>ì„ íƒëœ ì½”ì¸:</b> <span id="selName">-</span> <span class="tag" id="selMarket">â€”</span></div>
      <table style="margin-top:10px">
        <thead><tr class="muted"><th>í˜„ì¬ê°€</th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ë³€ë™ë¥ </th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th></tr></thead>
        <tbody><tr>
          <td id="s_price">â€”</td><td id="s_buy">â€”</td><td id="s_sell">â€”</td><td id="s_stop">â€”</td>
          <td id="s_rate">â€”</td><td id="s_risk">â€”</td><td id="s_comment">â€”</td>
        </tr></tbody>
      </table>
    </div>

    <!-- ê¸‰ë“± Top 10 -->
    <div class="card">
      <div class="title"><b>ğŸ”¥ ê¸‰ë“±ì½”ì¸ Top 10</b> <span class="tag">5%â†‘ Â· 24h 10ì–µâ†‘</span></div>
      <table>
        <thead><tr class="muted"><th>#</th><th>ì½”ì¸ëª…(í•œê¸€)</th><th>í˜„ì¬ê°€</th><th>ë³€ë™ë¥ </th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th></tr></thead>
        <tbody id="feedUp"></tbody>
      </table>
    </div>

    <!-- ê¸‰ë½ Top 10 (ê¸‰ë“± ì•„ë˜) -->
    <div class="card">
      <div class="title"><b>ğŸ’§ ê¸‰ë½ì½”ì¸ Top 10</b> <span class="tag">-5%â†“ Â· 24h 10ì–µâ†‘</span></div>
      <table>
        <thead><tr class="muted"><th>#</th><th>ì½”ì¸ëª…(í•œê¸€)</th><th>í˜„ì¬ê°€</th><th>ë³€ë™ë¥ </th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th></tr></thead>
        <tbody id="feedDown"></tbody>
      </table>
    </div>
  </div>

  <script>
    /* ===== ìƒíƒœí‘œì‹œ & ì‹œê³„ ===== */
    const $ = id => document.getElementById(id);
    function tick(){
      const now=new Date(), utc=now.getTime()+now.getTimezoneOffset()*60000, kst=new Date(utc+9*3600000);
      $('clock').textContent = 'KST â€” '+kst.toLocaleTimeString('ko-KR',{hour12:false});
      const on=navigator.onLine; $('net').textContent=on?'ONLINE':'OFFLINE'; $('net').style.background=on?'#123922':'#3a1a1a';
    }
    setInterval(tick,1000); tick();

    /* ===== í¬ë§·/í˜¸ê°€ë‹¨ìœ„ ===== */
    function getTick(p){if(p>=2e6)return 1e3;if(p>=1e6)return 500;if(p>=5e5)return 100;if(p>=1e5)return 50;if(p>=1e4)return 10;if(p>=1e3)return 5;if(p>=100)return 1;if(p>=10)return .1;if(p>=1)return .01;if(p>=.1)return .001;if(p>=.01)return .0001;if(p>=.001)return .00001;if(p>=.0001)return .000001;if(p>=.00001)return .0000001;if(p>=.000001)return .00000001;return .000000001;}
    function fmtKRW(x){const t=getTick(x),d=(t.toString().split('.')[1]||'').length,r=Math.round(x/t)*t;return r.toLocaleString('ko-KR',{minimumFractionDigits:d,maximumFractionDigits:d});}
    const riskText=r=>{const v=Math.abs(r*100);return v<1?'1(ì•ˆì •)':v<3?'2(ë³´í†µ)':'3(ì£¼ì˜)';};
    const riskClass=r=>{const v=Math.abs(r*100);return v<1?'r1':v<3?'r2':'r3';};
    const zzeolComment=r=>r>0.1?'ğŸš€ í­ë“± ëª¨ë“œ!':r>0.05?'ğŸ”¥ ë¶ˆì¥ ì‹ í˜¸!':r>0.02?'ğŸ“ˆ ìƒìŠ¹ íƒ„ë ¥':r<-0.1?'ğŸ’£ ê¸‰ë½ ê²½ê³ ':r<-0.05?'âš ï¸ ì•½ì„¸ ì „í™˜':'âš–ï¸ ê´€ë§';

    /* ===== ì—…ë¹„íŠ¸ API (í”„ë¡ì‹œë¡œ CORS í•´ê²°) ===== */
    const PROXY = "https://corsproxy.io/?";
    const API   = "https://api.upbit.com/v1/";
    const URL_MARKET_ALL = PROXY + API + "market/all?isDetails=false";
    const URL_TICKER     = codes => PROXY + API + "ticker?markets=" + codes;

    /* ===== ë§ˆì¼“ & í•œê¸€ëª… ë§µ ===== */
    let NAME_BY_MARKET={}, NAME_BY_SYM={};
    function SYM(m){return m.replace('KRW-','');}
    async function ensureMarkets(){
      if(Object.keys(NAME_BY_MARKET).length) return;
      const res = await fetch(URL_MARKET_ALL);
      const all = await res.json();
      all.filter(x=>x.market.startsWith('KRW-')).forEach(m=>{
        NAME_BY_MARKET[m.market]=m.korean_name;
        NAME_BY_SYM[SYM(m.market)]=m.korean_name;
      });
      $('net').textContent='ONLINE';
      $('net').style.background='#123922';
    }
    const ko = (marketOrSym)=> marketOrSym.startsWith?.('KRW-') ? (NAME_BY_MARKET[marketOrSym]||marketOrSym) : (NAME_BY_SYM[marketOrSym]||marketOrSym);

    /* ===== ê²€ìƒ‰ ===== */
    async function doSearch(){
      const q = ($('q').value||'').trim(); const err=$('searchError'); if(err) err.style.display='none';
      if(!q){$('q').focus();return;}
      await ensureMarkets();
      const keys = Object.keys(NAME_BY_MARKET);
      const found = keys.find(k => k.toLowerCase()===q.toLowerCase() || SYM(k).toLowerCase()===q.toLowerCase() || (NAME_BY_MARKET[k]||'').includes(q));
      if(!found){ err.textContent='ì¼ì¹˜ ì½”ì¸ ì—†ìŒ (ì˜ˆ: ì´ë”ë¦¬ì›€ / ETH / KRW-ETH)'; err.style.display='block'; return; }
      const data = await (await fetch(URL_TICKER(found))).json();
      const t=data[0], p=t.trade_price, r=t.signed_change_rate;
      $('result').style.display='block';
      $('selName').textContent=ko(found); $('selMarket').textContent=found;
      $('s_price').textContent=fmtKRW(p); $('s_buy').textContent=fmtKRW(p*0.988); $('s_sell').textContent=fmtKRW(p*1.012);
      $('s_stop').textContent=fmtKRW(p*0.975); $('s_rate').innerHTML=`<span class="chg ${r>=0?'up':'down'}">${(r*100).toFixed(2)}%</span>`;
      $('s_risk').innerHTML=`<span class="risk ${riskClass(r)}">${riskText(r)}</span>`; $('s_comment').textContent=zzeolComment(r);
    }
    $('btnSearch').addEventListener('click', doSearch);
    $('q').addEventListener('keydown', e=>{ if(e.key==='Enter') doSearch(); });
    $('btnClear').addEventListener('click', ()=>{ $('q').value=''; $('result').style.display='none'; $('searchError').style.display='none'; });

    /* ===== ê¸‰ë“±/ê¸‰ë½ Top 10 ===== */
    async function scan(){
      try{
        await ensureMarkets();
        const markets = Object.keys(NAME_BY_MARKET);
        // ì—…ë¹„íŠ¸ëŠ” í•œë²ˆì— 60ê°œ ì œí•œ â†’ 60ê°œì”© ë‚˜ëˆ ì„œ ìš”ì²­
        const chunks=[]; for(let i=0;i<markets.length;i+=60) chunks.push(markets.slice(i,i+60));
        let tickers=[];
        for(const part of chunks){
          const j = await (await fetch(URL_TICKER(part.join(',')))).json();
          tickers = tickers.concat(j);
        }
        // ê¸‰ë“±/ê¸‰ë½ ë¶„ë¦¬
        const volMin = 10_000_000_000; // 24h ê±°ë˜ëŒ€ê¸ˆ 10ì–µâ†‘
        const ups   = tickers.filter(t=> t.signed_change_rate> 0.05 && t.acc_trade_price_24h>volMin)
                             .sort((a,b)=> b.signed_change_rate-a.signed_change_rate).slice(0,10);
        const downs = tickers.filter(t=> t.signed_change_rate<-0.05 && t.acc_trade_price_24h>volMin)
                             .sort((a,b)=> a.signed_change_rate-b.signed_change_rate).slice(0,10);
        renderList('feedUp', ups, true);
        renderList('feedDown', downs, false);
        $('net').textContent='ONLINE'; $('net').style.background='#123922';
      }catch(e){
        console.error(e);
        $('net').textContent='OFFLINE (ì¬ì‹œë„ì¤‘)'; $('net').style.background='#3a1a1a';
      }
    }

    function renderList(tbodyId, arr, isUp){
      const el=$(tbodyId); el.innerHTML='';
      arr.forEach((t,idx)=>{
        const p=t.trade_price, r=t.signed_change_rate;
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${idx+1}</td>
          <td>${ko(t.market)}</td>
          <td>${fmtKRW(p)}</td>
          <td class="chg ${r>=0?'up':'down'}">${(r*100).toFixed(2)}%</td>
          <td>${fmtKRW(p*0.988)}</td>
          <td>${fmtKRW(p*1.012)}</td>
          <td>${fmtKRW(p*0.975)}</td>
          <td class="risk ${riskClass(r)}">${riskText(r)}</td>
          <td>${zzeolComment(r)}</td>`;
        el.appendChild(row);
      });
    }

    // ë¶€íŒ… + ì£¼ê¸°ì  ìŠ¤ìº”(1ë¶„)
    (async ()=>{ await scan(); setInterval(scan, 60000); })();
  </script>
</body>
</html>
