<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì©”ì–´ì§€ê°‘ v6.0 â€” 5.5ë””ìì¸ + ì„¤ì •/ìºì‹œ/í”„ë¡ì‹œ ì—…ê·¸ë ˆì´ë“œ</title>
  <link rel="icon" href="data:;base64,iVBORw0KGgo=" />
  <style>
    :root{--bg:#0d1117;--panel:#161b22;--line:#2d333b;--text:#e6edf3;--muted:#9fb1c1;--up:#16c784;--down:#ea3943;--chip:#223045}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,Apple SD Gothic Neo}
    .wrap{max-width:1150px;margin:24px auto;padding:0 16px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
    h1{margin:0;font-size:18px;display:flex;gap:8px;align-items:center}
    .badge{background:var(--chip);border:1px solid #283752;color:var(--muted);padding:4px 8px;border-radius:999px;font-size:12px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 2px 10px rgba(0,0,0,.25);margin-top:12px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    input,button,select{background:#0e141b;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px}
    input{flex:1;min-width:240px}button{cursor:pointer}button:hover{background:#1a2330}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid var(--line);text-align:center}
    .muted{color:var(--muted)}
    .chg.up{color:var(--up);font-weight:700}.chg.down{color:var(--down);font-weight:700}
    .risk{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--line);font-weight:700}
    .r1{background:#0f2b12;color:#88f36b}.r2{background:#2b230f;color:#ffd75e}.r3{background:#2b0f0f;color:#ff6b6b}
    .title{display:flex;align-items:center;gap:8px}
    .title .tag{font-size:12px;padding:2px 8px;border-radius:999px;border:1px solid var(--line);background:#0e141b}
    .err{color:#ff6b6b;font-size:12px;margin-top:6px;display:none}
    .tip{font-size:12px;color:var(--muted);margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>ì©”ì–´ì§€ê°‘ <span class="badge">v6.0</span> <span class="badge" id="net">OFFLINE</span></h1>
      <div class="badge" id="clock">KST â€” --:--:--</div>
    </header>

    <!-- ì„¤ì • íŒ¨ë„ -->
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div class="title"><b>âš™ï¸ ì„¤ì •</b><span class="tag">ì €ì¥ë¨</span></div>
        <div class="row" style="gap:10px">
          <label>ê¸‰ë“± â‰¥ <input id="thUp" type="number" step="0.1" min="0" value="5" style="width:80px"> %</label>
          <label>ê¸‰ë½ â‰¤ <input id="thDown" type="number" step="0.1" min="0" value="5" style="width:80px"> %</label>
          <label>24h ê±°ë˜ëŒ€ê¸ˆ â‰¥ <input id="thVol" type="number" step="100" min="0" value="1000" style="width:100px"> ì–µ</label>
          <label>ê°±ì‹  ê°„ê²© <input id="refreshSec" type="number" min="10" value="60" style="width:80px"> ì´ˆ</label>
          <button id="btnSave">ì €ì¥</button>
          <button id="btnNow">ì¦‰ì‹œìŠ¤ìº”</button>
        </div>
      </div>
      <div class="tip">â€» ì˜ˆ) ê±°ë˜ëŒ€ê¸ˆ 1000ì–µ = 10,000,000,000 KRW</div>
    </div>

    <!-- ê²€ìƒ‰ -->
    <div class="card">
      <div class="row">
        <input id="q" placeholder="ì½”ì¸ ê²€ìƒ‰ (ì˜ˆ: ì´ë”ë¦¬ì›€ / ETH / KRW-ETH)" autocomplete="off" />
        <button id="btnSearch">ê²€ìƒ‰</button>
        <button id="btnClear">ì´ˆê¸°í™”</button>
      </div>
      <div id="searchError" class="err"></div>
    </div>

    <!-- ê²€ìƒ‰ ê²°ê³¼ -->
    <div class="card" id="result" style="display:none">
      <div class="title"><b>ì„ íƒëœ ì½”ì¸:</b> <span id="selName">-</span> <span class="tag" id="selMarket">â€”</span></div>
      <table style="margin-top:10px">
        <thead><tr class="muted"><th>í˜„ì¬ê°€</th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ë³€ë™ë¥ </th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th></tr></thead>
        <tbody><tr>
          <td id="s_price">â€”</td><td id="s_buy">â€”</td><td id="s_sell">â€”</td><td id="s_stop">â€”</td>
          <td id="s_rate">â€”</td><td id="s_risk">â€”</td><td id="s_comment">â€”</td>
        </tr></tbody>
      </table>
    </div>

    <!-- ê¸‰ë“± Top 10 -->
    <div class="card">
      <div class="title"><b>ğŸ”¥ ê¸‰ë“±ì½”ì¸ Top 10</b> <span class="tag" id="tagUp">ê¸°ë³¸: 5%â†‘ Â· 24h 1000ì–µâ†‘</span></div>
      <table>
        <thead><tr class="muted"><th>#</th><th>ì½”ì¸ëª…(í•œê¸€)</th><th>í˜„ì¬ê°€</th><th>ë³€ë™ë¥ </th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th></tr></thead>
        <tbody id="feedUp"></tbody>
      </table>
    </div>

    <!-- ê¸‰ë½ Top 10 -->
    <div class="card">
      <div class="title"><b>ğŸ’§ ê¸‰ë½ì½”ì¸ Top 10</b> <span class="tag" id="tagDown">ê¸°ë³¸: -5%â†“ Â· 24h 1000ì–µâ†‘</span></div>
      <table>
        <thead><tr class="muted"><th>#</th><th>ì½”ì¸ëª…(í•œê¸€)</th><th>í˜„ì¬ê°€</th><th>ë³€ë™ë¥ </th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th></tr></thead>
        <tbody id="feedDown"></tbody>
      </table>
    </div>
  </div>

  <script>
    /* ===== ê³µí†µ: ì‹œê³„/ìƒíƒœ ===== */
    (function clockTick(){
      function tick(){
        var clock=document.getElementById('clock'), net=document.getElementById('net'); if(!clock||!net) return;
        var now=new Date(); var utc=now.getTime()+now.getTimezoneOffset()*60000; var kst=new Date(utc+9*3600000);
        clock.textContent='KST â€” '+kst.toLocaleTimeString('ko-KR',{hour12:false});
        var on=navigator.onLine; net.textContent=on?'ONLINE':'OFFLINE'; net.style.background=on?'#123922':'#3a1a1a';
      }
      setInterval(tick,1000); tick();
    })();

    /* ===== ì—…ë¹„íŠ¸ API: í”„ë¡ì‹œ + í´ë°± ===== */
    var PROXIES = [
      'https://corsproxy.io/?',
      // í•„ìš”í•˜ë©´ ì—¬ê¸° ë‹¤ë¥¸ í”„ë¡ì‹œ ì¶”ê°€ ê°€ëŠ¥
    ];
    var API = 'https://api.upbit.com/v1/';
    function withProxy(url){ return PROXIES[0] + url; }

    function fetchJSON(url, opts){
      opts=opts||{}; var timeout=opts.timeout||9000;
      return new Promise(function(resolve,reject){
        var ctrl=new AbortController(); var t=setTimeout(function(){ctrl.abort();},timeout);
        fetch(url,{signal:ctrl.signal,cache:'no-store'}).then(function(r){
          clearTimeout(t); if(!r.ok) throw new Error('HTTP '+r.status); return r.json();
        }).then(resolve).catch(reject);
      });
    }

    /* ===== ì´ë¦„ ìºì‹œ ===== */
    var NAME_CACHE_KEY='upbit_names_cache_v2';
    function saveNameCache(o){ try{localStorage.setItem(NAME_CACHE_KEY,JSON.stringify(o));}catch(e){} }
    function loadNameCache(){ try{return JSON.parse(localStorage.getItem(NAME_CACHE_KEY)||'{}');}catch(e){return {}} }

    var NAME_BY_MARKET={}, NAME_BY_SYM={};
    function SYM(m){return m.replace('KRW-','');}
    function ko(mOrS){
      if(!mOrS) return 'ì´ë¦„ë¯¸ì •';
      if(mOrS.indexOf && mOrS.indexOf('KRW-')===0) return NAME_BY_MARKET[mOrS]||'ì´ë¦„ë¯¸ì •';
      return NAME_BY_SYM[mOrS]||'ì´ë¦„ë¯¸ì •';
    }

    function hydrateNameFromCache(){
      var c=loadNameCache(); var bm=c.byMarket||{}, bs=c.bySym||{};
      for(var k in bm) NAME_BY_MARKET[k]=bm[k];
      for(var s in bs) NAME_BY_SYM[s]=bs[s];
    }
    hydrateNameFromCache();

    function ensureMarkets(){
      if(Object.keys(NAME_BY_MARKET).length) return Promise.resolve();
      var url = withProxy(API+'market/all?isDetails=false');
      return fetchJSON(url,{timeout:9000}).then(function(all){
        var list = all.filter(function(x){return x.market.indexOf('KRW-')===0;});
        for(var i=0;i<list.length;i++){
          var m=list[i], sym=SYM(m.market), k=(m.korean_name||'').trim()||sym;
          NAME_BY_MARKET[m.market]=k; NAME_BY_SYM[sym]=k;
        }
        saveNameCache({byMarket:NAME_BY_MARKET, bySym:NAME_BY_SYM});
        var net=document.getElementById('net'); net.textContent='ONLINE'; net.style.background='#123922';
      }).catch(function(){
        // ë„¤íŠ¸ì›Œí¬ ì‹¤íŒ¨ ì‹œ ìºì‹œë§Œìœ¼ë¡œ ë™ì‘
      });
    }

    /* ===== í¬ë§·/í˜¸ê°€/ë¦¬ìŠ¤í¬ ===== */
    function getTick(p){
      if(p>=2000000) return 1000; if(p>=1000000) return 500; if(p>=500000) return 100;
      if(p>=100000) return 50; if(p>=10000) return 10; if(p>=1000) return 5; if(p>=100) return 1;
      if(p>=10) return 0.1; if(p>=1) return 0.01; if(p>=0.1) return 0.001; if(p>=0.01) return 0.0001;
      if(p>=0.001) return 0.00001; if(p>=0.0001) return 0.000001; if(p>=0.00001) return 0.0000001;
      if(p>=0.000001) return 0.00000001; return 0.000000001;
    }
    function fmtKRW(x){ var t=getTick(x),d=(t.toString().split('.')[1]||'').length; var r=Math.round(x/t)*t; return r.toLocaleString('ko-KR',{minimumFractionDigits:d,maximumFractionDigits:d}); }
    function riskText(r){ var v=Math.abs(r*100); return v<1?'1(ì•ˆì •)':(v<3?'2(ë³´í†µ)':'3(ì£¼ì˜)'); }
    function riskClass(r){ var v=Math.abs(r*100); return v<1?'r1':(v<3?'r2':'r3'); }
    function zzeolComment(r){ return r>0.1?'ğŸš€ í­ë“± ëª¨ë“œ!':(r>0.05?'ğŸ”¥ ë¶ˆì¥ ì‹ í˜¸!':(r>0.02?'ğŸ“ˆ ìƒìŠ¹ íƒ„ë ¥':(r<-0.1?'ğŸ’£ ê¸‰ë½ ê²½ê³ ':(r<-0.05?'âš ï¸ ì•½ì„¸ ì „í™˜':'âš–ï¸ ê´€ë§')))); }

    /* ===== ì„¤ì • ì €ì¥/ë¡œë“œ ===== */
    var OPT_KEY='zzeol_opts_v1';
    function loadOpts(){
      try{ return JSON.parse(localStorage.getItem(OPT_KEY)||'{}'); }catch(e){ return {}; }
    }
    function saveOpts(o){ try{ localStorage.setItem(OPT_KEY,JSON.stringify(o)); }catch(e){} }
    function applyOptsTag(){
      var o=loadOpts();
      var up=document.getElementById('tagUp'), dn=document.getElementById('tagDown');
      var upP=o.thUp||5, dnP=o.thDown||5, vol=o.thVol||1000;
      up.textContent='ì„¤ì •: '+upP+'%â†‘ Â· 24h '+vol+'ì–µâ†‘';
      dn.textContent='ì„¤ì •: -'+dnP+'%â†“ Â· 24h '+vol+'ì–µâ†‘';
      document.getElementById('thUp').value=upP;
      document.getElementById('thDown').value=dnP;
      document.getElementById('thVol').value=vol;
      document.getElementById('refreshSec').value=o.refreshSec||60;
    }

    /* ===== ê²€ìƒ‰ ===== */
    function doSearch(){
      var err=document.getElementById('searchError'); if(err) err.style.display='none';
      var q=(document.getElementById('q').value||'').trim(); if(!q){document.getElementById('q').focus();return;}
      ensureMarkets().then(function(){
        var keys=Object.keys(NAME_BY_MARKET), found=null, s=q.toLowerCase();
        // ì •í™•
        for(var i=0;i<keys.length;i++){ var k=keys[i]; var nm=(NAME_BY_MARKET[k]||'').toLowerCase();
          if(k.toLowerCase()===s || SYM(k).toLowerCase()===s || nm===s){ found=k; break; } }
        // ë¶€ë¶„
        if(!found){ for(var j=0;j<keys.length;j++){ var kk=keys[j]; var nm2=(NAME_BY_MARKET[kk]||'').toLowerCase();
          if(kk.toLowerCase().indexOf(s)>-1 || SYM(kk).toLowerCase().indexOf(s)>-1 || nm2.indexOf(s)>-1){ found=kk; break; } }
        }
        if(!found){ err.textContent='ì¼ì¹˜ ì½”ì¸ ì—†ìŒ (ì˜ˆ: ì´ë”ë¦¬ì›€ / ETH / KRW-ETH)'; err.style.display='block'; return; }
        var url=withProxy(API+'ticker?markets='+found);
        return fetchJSON(url,{timeout:9000}).then(function(d){
          var t=d[0], p=t.trade_price, r=t.signed_change_rate;
          document.getElementById('result').style.display='block';
          document.getElementById('selName').textContent=ko(found); document.getElementById('selMarket').textContent=found;
          document.getElementById('s_price').textContent=fmtKRW(p);
          document.getElementById('s_buy').textContent=fmtKRW(p*0.988);
          document.getElementById('s_sell').textContent=fmtKRW(p*1.012);
          document.getElementById('s_stop').textContent=fmtKRW(p*0.975);
          document.getElementById('s_rate').innerHTML='<span class="chg '+(r>=0?'up':'down')+'">'+(r*100).toFixed(2)+'%</span>';
          document.getElementById('s_risk').innerHTML='<span class="risk '+riskClass(r)+'">'+riskText(r)+'</span>';
          document.getElementById('s_comment').textContent=zzeolComment(r);
        });
      }).catch(function(){
        err.textContent='ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨'; err.style.display='block';
      });
    }

    document.getElementById('btnSearch').addEventListener('click',doSearch);
    document.getElementById('q').addEventListener('keydown',function(e){ if(e.key==='Enter') doSearch(); });
    document.getElementById('btnClear').addEventListener('click',function(){ document.getElementById('q').value=''; document.getElementById('result').style.display='none'; document.getElementById('searchError').style.display='none'; });

    /* ===== ê¸‰ë“±/ê¸‰ë½ ìŠ¤ìº” ===== */
    function chunk(arr,size){var o=[]; for(var i=0;i<arr.length;i+=size) o.push(arr.slice(i,i+size)); return o;}
    function scanOnce(){
      return ensureMarkets().then(function(){
        var opts=loadOpts(); var thUp=(opts.thUp||5)/100, thDown=-(opts.thDown||5)/100, vol=(opts.thVol||1000)*100000000; // ì–µ â†’ ì›
        var markets=Object.keys(NAME_BY_MARKET); var parts=chunk(markets,60); var all=[];
        function seq(i){ if(i>=parts.length) return Promise.resolve(); var url=withProxy(API+'ticker?markets='+parts[i].join(','));
          return fetchJSON(url,{timeout:9000}).then(function(js){ all=all.concat(js||[]); }).then(function(){return seq(i+1);}); }
        return seq(0).then(function(){
          var ups=[], downs=[];
          for(var k=0;k<all.length;k++){
            var t=all[k]; if(!t) continue;
            var r=t.signed_change_rate; var v=t.acc_trade_price_24h||0;
            if(v>=vol && r>=thUp) ups.push(t);
            if(v>=vol && r<=thDown) downs.push(t);
          }
          ups.sort(function(a,b){return b.signed_change_rate-a.signed_change_rate;});
          downs.sort(function(a,b){return a.signed_change_rate-b.signed_change_rate;});
          renderList('feedUp', ups.slice(0,10));
          renderList('feedDown', downs.slice(0,10));
          var net=document.getElementById('net'); net.textContent='ONLINE'; net.style.background='#123922';
        }).catch(function(){
          var net=document.getElementById('net'); net.textContent='OFFLINE (ì¬ì‹œë„ì¤‘)'; net.style.background='#3a1a1a';
        });
      });
    }

    function renderList(tbodyId, arr){
      var el=document.getElementById(tbodyId); el.innerHTML='';
      for(var i=0;i<arr.length;i++){
        var t=arr[i], p=t.trade_price, r=t.signed_change_rate;
        var tr=document.createElement('tr');
        tr.innerHTML='<td>'+(i+1)+'</td>'
          +'<td>'+ko(t.market)+'</td>'
          +'<td>'+fmtKRW(p)+'</td>'
          +'<td class="chg '+(r>=0?'up':'down')+'">'+(r*100).toFixed(2)+'%</td>'
          +'<td>'+fmtKRW(p*0.988)+'</td>'
          +'<td>'+fmtKRW(p*1.012)+'</td>'
          +'<td>'+fmtKRW(p*0.975)+'</td>'
          +'<td><span class="risk '+riskClass(r)+'">'+riskText(r)+'</span></td>'
          +'<td>'+zzeolComment(r)+'</td>';
        el.appendChild(tr);
      }
    }

    /* ===== ì„¤ì • ì €ì¥/ì¦‰ì‹œ ìŠ¤ìº”/ì£¼ê¸°ì  ìŠ¤ìº” ===== */
    function bindSettings(){
      applyOptsTag();
      document.getElementById('btnSave').addEventListener('click',function(){
        var o={
          thUp: Number(document.getElementById('thUp').value)||5,
          thDown: Number(document.getElementById('thDown').value)||5,
          thVol: Number(document.getElementById('thVol').value)||1000,
          refreshSec: Math.max(10, Number(document.getElementById('refreshSec').value)||60)
        };
        saveOpts(o); applyOptsTag(); schedule(); scanOnce();
      });
      document.getElementById('btnNow').addEventListener('click',function(){ scanOnce(); });
    }

    var timer=null;
    function schedule(){
      if(timer) clearInterval(timer);
      var o=loadOpts(); var sec=Math.max(10,o.refreshSec||60);
      timer=setInterval(scanOnce, sec*1000);
    }

    /* ===== ë¶€íŒ… ===== */
    (function boot(){
      bindSettings(); applyOptsTag();
      scanOnce().then(function(){ schedule(); });
    })();
  </script>
</body>
</html>
