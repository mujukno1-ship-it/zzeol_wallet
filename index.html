<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>쩔어지갑 v10.6 — Upbit KRW 실시간</title>
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
<meta http-equiv="Pragma" content="no-cache"/>
<meta http-equiv="Expires" content="0"/>
<style>
:root{
  --bg:#0b1117;--card:#121826;--txt:#e6edf3;--mut:#9fb0c0;
  --line:#243044;--up:#3bd671;--dn:#ff6b6b;
}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--txt);font-family:-apple-system,BlinkMacSystemFont,"Pretendard",Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif}
.wrap{max-width:1100px;margin:26px auto;padding:0 16px}
.badge{display:inline-flex;gap:8px;align-items:center;font-size:12px;color:#9fb0c0;margin-bottom:10px}
.badge .ver{background:#0e1522;border:1px solid var(--line);padding:4px 8px;border-radius:999px}
h1{margin:6px 0 14px;font-size:18px}
.card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px;margin-top:12px}
.title{font-weight:700;margin-bottom:8px}
.row{display:flex;gap:12px;flex-wrap:wrap}
.col{flex:1 1 360px;min-width:300px}
input[type="text"]{width:100%;padding:12px 14px;border-radius:10px;border:1px solid var(--line);background:#0e1522;color:var(--txt);font-size:16px}
button{border:1px solid var(--line);background:#1a2333;color:var(--txt);padding:8px 10px;border-radius:8px;cursor:pointer}
button:hover{filter:brightness(1.12)}

.infobar{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
.ibox{background:#0e1522;border:1px solid var(--line);border-radius:10px;padding:10px;text-align:center}
.ibox .k{font-size:12px;color:var(--mut);margin-bottom:6px}
.ibox .v{font-size:16px;font-weight:700}
.good{color:var(--up)} .bad{color:var(--dn)}

table{width:100%;border-collapse:collapse}
th,td{padding:9px 8px;border-top:1px solid var(--line);text-align:right}
th:first-child,td:first-child{text-align:left}
th{font-weight:600;color:var(--mut)}
@media (max-width:980px){.infobar{grid-template-columns:repeat(2,1fr)}}
</style>
</head>
<body>
  <div class="wrap">
    <div class="badge"><span>UI 배포:</span><span class="ver">UI v10.6</span></div>
    <h1>쩔어지갑 🔥 Upbit KRW 실시간</h1>

    <!-- 검색 + 새로고침 -->
    <div class="card">
      <div class="title">코인 검색</div>
      <div class="row">
        <div class="col"><input id="search" type="text" placeholder="예: 시바이누, 이더리움, 비트코인…"></div>
        <div><button id="btnReload">KRW 목록 새로고침</button></div>
      </div>
    </div>

    <!-- 가로형 패널: 현재가 / 매수 / 매도 / 위험도 / 쩔어한마디 -->
    <div class="card">
      <div class="title">AI 실시간 분석 (코인 목록에서 행을 클릭하세요)</div>
      <div class="infobar">
        <div class="ibox"><div class="k">💰 현재가</div><div class="v" id="priceBox">-</div></div>
        <div class="ibox"><div class="k">🟦 매수 타점</div><div class="v" id="buyBox">-</div></div>
        <div class="ibox"><div class="k">🟥 매도(익절)</div><div class="v" id="sellBox">-</div></div>
        <div class="ibox"><div class="k">⚠️ 위험도</div><div class="v" id="riskBox">-</div></div>
        <div class="ibox"><div class="k">💬 쩔어한마디</div><div class="v" id="quipBox">-</div></div>
      </div>
    </div>

    <!-- KRW 코인 목록 -->
    <div class="card">
      <div class="title">KRW 코인 목록 (실시간)</div>
      <table>
        <thead><tr><th>심볼</th><th>코인명</th><th>현재가</th><th>등락률</th><th>거래대금(24h)</th></tr></thead>
        <tbody id="listBody"><tr><td colspan="5">불러오는 중…</td></tr></tbody>
      </table>
    </div>
  </div>

<script>
const API='https://api.upbit.com/v1';
const $=s=>document.querySelector(s);
const fmt=v=>v||v===0?Number(v).toLocaleString('ko-KR')+'원':'-';
const pct=r=>{const x=Number(r)*100;const c=x>0?'good':x<0?'bad':'';return `<span class="${c}">${x>0?'+':''}${x.toFixed(2)}%</span>`};

let markets=[], tickers={};

async function load(){
  const r=await fetch(API+'/market/all?isDetails=true');
  markets=(await r.json()).filter(x=>x.market.startsWith('KRW-'));
  await refresh();
  renderList();
}
async function refresh(){
  const ids=markets.map(m=>m.market);
  for(let i=0;i<ids.length;i+=100){
    const c=ids.slice(i,i+100);
    const r=await fetch(API+'/ticker?markets='+c.join(','));
    (await r.json()).forEach(t=>tickers[t.market]=t);
  }
}
function renderList(){
  const q=$('#search').value.trim().toLowerCase();
  const body=$('#listBody');
  const filtered=markets.filter(m=>{
    const n=m.korean_name.toLowerCase(), e=m.english_name.toLowerCase(), s=m.market.replace('KRW-','').toLowerCase();
    return !q || n.includes(q)||e.includes(q)||s.includes(q);
  }).slice(0,30);

  body.innerHTML=filtered.map(m=>{
    const t=tickers[m.market]||{};
    return `<tr data-m="${m.market}">
      <td><b>${m.market.replace('KRW-','')}</b></td>
      <td>${m.korean_name}</td>
      <td>${fmt(t.trade_price)}</td>
      <td>${pct(t.signed_change_rate||0)}</td>
      <td>${fmt(t.acc_trade_price_24h)}</td>
    </tr>`;
  }).join('');

  body.querySelectorAll('tr').forEach(tr=>tr.onclick=()=>select(tr.dataset.m));
}
$('#search').oninput=renderList;
$('#btnReload').onclick=load;

async function select(market){
  const r=await fetch(API+'/ticker?markets='+market);
  const t=(await r.json())[0];
  if(!t) return;

  const price=t.trade_price;
  // 간단 ATR 대체(가격의 1.1%) → 실제 ATR로 바꿀 때 이 부분만 교체
  const atr=price*0.011;
  const buy=price-atr*0.5;                          // 보수적 매수
  const sell1=price+atr*0.8, sell2=price+atr*1.2;    // 1차/2차 익절
  const risk=(Math.abs(t.signed_change_rate)*10).toFixed(1); // 0~5 느낌값
  const say = t.signed_change_rate>0.01 ? '상승 탄력 — 분할익절 대기'
           : t.signed_change_rate<-0.01 ? '조정 구간 — 분할매수 접근'
           : '횡보 — 관망 유리';

  $('#priceBox').textContent=fmt(price);
  $('#buyBox').textContent=fmt(buy);
  $('#sellBox').textContent=`${fmt(sell1)} / ${fmt(sell2)}`;
  $('#riskBox').textContent=`${risk} / 5.0`;
  $('#quipBox').textContent=say;
}

load();
</script>
</body>
</html>
