<!-- zzeol v7.3.1 2025-10-22 13:15 -->
<!doctype html>
<html lang="ko">
<head>
<style>
  .search-row .col-12 > .text-muted.small span { display:inline-block; }
  #search-suggest { box-shadow:0 6px 16px rgba(0,0,0,.18); }
  #search-suggest .list-group-item { padding:.5rem .75rem; }
</style>
  
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì©”ì–´ì§€ê°‘ v7.3 ì•ˆì •íŒ (ì‹¤ì‹œê°„ ê¸‰ë“±í˜•)</title>
<meta name="theme-color" content="#0b0f14" />
<style>
  :root{
    --bg:#0b0f14;--panel:#121823;--muted:#96a2b4;--text:#e7eef7;--accent:#53b3ff;
    --up:#33d69f;--down:#ff6b6b;--chip:#1a2230;--chip2:#0f1520;--border:#1e2735;
    --warn:#f7b731;--danger:#ff6b6b;--ok:#33d69f;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,Apple SD Gothic Neo,Segoe UI,Roboto,Helvetica,Arial}
  a{color:var(--accent);text-decoration:none}
  .wrap{max-width:1200px;margin:24px auto;padding:0 16px}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .header{display:flex;align-items:center;justify-content:space-between;margin-bottom:16px}
  .badge{background:#0d1320;border:1px solid var(--border);color:#9dc8ff;padding:4px 8px;border-radius:999px;font-size:12px}
  .title{font-weight:700;font-size:18px}
  .search-bar{display:flex;gap:8px;align-items:center;background:var(--panel);padding:12px;border:1px solid var(--border);border-radius:12px}
  .search-bar input{flex:1;background:var(--chip2);color:var(--text);border:1px solid var(--border);padding:12px 14px;border-radius:10px;outline:none}
  .btn{background:var(--chip);border:1px solid var(--border);color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer}
  .btn:hover{filter:brightness(1.1)}
  .btn-ghost{background:transparent;border:1px solid var(--border)}
  .panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px}
  .panel + .panel{margin-top:14px}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{background:var(--chip);border:1px solid var(--border);padding:6px 10px;border-radius:999px;color:var(--muted);font-size:12px}
  .chip strong{color:var(--text)}
  .grid{display:grid;grid-template-columns: 40px 1fr repeat(7, minmax(80px, 110px));gap:0}
  .thead,.trow{display:contents}
  .th,.td{padding:10px;border-bottom:1px solid var(--border);background:transparent}
  .th{color:#9ab; font-size:12px}
  .td{font-size:14px}
  .num{font-variant-numeric:tabular-nums}
  .up{color:var(--up)} .down{color:var(--down)} .muted{color:var(--muted)}
  .pill{padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:var(--chip2);font-size:12px;color:#cbd6e5}
  .pill.warn{background:#2a1e10;border-color:#4d3215;color:#f7d7a6}
  .pill.ok{background:#11261e;border-color:#1b3b2b;color:#b7f2d9}
  .pill.danger{background:#2a1112;border-color:#472022;color:#ffc7c9}
  .section-title{display:flex;align-items:center;justify-content:space-between;margin:18px 0 10px}
  .small{font-size:12px;color:#9ab}
  .right{justify-content:flex-end}
  .sticky-row{position:sticky;top:10px;z-index:5}
  .flex{display:flex;gap:8px;align-items:center}
  .switch{display:inline-flex;gap:8px;align-items:center}
  .switch input{accent-color:var(--accent)}
  .empty{padding:20px;text-align:center;color:#9ab}
  @media (max-width: 980px){
    .grid{grid-template-columns: 32px 1fr repeat(7, minmax(72px, 92px))}
  }
  @media (max-width: 760px){
    .grid{grid-template-columns: 28px 1fr repeat(7, minmax(68px, 84px))}
    .td,.th{padding:8px}
    .chips{gap:6px}
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="header">
    <div class="row">
      <span class="badge">ì©”ì–´ì§€ê°‘ v7.3 ì•ˆì •íŒ</span>
      <span class="badge">ONLINE</span>
    </div>
    <div class="row">
      <span class="badge" id="clock">KST â€” --:--:--</span>
      <button class="btn btn-ghost" id="refreshBtn">ìƒˆë¡œê³ ì¹¨</button>
      <label class="switch small">
        <input type="checkbox" id="autoTick"> ìë™ ìƒˆë¡œê³ ì¹¨(60s)
      </label>
    </div>
  </div>

  <!-- ê²€ìƒ‰ -->
  <div class="panel search-bar sticky-row">
    <input id="q" placeholder="ì½”ì¸ ê²€ìƒ‰ (ì˜ˆ: ì´ë”ë¦¬ì›€ / ETH / KRW-ETH / ethereum)" />
    <button class="btn" id="searchBtn">ê²€ìƒ‰</button>
    <button class="btn btn-ghost" id="resetBtn">ì´ˆê¸°í™”</button>
  </div>
  <!-- ê²€ìƒ‰ ê²°ê³¼ í•œ ì¤„ í‘œì‹œ -->
<div id="search-result-row" class="search-row" style="display:none;margin-top:8px">
  <div class="row g-2">
    <div class="col-12 d-flex gap-2 align-items-center text-muted small">
      <span style="width:80px">ì½”ì¸ëª…</span>
      <span style="width:80px">í˜„ì¬ê°€</span>
      <span style="width:80px">ë³€ë™ë¥ </span>
      <span style="width:80px">ë§¤ìˆ˜</span>
      <span style="width:80px">ë§¤ë„</span>
      <span style="width:80px">ì†ì ˆ</span>
      <span style="width:80px">ìœ„í—˜ë„</span>
      <span style="flex:1">ì©”ì–´í•œë§ˆë””</span>
    </div>
    <div id="search-result" class="col-12"></div>
  </div>
</div>

<!-- ìë™ì™„ì„± ë¦¬ìŠ¤íŠ¸ -->
<ul id="search-suggest" class="list-group position-absolute"
    style="z-index:50;max-height:320px;overflow:auto;display:none;width:100%;"></ul>


  <!-- ì„ íƒ ì½”ì¸ í•œ ì¤„ ìš”ì•½ -->
  <div id="selectedBox" class="panel" style="display:none;">
    <div class="chips" id="selectedChips"></div>
  </div>

  <!-- ê¸‰ë“±/ê¸‰ë½ -->
  <div class="panel">
    <div class="section-title">
      <div class="title">ğŸ”¥ ê¸‰ë“±ì½”ì¸ Top 10 <span class="small">(ì¡°ê±´: ì‹¤ì‹œê°„ ë³€ë™ë¥ )</span></div>
      <div class="small" id="updatedAt">ì—…ë°ì´íŠ¸: --:--:--</div>
    </div>
    <div class="grid" id="upGrid">
      <div class="thead">
        <div class="th">#</div>
        <div class="th">ì½”ì¸ëª…(í•œê¸€)</div>
        <div class="th right">í˜„ì¬ê°€</div>
        <div class="th right">ë³€ë™ë¥ </div>
        <div class="th right">ë§¤ìˆ˜</div>
        <div class="th right">ë§¤ë„</div>
        <div class="th right">ì†ì ˆ</div>
        <div class="th right">ìœ„í—˜ë„</div>
        <div class="th right">ì©”ì–´í•œë§ˆë””</div>
      </div>
      <!-- rows here -->
    </div>
    <div class="empty" id="upEmpty" style="display:none;">ì¡°ê±´ì— ë§ëŠ” ì½”ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</div>
  </div>

  <div class="panel">
    <div class="section-title">
      <div class="title">ğŸ’§ ê¸‰ë½ì½”ì¸ Top 10 <span class="small">(ì¡°ê±´: ì‹¤ì‹œê°„ ë³€ë™ë¥ )</span></div>
    </div>
    <div class="grid" id="downGrid">
      <div class="thead">
        <div class="th">#</div>
        <div class="th">ì½”ì¸ëª…(í•œê¸€)</div>
        <div class="th right">í˜„ì¬ê°€</div>
        <div class="th right">ë³€ë™ë¥ </div>
        <div class="th right">ë§¤ìˆ˜</div>
        <div class="th right">ë§¤ë„</div>
        <div class="th right">ì†ì ˆ</div>
        <div class="th right">ìœ„í—˜ë„</div>
        <div class="th right">ì©”ì–´í•œë§ˆë””</div>
      </div>
      <!-- rows here -->
    </div>
    <div class="empty" id="downEmpty" style="display:none;">ì¡°ê±´ì— ë§ëŠ” ì½”ì¸ì´ ì—†ìŠµë‹ˆë‹¤.</div>
  </div>

</div>

<script>
/* === zzeol v7.x ê²€ìƒ‰ ëª¨ë“ˆ(í•œë°© êµì²´) ============================= */

/* 1) ì—…ë¹„íŠ¸ ë§ˆì¼“ëª©ë¡ì„ 1íšŒë§Œ ë¡œë“œ (KRWë§Œ, í•œê¸€/ì˜ë¬¸/ì½”ë“œ ëª¨ë‘ ê²€ìƒ‰ ê°€ëŠ¥) */
const marketsPromise = (async () => {
  const url = '/api/upbit?path=/v1/market/all?isDetails=true';
  const res = await fetch(url, { headers: { 'cache-control': 'no-store' }});
  if (!res.ok) throw new Error('ë§ˆì¼“ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨');
  const all = await res.json();
  return all
    .filter(x => (x.market || '').startsWith('KRW-'))
    .map(x => ({
      market: x.market,                          // KRW-ETH
      code: (x.market || '').replace('KRW-',''), // ETH
      ko: x.korean_name || '',
      en: x.english_name || ''
    }))
    .sort((a,b)=>a.ko.localeCompare(b.ko,'ko'));
})();

/* 2) DOM ì°¸ì¡° */
const $input   = document.querySelector('#search');          // â† ê²€ìƒ‰ input
const $suggest = document.querySelector('#search-suggest');  // ìë™ì™„ì„±
const $rowWrap = document.querySelector('#search-result-row');// í•œ ì¤„ ì „ì²´ ë˜í¼
const $row     = document.querySelector('#search-result');   // í•œ ì¤„ ë‚´ìš©

if (!$input) console.warn('ê²€ìƒ‰ input(#search)ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. idë¥¼ í™•ì¸í•˜ì„¸ìš”.');

/* 3) ìœ í‹¸ë¦¬í‹° */
const sleep = ms => new Promise(r=>setTimeout(r,ms));
const debouncer = (fn, ms=120) => { let t; return (...a)=>{clearTimeout(t); t=setTimeout(()=>fn(...a),ms);} }
const norm = s => (s||'').toString().trim().toLowerCase();

/* 4) IME(í•œê¸€ ì¡°í•©) ëŒ€ì‘ */
let composing = false;
$input?.addEventListener('compositionstart', ()=> composing = true);
$input?.addEventListener('compositionend',   ()=> { composing = false; onInput(); });

/* 5) ì¸ë±ìŠ¤ ë¡œë“œ */
let markets = [];
(async () => {
  try { markets = await marketsPromise; }
  catch(e) { console.error(e); }
})();

/* 6) ì…ë ¥ í•¸ë“¤ë§ */
const onInput = debouncer(() => {
  if (composing) return;
  const q = norm($input.value);
  if (!q) { hideSuggest(); clearRow(); return; }

  const hits = markets.filter(m =>
    norm(m.ko).includes(q) || norm(m.en).includes(q) ||
    norm(m.code).includes(q) || norm(m.market).includes(q)
  ).slice(0, 20);

  if (!hits.length) { showSuggest([]); clearRow('ê²°ê³¼ ì—†ìŒ'); return; }
  showSuggest(hits);
}, 0);

$input?.addEventListener('input', onInput);
$input?.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    const first = $suggest.querySelector('li[data-market]');
    if (first) { e.preventDefault(); selectMarket(first.getAttribute('data-market')); }
  }
});

/* 7) ìë™ì™„ì„± */
function showSuggest(list) {
  if (!list.length) { hideSuggest(); return; }
  $suggest.innerHTML = list.map(m => `
    <li class="list-group-item list-group-item-action d-flex justify-content-between"
        data-market="${m.market}" style="cursor:pointer">
      <span>${m.ko} <span class="text-muted">(${m.code})</span></span>
      <span class="text-muted">${m.market}</span>
    </li>
  `).join('');
  $suggest.style.display = 'block';
  [...$suggest.querySelectorAll('li[data-market]')].forEach(li=>{
    li.onclick = () => selectMarket(li.getAttribute('data-market'));
  });
}
function hideSuggest(){ $suggest.style.display='none'; }

/* 8) ê²€ìƒ‰ ê²°ê³¼ í•œ ì¤„ í‘œì‹œ/ì´ˆê¸°í™” */
function clearRow(msg){
  $rowWrap.style.display = 'block';
  if (!msg) { $rowWrap.style.display='none'; $row.innerHTML=''; return; }
  $row.innerHTML = `<div class="text-muted small px-2 py-1">${msg}</div>`;
}

/* 9) ë§ˆì¼“ ì„ íƒ â†’ í‹°ì»¤ ì¡°íšŒ í›„ ë¼ì¸ ë Œë” */
async function selectMarket(market) {
  try {
    hideSuggest();
    $input.value = market;

    // í˜„ì¬ê°€(í‹°ì»¤)
    const res = await fetch(`/api/upbit?path=/v1/ticker?markets=${encodeURIComponent(market)}`, {
      headers: { 'cache-control': 'no-store' }
    });
    if (!res.ok) throw new Error('í‹°ì»¤ ì¡°íšŒ ì‹¤íŒ¨');
    const [t] = await res.json();

    const price = t.trade_price;                      // í˜„ì¬ê°€
    const chgRt = ((t.signed_change_rate||0) * 100);  // ë³€ë™ë¥ (%)

    // í˜¸ê°€ë‹¨ìœ„ ê·¼ì‚¬(ì—…ë¹„íŠ¸ ë£° ë”°ë¼ê°€ê¸°)
    const buy  = fixUnit(price * 0.985);  // -1.5%
    const sell = fixUnit(price * 1.015);  // +1.5%
    const cut  = fixUnit(price * 0.97);   // -3%

    const risk = riskBadge(chgRt);        // 3(ì£¼ì˜)/2(ë³´í†µ)/1(ì•ˆì •)
    const say  = zzeolOneLiner(chgRt);    // ì©”ì–´í•œë§ˆë””(ê¸°ì¡´ í†¤ ìœ ì§€)

    $row.innerHTML = renderRow({ market, price, chgRt, buy, sell, cut, risk, say });
    $rowWrap.style.display = 'block';

  } catch(e) {
    console.error(e);
    clearRow('ì¡°íšŒ ì‹¤íŒ¨');
  }
}

/* 10) í˜¸ê°€ë‹¨ìœ„/í¬ë§·/ë¼ë²¨ */
function tickUnit(p){
  if (p >= 2_000_000) return 1000;
  if (p >=   200_000) return  500;
  if (p >=    10_000) return  100;
  if (p >=     1_000) return   50;
  if (p >=       100) return   10;
  if (p >=        10) return    1;
  if (p >=         1) return  0.1;
  return 0.01;
}
function fixUnit(p){ const u=tickUnit(p); return Math.round(p/u)*u; }
function fmt(n){ return typeof n==='number' ? n.toLocaleString('ko-KR') : n; }

function riskBadge(chg){
  const a = Math.abs(chg);
  if (a >= 10) return '3(ì£¼ì˜)';
  if (a >=  5) return '2(ë³´í†µ)';
  return '1(ì•ˆì •)';
}
function zzeolOneLiner(chg){
  if (chg >= 15) return 'ğŸš€ í­ë“±';
  if (chg >=  5) return 'ğŸ”¥ ë¶ˆì¥ ì‹ í˜¸!';
  if (chg <= -10) return 'ğŸ“‰ ë‚™í­ê²½ê³„';
  if (chg <=  -5) return 'âš ï¸ ì¡°ì • êµ¬ê°„';
  return 'ğŸ‘€ ê´€ë§';
}
function renderRow({ market, price, chgRt, buy, sell, cut, risk, say }){
  return `
  <div class="d-flex gap-2 align-items-center px-2 py-1">
    <span style="width:80px">${market}</span>
    <span style="width:80px">${fmt(price)}</span>
    <span style="width:80px" class="${chgRt>=0?'text-success':'text-danger'}">${chgRt.toFixed(2)}%</span>
    <span style="width:80px">${fmt(buy)}</span>
    <span style="width:80px">${fmt(sell)}</span>
    <span style="width:80px">${fmt(cut)}</span>
    <span style="width:80px">${risk}</span>
    <span style="flex:1">${say}</span>
  </div>`;
}

/* 11) ë°”ê¹¥ í´ë¦­ ì‹œ ìë™ì™„ì„± ë‹«ê¸° + í¬ì»¤ìŠ¤ ì œì•ˆ */
document.addEventListener('click', (e)=>{
  if (!($suggest.contains(e.target) || $input.contains(e.target))) hideSuggest();
});
(async () => {
  await marketsPromise.catch(()=>{});
  $input?.addEventListener('focus', ()=>{
    const q = norm($input.value);
    if (!q && markets.length) showSuggest(markets.slice(0,10));
  });
})();

/* ============================================================= */
</script>


