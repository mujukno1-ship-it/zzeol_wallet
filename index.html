<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>쩔어지갑 v3.9 — 급등 피드 실시간</title>
  <style>
    body {
      background-color: #0d1117;
      color: #e6edf3;
      font-family: 'Pretendard', sans-serif;
      padding: 20px;
    }
    .card {
      background-color: #161b22;
      border: 1px solid #30363d;
      border-radius: 12px;
      padding: 16px;
      margin-top: 15px;
      box-shadow: 0 0 8px #0d1117;
    }
    input, button {
      background-color: #0d1117;
      color: #e6edf3;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 8px;
    }
    button:hover {
      background-color: #21262d;
      cursor: pointer;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      color: #e6edf3;
      text-align: center;
    }
    th, td {
      padding: 6px;
      border-bottom: 1px solid #2d333b;
    }
  </style>
</head>
<body>
  <h2>쩔어지갑 <span style="color:#4ade80;">v3.9</span> ⚡</h2>
  <div class="search card">
    <input id="search-input" placeholder="코인 검색 (예: 비트코인, 시바이누)" style="width:70%;">
    <button onclick="searchCoin()">검색</button>
    <button onclick="clearResult()">초기화</button>
  </div>

  <div class="card" id="result-card" style="display:none;">
    <h3>선택된 코인: <span id="coin-name"></span></h3>
    <table>
      <tr><th>현재가</th><th>매수</th><th>매도</th><th>손절</th><th>위험도</th><th>쩔어 한마디</th></tr>
      <tr>
        <td id="price">-</td>
        <td id="buy">-</td>
        <td id="sell">-</td>
        <td id="stop">-</td>
        <td id="risk">-</td>
        <td id="comment">-</td>
      </tr>
    </table>
  </div>

  <!-- 🔥 급등코인 실시간 피드형 -->
  <div class="card" id="hot-section">
    <h3>🔥 급등코인 실시간 피드 (누적형)</h3>
    <table>
      <thead>
        <tr><th>코인명</th><th>현재가</th><th>매수</th><th>매도</th><th>손절</th><th>위험도</th><th>쩔어한마디</th></tr>
      </thead>
      <tbody id="hot-feed"></tbody>
    </table>
  </div>

  <script>
    // ✅ 검색 기능
    async function searchCoin(){
      const query = document.getElementById('search-input').value.trim().toUpperCase();
      if(!query){ alert("코인명을 입력하세요."); return; }
      try{
        const all = await fetch('https://api.upbit.com/v1/market/all').then(r=>r.json());
        const coin = all.find(x=>x.korean_name === query || x.market.replace('KRW-','') === query);
        if(!coin){ alert("코인을 찾을 수 없습니다."); return; }
        const data = await fetch(`https://api.upbit.com/v1/ticker?markets=${coin.market}`).then(r=>r.json());
        const t = data[0], p=t.trade_price, rate=t.signed_change_rate;
        const fmt=v=>v.toLocaleString('ko-KR',{maximumFractionDigits:4});
        document.getElementById('result-card').style.display='block';
        document.getElementById('coin-name').innerText = `${coin.korean_name} (${coin.market})`;
        document.getElementById('price').innerText = fmt(p);
        document.getElementById('buy').innerText = fmt(p*0.988);
        document.getElementById('sell').innerText = fmt(p*1.012);
        document.getElementById('stop').innerText = fmt(p*0.975);
        document.getElementById('risk').innerText = Math.abs(rate*100)<1?'1(안정)':Math.abs(rate*100)<3?'2(보통)':'3(주의)';
        document.getElementById('comment').innerText = rate>0.05?'🔥 불장 진입!':rate>0.02?'📈 상승 지속':'⚖️ 관망 구간';
      }catch(e){console.error('검색 오류',e);}
    }

    function clearResult(){
      document.getElementById('result-card').style.display='none';
      document.getElementById('search-input').value='';
    }

    // ✅ 급등코인 실시간 피드
    let shownCoins = {};
    async function loadHotCoins(){
      try{
        const all = await fetch('https://api.upbit.com/v1/market/all').then(r=>r.json());
        const krw = all.filter(x=>x.market.startsWith('KRW-'));
        const tickers = await fetch('https://api.upbit.com/v1/ticker?markets='+krw.map(x=>x.market).join(',')).then(r=>r.json());

        const hot = tickers.filter(t =>
          t.signed_change_rate > 0.05 && t.acc_trade_price_24h > 10_000_000_000
        ).sort((a,b)=>b.signed_change_rate - a.signed_change_rate);

        const feed = document.getElementById('hot-feed');
        for(const t of hot){
          const symbol = t.market.replace('KRW-','');
          if(shownCoins[symbol]) continue;
          shownCoins[symbol] = true;
          const p=t.trade_price, rate=t.signed_change_rate;
          const fmt=v=>v.toLocaleString('ko-KR',{maximumFractionDigits:4});
          const buy=fmt(p*0.988), sell=fmt(p*1.012), stop=fmt(p*0.975);
          const risk=Math.abs(rate*100)<1?'1(안정)':Math.abs(rate*100)<3?'2(보통)':'3(주의)';
          const comment=rate>0.08?'🚀 폭등 진입!':rate>0.05?'🔥 불장 신호!':'📈 상승 지속';
          const row=document.createElement('tr');
          row.innerHTML=`
            <td>💥 ${symbol}</td>
            <td>${fmt(p)}</td>
            <td>${buy}</td>
            <td>${sell}</td>
            <td>${stop}</td>
            <td>${risk}</td>
            <td>${comment}</td>
          `;
          row.style.textAlign="center";
          feed.prepend(row);
        }
      }catch(e){console.error('급등코인 피드 오류',e);}
    }
    loadHotCoins();
    setInterval(loadHotCoins, 60000);
  </script>
</body>
</html>
