<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì©”ì–´ì§€ê°‘ v5.4 âš¡</title>
  <style>
    body { background:#0d1117; color:#e6edf3; font-family:'Pretendard',sans-serif; text-align:center; }
    h1 { color:#00e6b8; margin:20px; }
    table { width:90%; margin:0 auto; border-collapse:collapse; }
    th,td { padding:10px; border-bottom:1px solid #2d333b; }
    th { color:#58a6ff; }
    tr:hover { background:#161b22; }
    .status { font-weight:bold; color:#0f0; margin:10px; }
  </style>
</head>
<body>
  <h1>ì©”ì–´ì§€ê°‘ v5.4 âš¡ <span class="status">OFFLINE</span></h1>
  <input id="search" placeholder="ì½”ì¸ ê²€ìƒ‰ (ì˜ˆ: ì´ë”ë¦¬ì›€ / ETH / KRW-ETH)" style="width:60%;padding:10px;font-size:16px;">
  <button onclick="searchCoin()">ê²€ìƒ‰</button>
  <button onclick="init()">ì´ˆê¸°í™”</button>

  <h2>ğŸ”¥ ê¸‰ë“±ì½”ì¸ ì‹¤ì‹œê°„ í”¼ë“œ (5%â†‘, 10ì–µâ†‘)</h2>
  <table>
    <thead>
      <tr>
        <th>ì½”ì¸ëª…(í•œê¸€)</th><th>í˜„ì¬ê°€</th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th>
      </tr>
    </thead>
    <tbody id="feed"></tbody>
  </table>

  <script>
    const FEED = document.getElementById('feed');
    const STATUS = document.querySelector('.status');
    const PROXY = "https://corsproxy.io/?";
    const API_BASE = "https://api.upbit.com/v1/";
    const UPBIT_MARKET_ALL = PROXY + API_BASE + "market/all";
    const UPBIT_TICKER = PROXY + API_BASE + "ticker?markets=";
    let nameMap = {};

    // âœ… í•œê¸€ì½”ì¸ëª… ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadMarkets() {
      try {
        const res = await fetch(UPBIT_MARKET_ALL);
        const data = await res.json();
        data.filter(x=>x.market.startsWith("KRW-")).forEach(x=>{
          nameMap[x.market] = x.korean_name;
        });
        STATUS.textContent = "ONLINE";
        STATUS.style.color = "#00ff90";
        return Object.keys(nameMap);
      } catch {
        STATUS.textContent = "OFFLINE (ì¬ì‹œë„ì¤‘)";
        STATUS.style.color = "red";
        return [];
      }
    }

    // âœ… ê¸‰ë“±ì½”ì¸ ìë™ ì—…ë°ì´íŠ¸
    async function loadTickers() {
      const markets = await loadMarkets();
      if (!markets.length) return;
      const res = await fetch(PROXY + API_BASE + "ticker?markets=" + markets.join(","));
      const data = await res.json();
      FEED.innerHTML = "";

      data.filter(t=>t.acc_trade_price_24h > 1000000000 && t.signed_change_rate > 0.05)
          .sort((a,b)=>b.signed_change_rate - a.signed_change_rate)
          .forEach(t=>{
            const name = nameMap[t.market] || t.market;
            const change = (t.signed_change_rate*100).toFixed(2);
            const row = `
              <tr>
                <td>${name}</td>
                <td>${t.trade_price.toLocaleString()}ì›</td>
                <td>${(t.trade_price*0.99).toLocaleString()}</td>
                <td>${(t.trade_price*1.01).toLocaleString()}</td>
                <td>${(t.trade_price*0.97).toLocaleString()}</td>
                <td>${change}%</td>
                <td>${change>10?"ğŸš€ í­ë“± ëª¨ë“œ!":"ğŸ”¥ ì˜ˆì—´ì¤‘"}</td>
              </tr>`;
            FEED.insertAdjacentHTML('beforeend', row);
          });
    }

    // âœ… ê²€ìƒ‰ ê¸°ëŠ¥ (CORS í•´ê²°)
    async function searchCoin() {
      const query = document.getElementById('search').value.trim();
      if (!query) return alert("ê²€ìƒ‰í•  ì½”ì¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš”!");

      const marketKey = Object.keys(nameMap).find(k =>
        k.toUpperCase().includes(query.toUpperCase()) ||
        nameMap[k]?.includes(query)
      );

      if (!marketKey) {
        FEED.innerHTML = `<tr><td colspan="7">âŒ '${query}' ì½”ì¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
        return;
      }

      try {
        const res = await fetch(PROXY + API_BASE + "ticker?markets=" + marketKey);
        const data = await res.json();
        const t = data[0];
        FEED.innerHTML = `
          <tr>
            <td>${nameMap[marketKey]}</td>
            <td>${t.trade_price.toLocaleString()}ì›</td>
            <td>${(t.trade_price*0.99).toLocaleString()}</td>
            <td>${(t.trade_price*1.01).toLocaleString()}</td>
            <td>${(t.trade_price*0.97).toLocaleString()}</td>
            <td>${(t.signed_change_rate*100).toFixed(2)}%</td>
            <td>${t.signed_change_rate>0?"ğŸ“ˆ ìƒìŠ¹ íë¦„":"ğŸ“‰ í•˜ë½ ì£¼ì˜"}</td>
          </tr>`;
      } catch (err) {
        FEED.innerHTML = `<tr><td colspan="7">âš ï¸ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜</td></tr>`;
      }
    }

    function init() {
      FEED.innerHTML = "";
      document.getElementById('search').value = "";
    }

    // âœ… ìë™ ê°±ì‹ 
    setInterval(loadTickers, 15000);
    loadTickers();
  </script>
</body>
</html>
