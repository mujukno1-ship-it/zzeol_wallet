<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì©”ì–´ì§€ê°‘ ğŸ”¥ v10.4 â€” Upbit KRW ì‹¤ì‹œê°„ (ê¸‰ë“±ì½”ì¸ + íƒ€ì /ìœ„í—˜ë„/ì©”ì–´í•œë§ˆë””)</title>
<meta name="color-scheme" content="dark" />
<style>
:root{
  --bg:#0d1117;--card:#161b22;--muted:#98a2b3;--text:#e6edf3;--line:#1f2633;
  --acc:#00c2ff;--good:#18c964;--bad:#ff5c5c;--warn:#ffb020;
  --chip:#202938;--chip-on:#273042;--soft:#0b1320;
}
*{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:14px/1.55 ui-sans-serif,system-ui,apple sd gothic neo,Segoe UI,Roboto,Apple Color Emoji,Segoe UI Emoji}
.wrap{max-width:1220px;margin:28px auto;padding:0 18px}
h1{font-size:18px;margin:0 0 18px 0}
.card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:16px}
.grid{display:grid;gap:14px}
.grid.cols-2{grid-template-columns:1fr 1fr}
.grid.cols-3{grid-template-columns:1fr 1fr 1fr}
.row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media (max-width:1000px){.grid.cols-2,.grid.cols-3,.row{grid-template-columns:1fr}}
.badge{display:inline-flex;gap:6px;align-items:center;background:var(--chip);border:1px solid var(--line);padding:3px 8px;border-radius:999px;color:var(--muted)}
.badge .dot{width:6px;height:6px;border-radius:50%}
.k{color:var(--muted);font-size:12px}
.btn{background:var(--chip);border:1px solid var(--line);padding:8px 12px;border-radius:10px;color:var(--text);cursor:pointer}
.btn:hover{filter:brightness(1.06)}
.input{width:100%;padding:12px 14px;border-radius:10px;background:#0b1320;border:1px solid var(--line);color:var(--text)}
.small{font-size:12px;color:var(--muted)}
.title{font-weight:700;margin:0 0 10px}
.flex{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.kv{display:grid;grid-template-columns:120px 1fr;gap:8px;margin:4px 0}
.sep{height:8px}
.note{padding:10px;border-radius:10px;background:rgba(255,255,255,.03);border:1px dashed var(--line);color:var(--muted)}
.tag{padding:2px 6px;border-radius:16px;border:1px solid var(--line);background:var(--soft);color:var(--muted);font-size:12px}
.good{color:var(--good)} .bad{color:var(--bad)} .warn{color:var(--warn)}
.table{width:100%;border-collapse:collapse;margin-top:6px}
.table th,.table td{border-top:1px solid var(--line);padding:10px 10px;text-align:right;font-variant-numeric:tabular-nums}
.table thead th{position:sticky;top:0;background:var(--card);text-align:right}
.table th:first-child,.table td:first-child{text-align:left}
.rowlink{cursor:pointer}
.chips{display:flex;gap:6px;flex-wrap:wrap}
.pill{padding:4px 8px;border-radius:999px;border:1px solid var(--line);background:var(--chip);font-size:12px;color:var(--muted)}
.status{padding:2px 8px;border-radius:999px;border:1px solid var(--line);background:#0c1a12}
.status.bad{background:#1c0e0e}
.search-bar{display:grid;grid-template-columns:1fr 150px 150px;gap:10px}
@media (max-width:880px){.search-bar{grid-template-columns:1fr 1fr}}
.biginput{padding:14px 16px;font-size:16px}
.emph{font-weight:800}
.code{font-family:ui-monospace,Menlo,Consolas,monospace}
</style>
</head>
<body>
<div class="wrap">
  <div class="flex" style="justify-content:space-between">
    <h1>ì©”ì–´ì§€ê°‘ ğŸ”¥ <span class="k">v10.4 â€” Upbit KRW ì‹¤ì‹œê°„</span></h1>
    <div class="chips">
      <span class="pill">ìƒíƒœ: <b id="ws-status" class="good">ì •ìƒ ì—°ê²°</b></span>
      <span class="pill">ë¶„ë´‰
        <select id="tf" class="input" style="width:86px;padding:4px 6px">
          <option value="1">1ë¶„</option><option value="3">3ë¶„</option>
          <option value="5" selected>5ë¶„</option><option value="10">10ë¶„</option>
          <option value="15">15ë¶„</option><option value="30">30ë¶„</option>
          <option value="60">60ë¶„</option>
        </select>
      </span>
    </div>
  </div>

  <!-- ê²€ìƒ‰ / ëª©ë¡ì¤„ (ìš”ì²­: ê²€ìƒ‰ ë°”ë¡œ ì•„ë˜ ì½”ì¸ëª©ë¡) -->
  <div class="card">
    <div class="title">ì½”ì¸ ê²€ìƒ‰</div>
    <div class="search-bar">
      <input id="search" class="input biginput" placeholder="í•œê¸€/ì˜ë¬¸/ì‹¬ë³¼: ë¹„íŠ¸ì½”ì¸, BTC, SHIB ë“±" />
      <button id="btn-refresh" class="btn">KRW ëª©ë¡ ìƒˆë¡œê³ ì¹¨</button>
      <button id="btn-pump" class="btn">ğŸš€ íŒí”„ë ˆì´ë” ê°±ì‹ </button>
    </div>
    <div class="small" style="margin-top:8px">KRW ë§ˆì¼“ë§Œ í‘œì‹œ. í–‰ í´ë¦­ ì‹œ ìƒì„¸-ì‹ í˜¸ ì¦‰ì‹œ ê°±ì‹ .</div>
  </div>

  <div class="card" style="margin-top:12px">
    <div class="title">KRW ì½”ì¸ ëª©ë¡ (ì‹¤ì‹œê°„)</div>
    <table class="table" id="tbl-list">
      <thead><tr>
        <th style="width:90px">ì‹¬ë³¼</th>
        <th>ì½”ì¸ëª…(í•œê¸€)</th>
        <th style="width:120px">í˜„ì¬ê°€</th>
        <th style="width:90px">ë“±ë½ë¥ </th>
        <th style="width:140px">ê±°ë˜ëŒ€ê¸ˆ(24h)</th>
        <th style="width:90px">íƒœê·¸</th>
      </tr></thead>
      <tbody id="list-body"></tbody>
    </table>
  </div>

  <div class="grid cols-2" style="margin-top:14px">
    <div class="card">
      <div class="title">ì„ íƒ ì½”ì¸</div>
      <div class="kv"><div class="k">ì´ë¦„</div><div id="s-name">-</div></div>
      <div class="kv"><div class="k">ì‹¬ë³¼</div><div id="s-symbol">-</div></div>
      <div class="kv"><div class="k">í˜„ì¬ê°€</div><div id="s-price">-</div></div>
      <div class="kv"><div class="k">ë“±ë½ë¥ (24h)</div><div id="s-chg">-</div></div>
      <div class="kv"><div class="k">ê±°ë˜ëŒ€ê¸ˆ(24h)</div><div id="s-vol">-</div></div>
      <div class="kv"><div class="k">í‹± ì²´ê°ê°•ë„</div><div id="s-tick">-</div></div>
    </div>

    <div class="card">
      <div class="title">ì†ì ˆÂ·ìœ„í—˜ë„Â·ì©”ì–´í•œë§ˆë””</div>
      <div class="kv"><div class="k">ì†ì ˆ</div><div id="s-sl">-</div></div>
      <div class="kv"><div class="k">ìœ„í—˜ë„</div><div id="s-risk">-</div></div>
      <div class="kv"><div class="k">ì©”ì–´í•œë§ˆë””</div><div id="s-says">-</div></div>
    </div>

    <div class="card">
      <div class="title">ìœ ë™ì„±Â·ë³€ë™ì„±</div>
      <div class="kv"><div class="k">EMA20</div><div id="m-ema">-</div></div>
      <div class="kv"><div class="k">ATR(14)</div><div id="m-atr">-</div></div>
      <div class="kv"><div class="k">EMA ê¸°ìš¸ê¸°</div><div id="m-slope">-</div></div>
      <div class="kv"><div class="k">ë¸”ë™ìŠ¤ì™„ ê°ì§€</div><div id="m-black">-</div></div>
    </div>

    <div class="card">
      <div class="title">ë§¤ë„(ìµì ˆ) íƒ€ì </div>
      <div class="kv"><div class="k">TP1</div><div id="tp1">-</div></div>
      <div class="kv"><div class="k">TP2</div><div id="tp2">-</div></div>
      <div class="kv"><div class="k">TP3</div><div id="tp3">-</div></div>
      <div class="note small" style="margin-top:10px">ê¸°ë³¸ ë£°: í˜„ì¬ê°€ ê¸°ì¤€ ATRÃ—(1.0, 1.6, 2.2) ëª©í‘œ.</div>
    </div>

    <div class="card">
      <div class="title">ë§¤ìˆ˜ íƒ€ì </div>
      <ul class="small" id="long-signals" style="margin:0 0 8px 18px"></ul>
      <div class="note small">ê¸°ë³¸ ë£°: EMA20 ê·¼ì²˜ ëˆŒë¦¼ + ATR ê¸°ë°˜ ë¶„í• ì§„ì….</div>
    </div>

    <div class="card">
      <div class="title">ê¸‰ë“±ì½”ì¸ ì•Œë¦¼ (Pump Radar)</div>
      <div class="small">ìµœê·¼ ê¸‰ë“±/ê¸‰ë½ íƒœê·¸ëŠ” 3ë¶„ ë™ì•ˆ ìœ ì§€ë©ë‹ˆë‹¤.</div>
      <div id="pump-list" class="chips" style="margin-top:8px"></div>
    </div>
  </div>

  <div class="sep"></div>
  <div class="small k">Â© 2025 ì©”ì–´ì§€ê°‘ â€” ì‹¤ì‹œê°„ KRW | proxy ê²½ë¡œ: <span class="code">/upbit/*</span> (ë¯¸ì¡´ì¬ì‹œ ê³µì‹ APIë¡œ ìë™ ëŒ€ì²´). ë‹¨ê°€ê°€ 1ì› ë¯¸ë§Œì¸ ì½”ì¸ì€ **ì†Œìˆ˜ 8ìë¦¬**ê¹Œì§€ í‘œê¸°í•©ë‹ˆë‹¤.</div>
</div>

<script>
/* ============= ê¸°ë³¸ ì„¤ì • ============= */
const API_BASE = "";                 // ë°°í¬ì—ì„œ /upbit í”„ë¡ì‹œ ìˆëŠ” ê²½ìš° '' ìœ ì§€
const U = {
  marketAll: () => pick([
    `${API_BASE}/upbit/market/all?isDetails=true`,
    `https://api.upbit.com/v1/market/all?isDetails=true`
  ]),
  ticker: (mk) => pick([
    `${API_BASE}/upbit/ticker?markets=${mk}`,
    `https://api.upbit.com/v1/ticker?markets=${mk}`
  ]),
  candles: (unit, mk, n=120) => pick([
    `${API_BASE}/upbit/candles/minutes/${unit}?market=${mk}&count=${n}`,
    `https://api.upbit.com/v1/candles/minutes/${unit}?market=${mk}&count=${n}`
  ])
};
function pick(arr){ return arr[0]; } // í”„ë¡ì‹œ ìœ íš¨í•˜ë©´ ê·¸ëŒ€ë¡œ 0ë²ˆì´ ì‘ë™

/* ============= ìœ í‹¸ ============= */
const fmtKRW = (x)=>{
  if (x===0) return "0";
  if (x<1) return x.toFixed(8).replace(/0+$/,'').replace(/\.$/,'');
  return Math.round(x).toLocaleString('ko-KR');
};
const pct = v => (v>0?`<span class="good">+${v.toFixed(2)}%</span>`:
                   v<0?`<span class="bad">${v.toFixed(2)}%</span>`:`0.00%`);
const shortKRW = v => {
  if (v>=1e12) return (v/1e12).toFixed(2)+"ì¡°ì›";
  if (v>=1e8)  return (v/1e8).toFixed(2)+"ì–µì›";
  if (v>=1e4)  return (v/1e4).toFixed(2)+"ë§Œì›";
  return fmtKRW(v)+"ì›";
};
const sleep = ms=>new Promise(r=>setTimeout(r,ms));

/* ============= ì „ì—­ìƒíƒœ ============= */
let KRW_LIST = [];      // [{market, korean_name, english_name}]
let TICKERS = {};       // { KRW-BTC: {trade_price, acc_trade_price_24h, signed_change_rate ...} }
let BURST_TAG = new Map(); // {market: timestamp} ê¸‰ë“±/ê¸‰ë½ íƒœê·¸ ìœ ì§€
const TAG_KEEP_MS = 180000;

/* ============= ì´ˆê¸°í™” ============= */
const $ = sel => document.querySelector(sel);
const $$ = sel => document.querySelectorAll(sel);

const listBody = $('#list-body');
const pumpBox = $('#pump-list');
const search = $('#search');
const tfSel = $('#tf');

init();
async function init(){
  bindUI();
  await loadMarkets();
  await refreshList();
  runPumpRadar();
  setInterval(cleanTags, 10000);
}

function bindUI(){
  $('#btn-refresh').onclick = refreshList;
  $('#btn-pump').onclick = runPumpRadar;
  search.oninput = ()=>renderList();
  tfSel.onchange = ()=> { if (SEL) selectCoin(SEL.market); };
}

/* ============= ì—…ë¹„íŠ¸ ë°ì´í„° ============= */
async function loadMarkets(){
  const res = await fetch(U.marketAll());
  const raw = await res.json();
  KRW_LIST = raw.filter(x=>x.market?.startsWith('KRW-'))
    .map(x=>({market:x.market, korean:x.korean_name, english:x.english_name}));
}

/* Ticker ëª¨ë‘ ê°€ì ¸ì˜¤ê¸° (ë¶€í•˜ ì¤„ì´ë ¤ê³  120ê°œì”© ì²­í¬ ìš”ì²­) */
async function refreshList(){
  const chunks = [];
  const mk = KRW_LIST.map(x=>x.market);
  for(let i=0;i<mk.length;i+=120) chunks.push(mk.slice(i, i+120));
  for(const c of chunks){
    const res = await fetch(U.ticker(c.join(',')));
    const arr = await res.json();
    for(const t of arr) TICKERS[t.market]=t;
    await sleep(150);
  }
  renderList();
}

/* ============= ëª©ë¡/ê²€ìƒ‰/ì„ íƒ ============= */
function renderList(){
  const q = (search.value||"").trim().toLowerCase();
  const rows = [];
  for(const it of KRW_LIST){
    const t = TICKERS[it.market];
    if(!t) continue;
    const nameKo = it.korean, sym = it.market.replace('KRW-','');
    if(q && !(nameKo.includes(q) || sym.toLowerCase().includes(q) || it.english?.toLowerCase().includes(q))) continue;

    const chg = (t.signed_change_rate||0)*100;
    const vol = t.acc_trade_price_24h||0;
    const tag = tagFor(it.market, chg);

    rows.push(`
      <tr class="rowlink" data-m="${it.market}">
        <td><b>${sym}</b></td>
        <td>${nameKo}</td>
        <td>${fmtKRW(t.trade_price||0)}</td>
        <td>${pct(chg)}</td>
        <td>${shortKRW(vol)}</td>
        <td class="k">${tag||''}</td>
      </tr>
    `);
  }
  listBody.innerHTML = rows.join('') || `<tr><td colspan="6" class="k">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</td></tr>`;
  [...$$('.rowlink')].forEach(tr=>{
    tr.onclick=()=>selectCoin(tr.dataset.m);
  });
}

let SEL=null;
async function selectCoin(market){
  SEL = KRW_LIST.find(x=>x.market===market);
  if(!SEL) return;
  const t = TICKERS[market] || (await fetch(U.ticker(market)).then(r=>r.json()).then(a=>a[0]));
  TICKERS[market]=t;

  // ìƒë‹¨ ì¹´ë“œ ì±„ìš°ê¸°
  $('#s-name').innerText = SEL.korean;
  $('#s-symbol').innerText = market.replace('KRW-','');
  $('#s-price').innerHTML = `<b class="emph">${fmtKRW(t.trade_price||0)}</b>`;
  $('#s-chg').innerHTML = pct((t.signed_change_rate||0)*100);
  $('#s-vol').innerText = shortKRW(t.acc_trade_price_24h||0);
  $('#s-tick').innerText = tickStrength(t);

  // ë¶„ë´‰ ìº”ë“¤ ë°ì´í„°ë¡œ ì§€í‘œ/íƒ€ì  ì‚°ì¶œ
  const unit = +tfSel.value || 5;
  const cs = await fetch(U.candles(unit, market, 120)).then(r=>r.json());
  calcSignals(market, cs, t.trade_price||0);
}

/* ============= ì§€í‘œ/ì‹ í˜¸ ============= */
function ema(arr, p){
  const k = 2/(p+1); let ema = arr[0];
  for(let i=1;i<arr.length;i++){ ema = arr[i]*k + ema*(1-k); }
  return ema;
}
function atr(candles, p=14){
  // upbit ë¶„ë´‰ candlestick: {high_price, low_price, trade_price, prev_closing_price}
  const trs=[];
  for(let i=0;i<candles.length;i++){
    const c=candles[i], prev = candles[i+1]||c;
    const tr = Math.max(
      c.high_price - c.low_price,
      Math.abs(c.high_price - prev.trade_price),
      Math.abs(c.low_price - prev.trade_price)
    );
    trs.push(tr);
  }
  trs.reverse(); // ì˜¤ë˜ëœ -> ìµœì‹ 
  return ema(trs, p);
}
function slope(vals){
  // ê°„ë‹¨í•œ ê¸°ìš¸ê¸° (ë§ˆì§€ë§‰-ì²«)/ì²«
  if(vals.length<2) return 0;
  const a = vals[0], b = vals[vals.length-1];
  return (b-a)/Math.max(1e-9, a);
}
function tickStrength(t){
  // ë‹¨ìˆœ ì§€í‘œ: ë³€ë™ì†ë„ ê·¼ì‚¬ì¹˜ (ê³ ê¸‰ ì•„ë‹˜)
  const r = ((t.signed_change_rate||0)*100).toFixed(2);
  const rank = t.trade_volume? Math.round((t.trade_volume%100)) : 0;
  return `${r}% (${rank}/54)`;
}

function inferSays(ctx){
  // ì©”ì–´í•œë§ˆë”” ê·œì¹™ (ê°„ë‹¨)
  const {chg, emaSlope, atrVal, price, ema20} = ctx;
  if (price<1) { // ì´ˆì €ê°€ ì½”ì¸
    if (chg>2 && emaSlope>0) return {text:"ë‹¨íƒ€ ë§¤ìˆ˜(ì†Œì•¡)", tone:"good"};
    if (chg<-2) return {text:"ê³¼ë§¤ë„ ë°˜ë“± ëŒ€ê¸°", tone:"warn"};
  }
  if (emaSlope>0.004 && price>ema20) return {text:"ìƒìŠ¹ ì¶”ì„¸ ì¶”ì¢…, ë¶„í•  ë§¤ìˆ˜", tone:"good"};
  if (emaSlope<-0.004 && price<ema20) return {text:"í•˜ë½ ì¶”ì„¸, ë°˜ë“± ë§¤ë„/í˜„ê¸ˆ", tone:"bad"};
  if (Math.abs(chg)<0.5) return {text:"íš¡ë³´ êµ¬ê°„, ê´€ë§", tone:"warn"};
  return {text:"ì¤‘ë¦½ â€” ëˆŒë¦¼ ëŒ€ê¸°", tone:"warn"};
}

function riskScore(ctx){
  // 0~5 ì ìˆ˜
  let r=2.5;
  if (ctx.price<1) r+=0.7;           // ì´ˆì €ê°€ ë¦¬ìŠ¤í¬
  if (Math.abs(ctx.chg)>5) r+=0.8;   // ë‹¹ì¼ í° ë³€ë™
  r += Math.min(2, Math.abs(ctx.emaSlope)*50);
  r = Math.max(0, Math.min(5, r));
  return r.toFixed(1);
}

function blackSwan(candles){
  // ìµœê·¼ 10ê°œ ë´‰ì—ì„œ ë¹„ì •ìƒ í­ë½ ê°ì§€
  const n = Math.min(10, candles.length);
  let cnt=0;
  for(let i=0;i<n;i++){
    const c=candles[i];
    const drop = (c.opening_price - c.trade_price)/Math.max(1e-9,c.opening_price)*100;
    if (drop>4) cnt++;
  }
  if (cnt>=2) return "ì£¼ì˜ (ë³€ë™ ê¸‰ì¦)";
  return "ì •ìƒ";
}

function buySignals(price, ema20, atr14){
  const arr=[];
  if (price<=ema20 && (ema20-price)<=atr14*0.6) arr.push(`EMA20 ëˆŒë¦¼ ì§„ì…`);
  if (price<ema20 && (ema20-price)<=atr14*1.2) arr.push(`ë¶„í• (1/2) ì§„ì…`);
  if (!arr.length) arr.push(`-`);
  return arr;
}

function sellTargets(price, atr14){
  return {
    tp1: price + atr14*1.0,
    tp2: price + atr14*1.6,
    tp3: price + atr14*2.2,
  };
}

function put(id, html){ $(id).innerHTML = html; }

function listToUL(id, arr){
  const ul=$(id); ul.innerHTML = arr.map(x=>`<li>${x}</li>`).join('');
}

function calcSignals(market, candles, lastPrice){
  // candles: ìµœì‹ ì´ [0] ì´ë¼ ì—­ìˆœ í•„ìš”
  const prices = candles.map(c=>c.trade_price).reverse();
  const ema20 = ema(prices, 20), atr14 = atr(candles, 14);
  const emaSlope = slope(prices.slice(-20));
  const chg = (TICKERS[market]?.signed_change_rate||0)*100 || 0;

  // ë¸”ë™ìŠ¤ì™„
  $('#m-black').innerHTML = blackSwan(candles);

  // ì§€í‘œ í‘œì‹œ
  $('#m-ema').innerHTML = fmtKRW(ema20);
  $('#m-atr').innerHTML = fmtKRW(atr14);
  $('#m-slope').innerHTML = (emaSlope>=0?'<span class="good">+':'<span class="bad">')+(emaSlope*100).toFixed(2)+'%</span>';

  // ë§¤ìˆ˜ íƒ€ì 
  const buys = buySignals(lastPrice, ema20, atr14);
  listToUL('#long-signals', buys);

  // ë§¤ë„ íƒ€ì 
  const {tp1,tp2,tp3} = sellTargets(lastPrice, atr14);
  $('#tp1').innerHTML = fmtKRW(tp1);
  $('#tp2').innerHTML = fmtKRW(tp2);
  $('#tp3').innerHTML = fmtKRW(tp3);

  // ì†ì ˆ / ìœ„í—˜ë„ / í•œë§ˆë””
  const sl = Math.max(0, lastPrice - atr14*1.0);
  $('#s-sl').innerHTML = fmtKRW(sl);

  const ctx = {chg, emaSlope, atrVal:atr14, price:lastPrice, ema20};
  const risk = riskScore(ctx);
  const says = inferSays(ctx);
  $('#s-risk').innerHTML = `${risk} / 5.0`;
  $('#s-says').innerHTML = `<span class="${says.tone}">${says.text}</span>`;
}

/* ============= Pump Radar ============= */
function tagFor(market, changePct){
  // ê¸‰ë“±/ê¸‰ë½ íƒœê·¸ í‘œì‹œ + 3ë¶„ ìœ ì§€
  const now=Date.now(), keep = BURST_TAG.get(market);
  if (keep && (now-keep)<TAG_KEEP_MS){
    return `<span class="tag">ê¸‰${changePct>=0?'ë“±':'ë½'}</span>`;
  }
  if (Math.abs(changePct)>=5){
    BURST_TAG.set(market, now);
    return `<span class="tag">ê¸‰${changePct>=0?'ë“±':'ë½'}</span>`;
  }
  return "";
}
function cleanTags(){
  const now=Date.now();
  for(const [k,v] of BURST_TAG.entries()){
    if (now-v>TAG_KEEP_MS) BURST_TAG.delete(k);
  }
  renderList();
}
function topByVol(n=6){
  const arr = KRW_LIST.map(x=>{
    const t=TICKERS[x.market]; if(!t) return null;
    return {m:x.market, name:x.korean, vol:t.acc_trade_price_24h||0, chg:(t.signed_change_rate||0)*100, price:t.trade_price||0};
  }).filter(Boolean);
  arr.sort((a,b)=>b.vol-a.vol);
  return arr.slice(0,n);
}
function runPumpRadar(){
  const tops = topByVol(8);
  pumpBox.innerHTML = tops.map(x=>{
    const tag = Math.abs(x.chg)>=5? 'ê¸‰ë“±':'ë³´í†µ';
    return `<span class="pill rowlink" data-m="${x.m}">
      <b>${x.m.replace('KRW-','')}</b> Â· ${pct(x.chg)} Â· ${shortKRW(x.vol)} Â· <span class="k">${tag}</span>
    </span>`;
  }).join('');
  [...pumpBox.querySelectorAll('.rowlink')].forEach(el=>{
    el.onclick=()=>selectCoin(el.dataset.m);
  });
}

/* ============= ì²˜ìŒ ìë™ ì„ íƒ ============= */
let firstSelected=false;
const autoPick = setInterval(()=>{
  if(firstSelected) return;
  if (KRW_LIST.length && Object.keys(TICKERS).length){
    const top = topByVol(1)[0];
    if (top){ firstSelected=true; selectCoin(top.m); }
    clearInterval(autoPick);
  }
}, 800);
</script>
</body>
</html>
