<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>사토시의지갑 ⚡ SPARK 단타 완전체</title>
<style>
  body { font-family: 'Pretendard', sans-serif; background:#0d1117; color:#f0f6fc; margin:0; padding:0; }
  #search-bar { position:fixed; top:0; width:100%; background:#161b22; padding:10px; z-index:1000; display:flex; justify-content:center; }
  input { width:90%; padding:10px; border:none; border-radius:6px; font-size:16px; background:#21262d; color:#fff; }
  .section { margin-top:70px; padding:10px; }
  h2 { margin:15px 0 8px; color:#58a6ff; }
  .coin-card { background:#161b22; margin-bottom:10px; border-radius:8px; padding:10px; box-shadow:0 0 4px #30363d; }
  .coin-card strong { color:#58a6ff; }
  .danger { color:#f85149; }
  .warn { color:#d29922; }
  .safe { color:#3fb950; }
  .neutral { color:#9e9e9e; }
</style>
</head>
<body>
  <div id="search-bar">
    <input type="text" id="search" placeholder="코인명 또는 심볼 검색 (예: 온도, 아카시아, 시바이누)" />
  </div>

  <div class="section" id="spark">
    <h2>🌋 SPARK (예열 코인)</h2>
    <div id="spark-list">불러오는 중...</div>
  </div>

  <div class="section" id="spark-hot">
    <h2>🔥 SPARK 단타 (급등 코인)</h2>
    <div id="spark-hot-list">불러오는 중...</div>
  </div>

  <script>
  const API_BASE = "https://satoshi-proxy.mujukno1.workers.dev/api";

  const fetchCoins = async () => {
    const res = await fetch(`${API_BASE}/upbit/tickers`);
    const data = await res.json();

    // 업비트 호가틱 반올림
    const roundKRW = (price) => {
      if (price >= 100) return Math.round(price);
      if (price >= 10) return (Math.round(price * 10) / 10).toFixed(1);
      if (price >= 1) return (Math.round(price * 100) / 100).toFixed(2);
      return (Math.round(price * 1000) / 1000).toFixed(3);
    };

    // 변동률 기준 분리
    const sparkCoins = [];
    const sparkHotCoins = [];

    data.forEach(c => {
      const change = ((c.trade_price - c.prev_closing_price) / c.prev_closing_price) * 100;
      if (change >= 10) sparkHotCoins.push(c);
      else if (change >= 3) sparkCoins.push(c);
    });

    // 공통 UI 생성 함수
    const createCard = (c, isHot=false) => {
      const riskLv = Math.random() * 5 | 1;
      const colors = ["🟢","🟢🟡","🟡","🟠","🔴"];
      const riskTxt = ["매우 안정","안정","보통","위험","매우 위험"];
      const msgSet = [
        "세력 예열 중, 눌림매수 진입 준비.",
        "세력 돌파 시작, 익절 늦춰 홀딩 권장.",
        "세력 분출 임박, 익절 분할 권장.",
        "세력 이탈 감지, 빠른 청산 필요.",
        "폭등 감지, 추격 진입 자제."
      ];
      const price = roundKRW(c.trade_price);
      const buy = roundKRW(c.trade_price * 0.985);
      const sell = roundKRW(c.trade_price * 1.015);
      const stop = roundKRW(c.trade_price * 0.975);
      const msg = isHot ? msgSet[4] : msgSet[riskLv-1];

      return `
        <div class="coin-card">
          <strong>${isHot ? "🔥" : "🌋"} ${c.korean_name} (${c.market})</strong><br/>
          현재가: ${price}원<br/>
          매수: ${buy}원 / 매도: ${sell}원 / 손절: ${stop}원<br/>
          위험도: ${colors[riskLv-1]} ${riskLv}단계 (${riskTxt[riskLv-1]})<br/>
          💬 쩔어한마디: ${msg}
        </div>`;
    };

    // 렌더링
    document.getElementById("spark-list").innerHTML = sparkCoins.map(c=>createCard(c)).join("");
    document.getElementById("spark-hot-list").innerHTML = sparkHotCoins.map(c=>createCard(c,true)).join("");
  };

  fetchCoins();
  setInterval(fetchCoins, 10000);
  </script>
</body>
</html>
