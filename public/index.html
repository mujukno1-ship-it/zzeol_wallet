<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ì‚¬í† ì‹œì˜ì§€ê°‘ â€” ULTRA & SPARK</title>
  <style>
    /* No-Motion(í™”ë©´ ì›€ì§ì„ ì—†ìŒ) ê¸°ë³¸ ì ìš© */
    * { animation: none !important; transition: none !important; }
    body { margin:0; background:#0b0f14; color:#e8eef5; font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif; }
    .wrap { max-width:1100px; margin:56px auto 24px; padding:0 16px; }
.topbar { padding:8px 12px; }
    /* ìƒë‹¨ ê³ ì • ê²€ìƒ‰ë°” */
    .topbar {
      position:fixed; top:0; left:0; right:0; z-index:9999;
      background:#0b0f14; border-bottom:1px solid #1b2430;
      padding:10px 16px; display:flex; gap:8px; align-items:center;
    }
    .badge { padding:6px 10px; border:1px solid #253044; border-radius:10px; font-size:12px; opacity:.9; }
    .search { flex:1; display:flex; gap:8px; }
    .search input {
      flex:1; background:#0e131b; color:#e8eef5; border:1px solid #253044; border-radius:10px;
      padding:10px 12px; outline:none;
    }
    .btn { background:#132033; border:1px solid #2b3a52; color:#cfe2ff; padding:10px 14px; border-radius:10px; cursor:pointer; }
    .grid { display:grid; grid-template-columns:1fr; gap:12px; }
    @media (min-width:900px){ .grid{ grid-template-columns:repeat(3,1fr); } }
    .card { background:#0e131b; border:1px solid #253044; border-radius:14px; padding:14px; min-height:84px; }
    .title { font-size:14px; color:#a6b6d1; margin-bottom:6px; }
    .val { font-size:20px; font-weight:700; }
    .sub { font-size:12px; color:#8ea3c1; margin-top:2px; }
    .sectionTitle { font-weight:800; margin:18px 0 8px; color:#dfe9f8; }
    .hint { color:#8ea3c1; font-size:12px; margin-top:12px; }
    /* SPARK ë¦¬ìŠ¤íŠ¸ ìë¦¬(ê¸°ëŠ¥ ìœ ì§€) */
    table { width:100%; border-collapse:collapse; }
    th,td { padding:8px 6px; border-bottom:1px solid #1b2430; font-size:13px; }
    th { text-align:left; color:#9db2cf; }
  </style>
</head>
<body>
  <!-- ìƒë‹¨ ê³ ì • ë°” -->
  <div class="topbar">
    <span class="badge">/health</span>
    <span class="badge">/markets</span>
    <span class="badge">/premium</span>
    <span class="badge">/onchain</span>
    <div class="search">
      <input id="q" placeholder="ì½”ì¸ëª…(í•œê¸€) ë˜ëŠ” í‹°ì»¤(KRW-BTC) â€” í˜„ì¬ê°€Â·ë§¤ìˆ˜Â·ë§¤ë„Â·ì†ì ˆÂ·ìœ„í—˜ë„Â·ì©”ì–´í•œë§ˆë””" />
      <button id="searchBtn" class="btn">ì‹œê·¸ë„ ë¶ˆëŸ¬ì˜¤ê¸°</button>
    </div>
  </div>

  <div class="wrap">
    <!-- ì‹œì¥ ìš”ì•½ -->
    <div class="sectionTitle">ì‹œì¥ ìš”ì•½ (ê¹€í”„Â·í™˜ìœ¨Â·ì˜¨ì²´ì¸)</div>
    <div class="grid">
      <div class="card"><div class="title">KR ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„</div><div id="kimchi" class="val">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div><div id="kimchiSub" class="sub"></div></div>
      <div class="card"><div class="title">USD/KRW í™˜ìœ¨</div><div id="fx" class="val">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div><div id="fxSub" class="sub"></div></div>
      <div class="card"><div class="title">ì˜¨ì²´ì¸ TVL (Ethereum)</div><div id="tvl" class="val">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div><div id="tvlSub" class="sub"></div></div>
    </div>

    <div class="sectionTitle" style="margin-top:22px;">âš¡ SPARK (ì˜ˆì—´ ì½”ì¸)</div>
    <div class="card">
      <table>
        <thead><tr><th>ë§ˆì¼“</th><th>í˜„ì¬ê°€</th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th></tr></thead>
        <tbody id="sparkWarm"><tr><td colspan="6">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr></tbody>
      </table>
    </div>

    <div class="sectionTitle">ğŸ”¥ SPARK ë‹¨íƒ€ (ê¸‰ë“± ì½”ì¸)</div>
    <div class="card">
      <table>
        <thead><tr><th>ë§ˆì¼“</th><th>í˜„ì¬ê°€</th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th></tr></thead>
        <tbody id="sparkHot"><tr><td colspan="6">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</td></tr></tbody>
      </table>
    </div>

    <div class="hint">API: https://satoshi-proxy.mujukno1.workers.dev/api Â· KRW/ì—…ë¹„íŠ¸ í˜¸ê°€í‹± ë°˜ì˜¬ë¦¼ Â· ìœ„í—˜ë„(1~5) Â· ì©”ì–´í•œë§ˆë””</div>
  </div>

  <script>
    // ===== í”„ë¡ì‹œ ë² ì´ìŠ¤ =====
    const API_BASE = 'https://satoshi-proxy.mujukno1.workers.dev/api';

    async function getJSON(path){
      const r = await fetch(`${API_BASE}${path}`, { method:'GET' });
      if(!r.ok) throw new Error(`${path} -> ${r.status}`);
      return r.json();
    }

    // ===== ìš”ì•½ ë°•ìŠ¤ ë¡œë”© =====
    async function loadSummary(){
      try{
        const prem = await getJSON('/premium');   // ê¹€í”„/í™˜ìœ¨
        const onch = await getJSON('/onchain');   // TVL

        // ê¹€í”„
        const kp = prem?.premium?.kimchi_pct ?? null;
        const upbit = prem?.premium?.upbit_krw_btc ?? null;
        const ref = prem?.premium?.krw_from_usdt ?? null;
        document.getElementById('kimchi').textContent =
          kp === null ? 'â€”' : `${kp.toFixed(2)}%`;
        document.getElementById('kimchiSub').textContent =
          (upbit && ref) ? `Upbit KRW-BTC: ${Math.round(upbit).toLocaleString()}ì› Â· ì°¸ê³ í™˜ì‚°: ${Math.round(ref).toLocaleString()}ì›` : '';

        // í™˜ìœ¨
        const usdkrw = prem?.premium?.usdkrw ?? null;
        document.getElementById('fx').textContent =
          usdkrw ? `${usdkrw.toLocaleString()} KRW` : 'â€”';
        document.getElementById('fxSub').textContent = prem?.fear_greed
          ? `Fear&Greed: ${prem.fear_greed.value} (${prem.fear_greed.classification})`
          : '';

        // TVL
        const tvl = onch?.rows?.tvl_usd ?? null;
        document.getElementById('tvl').textContent =
          tvl ? `$ ${Math.round(tvl).toLocaleString()}` : 'â€”';
        document.getElementById('tvlSub').textContent = 'DefiLlama ê¸°ì¤€';
      }catch(e){
        document.getElementById('kimchi').textContent = 'ë¡œë”© ì‹¤íŒ¨';
        document.getElementById('fx').textContent = 'ë¡œë”© ì‹¤íŒ¨';
        document.getElementById('tvl').textContent = 'ë¡œë”© ì‹¤íŒ¨';
        console.error(e);
      }
    }

    // ===== SPARK ìë¦¬ â€” ê¸°ì¡´ ê¸°ëŠ¥ ìœ ì§€(ë°ì´í„°ëŠ” ì¶”í›„ ì •í™• ì‹ í˜¸ ì—°ë™) =====
    function renderSparkPlaceholders(){
      const rowsWarm = [
        {m:'KRW-WAXP', p:'â€”', buy:'â€”', sell:'â€”', sl:'â€”', r:'3'},
        {m:'KRW-PUNDIX', p:'â€”', buy:'â€”', sell:'â€”', sl:'â€”', r:'3'},
      ];
      const rowsHot = [
        {m:'KRW-BEAM', p:'â€”', buy:'â€”', sell:'â€”', sl:'â€”', r:'4'},
        {m:'KRW-FIL', p:'â€”', buy:'â€”', sell:'â€”', sl:'â€”', r:'4'},
      ];
      const warm = document.getElementById('sparkWarm');
      const hot  = document.getElementById('sparkHot');
      warm.innerHTML = rowsWarm.map(x=>`<tr><td>${x.m}</td><td>${x.p}</td><td>${x.buy}</td><td>${x.sell}</td><td>${x.sl}</td><td>${x.r}</td></tr>`).join('');
      hot.innerHTML  = rowsHot .map(x=>`<tr><td>${x.m}</td><td>${x.p}</td><td>${x.buy}</td><td>${x.sell}</td><td>${x.sl}</td><td>${x.r}</td></tr>`).join('');
    }

    // ===== ê²€ìƒ‰(ìƒë‹¨ ê³ ì •) â€” í˜„ì¬ê°€Â·ë§¤ìˆ˜Â·ë§¤ë„Â·ì†ì ˆÂ·ìœ„í—˜ë„Â·ì©”ì–´í•œë§ˆë”” í‘œì‹œ ìë¦¬ ìœ ì§€ =====
    document.getElementById('searchBtn').addEventListener('click', async ()=>{
      const q = document.getElementById('q').value.trim();
      if(!q) return;
      // ë‹¤ìŒ ë‹¨ê³„: /api/marketsì—ì„œ KRW-í‹°ì»¤ ë§¤ì¹­ â†’ ì‹œì„¸/íƒ€ì  ê³„ì‚° í˜¸ì¶œ
      alert(`ê²€ìƒ‰: ${q}\n(ë‹¤ìŒ ë‹¨ê³„ì—ì„œ í˜„ì¬ê°€/ë§¤ìˆ˜/ë§¤ë„/ì†ì ˆ/ìœ„í—˜ë„/ì©”ì–´í•œë§ˆë”” ì—°ë™)`);
    });

    // ìµœì´ˆ ë Œë”
    renderSparkPlaceholders();
    loadSummary();
    // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ ìƒë‹¨/ê¸°ì¡´ ë²„íŠ¼ê³¼ ì—°ê²°í•´ë‘ì—ˆë‹¤ë©´ ì£¼ê¸°ì  í˜¸ì¶œë„ ê°€ëŠ¥ (í™”ë©´ê¹œë¹¡ì„ ì—†ìŒ)
  </script>
</body>
</html>
