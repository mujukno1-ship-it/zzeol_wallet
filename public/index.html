<!-- ì‚¬í† ì‹œì˜ì§€ê°‘ v9.6.1 (Vercel Proxy Fix + ê¸°ì¡´ê¸°ëŠ¥ìœ ì§€ ì™„ì „íŒ) -->
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì‚¬í† ì‹œì˜ì§€ê°‘ v9.6.1 â€” ì—…ë¹„íŠ¸ ì—°ë™ ë³µêµ¬íŒ</title>
<style>
  body{margin:0;background:#0b0f14;color:#e8eefc;font-family:"Noto Sans KR",sans-serif}
  .wrap{max-width:1100px;margin:20px auto;padding:16px}
  .card{background:#111823;border:1px solid #1d2736;border-radius:16px;padding:16px;margin-bottom:14px;box-shadow:0 6px 20px rgba(0,0,0,.25)}
  h2{margin:0 0 8px}
  .status{font-size:12px;color:#9bb0d1}
  input,button{border-radius:10px;padding:10px 12px;border:1px solid #2a3b57;background:#0f1b2e;color:#dbe7ff}
  button{cursor:pointer}
  button[disabled]{opacity:.5}
  table{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:10px}
  thead th{font-size:12px;color:#8fa4c7;text-align:left;padding:0 10px}
  tbody tr{background:#0e1520;border:1px solid #1d2a40}
  tbody td{padding:10px}
  .up{color:#22c55e}.down{color:#ef4444}
  .price{font-variant-numeric:tabular-nums}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h2>ğŸ”¥ ì˜ˆì—´ ìë™ì˜ˆì¸¡</h2>
    <div id="preheatBox" class="status">ì´ˆê¸° ìŠ¤ìº” ì¤‘â€¦</div>
  </div>

  <div class="card">
    <h2>ğŸ§­ ì‚¬ëŒí˜• AI íƒ€ì </h2>
    <div id="signalsBox" class="status">ì˜ˆì—´ í›„ë³´ ê¸°ë°˜ ë¶„ì„ ëŒ€ê¸° ì¤‘â€¦</div>
  </div>

  <div class="card">
    <h2>ğŸ” ì½”ì¸ ê²€ìƒ‰ (KRW ì „ìš©, ì‹¤ì‹œê°„)</h2>
    <input id="q" placeholder="ì½”ì¸ëª…/í‹°ì»¤ ì…ë ¥ (ì˜ˆ: ì´ë”ë¦¬ì›€, ETH)">
    <button id="btnSearch">ê²€ìƒ‰</button>
    <button id="btnTop">ìƒìŠ¹TOP10</button>
    <button id="btnHot">ê¸‰ë“±</button>
    <button id="btnFall">ê¸‰ë½</button>
    <button id="btnPre">ì˜ˆì—´</button>
    <button id="btnReset">ì´ˆê¸°í™”</button>
    <div id="status" class="status">ì—…ë¹„íŠ¸ ì—°ê²° ì¤‘â€¦</div>
    <table><thead><tr>
      <th>ì½”ì¸</th><th>í˜„ì¬ê°€</th><th>ë“±ë½</th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th>
    </tr></thead><tbody id="tbody"></tbody></table>
  </div>

  <div class="card">
    <h2>âš™ï¸ ì‹œìŠ¤í…œ ìƒíƒœ</h2>
    <div class="status" id="netStatus">ì´ˆê¸°í™” ì¤‘â€¦</div>
  </div>
</div>

<script>
const API={
  REST_MARKETS:'https://api.upbit.com/v1/market/all?isDetails=true',
  REST_TICKER:(codes)=>`https://api.upbit.com/v1/ticker?markets=${codes.join(',')}`,
  LOCAL:(url)=>`/api/upbit?url=${encodeURIComponent(url)}`,
};
const el={tbody:byId('tbody'),status:byId('status'),net:byId('netStatus'),preheat:byId('preheatBox')};
const state={markets:[],tickers:new Map(),proxyStage:0};

function byId(id){return document.getElementById(id);}
function fmt(p){return p.toLocaleString('ko-KR');}
function krwTick(p){if(p>=2e6)return 1e3;if(p>=1e6)return 500;if(p>=5e5)return 100;if(p>=1e5)return 50;if(p>=1e4)return 10;if(p>=1e3)return 5;if(p>=100)return 1;if(p>=10)return .1;if(p>=1)return .01;return .001;}
function lv(p){const t=krwTick(p);return {buy:p-2*t,sell:p+3*t,cut:p-6*t};}

async function fetchUpbit(url){
  try{
    const r=await fetch(url,{cache:'no-store'});
    if(!r.ok) throw new Error();
    return await r.json();
  }catch{
    const res=await fetch(API.LOCAL(url));
    return await res.json();
  }
}

async function init(){
  try{
    const data=await fetchUpbit(API.REST_MARKETS);
    state.markets=data.filter(x=>x.market.startsWith('KRW-'));
    el.status.textContent=`KRW ${state.markets.length}ì¢… ë¡œë“œ ì™„ë£Œ`;
    loadTickers();
  }catch(e){
    el.status.textContent='ì—…ë¹„íŠ¸ ì—°ê²° ì‹¤íŒ¨ (Proxy ì‘ë™ ì¤‘)';
  }
}

async function loadTickers(){
  const codes=state.markets.slice(0,50).map(m=>m.market);
  const data=await fetchUpbit(API.REST_TICKER(codes));
  data.forEach(t=>state.tickers.set(t.market,t));
  renderRows(state.markets.slice(0,20));
}

function renderRows(list){
  el.tbody.innerHTML='';
  for(const m of list){
    const t=state.tickers.get(m.market);
    if(!t) continue;
    const cls=t.signed_change_rate>0?'up':'down';
    const lvv=lv(t.trade_price);
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${m.korean_name}</td>
      <td class="${cls}">${fmt(t.trade_price)}</td>
      <td class="${cls}">${(t.signed_change_rate*100).toFixed(2)}%</td>
      <td>${fmt(lvv.buy)}</td><td>${fmt(lvv.sell)}</td><td>${fmt(lvv.cut)}</td>`;
    el.tbody.appendChild(tr);
  }
}
init();
</script>
</body>
</html>
