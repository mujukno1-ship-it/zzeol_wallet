<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>ì‚¬í† ì‹œì˜ì§€ê°‘ v12</title>
<style>
body{background:#0c0d10;color:#e9eef4;font-family:Pretendard,system-ui;}
header{background:#0f1115;padding:14px;position:sticky;top:0;z-index:10}
.wrap{max-width:1080px;margin:0 auto;padding:16px}
.btn{background:#151a22;padding:8px 12px;border-radius:10px;border:1px solid #232a35;color:#fff;cursor:pointer}
.box{border:1px solid #1b2230;background:#0f141c;border-radius:16px;padding:16px;margin:16px 0}
.item{display:flex;justify-content:space-between;align-items:center;padding:10px 8px;border-top:1px solid #182133}
.mono{font-family:ui-monospace,monospace}
.gain{color:#62ffa0}.loss{color:#ff6780}
</style>
</head>
<body>
<header class="wrap">
<input id="q" type="text" placeholder="ì½”ì¸ ì´ë¦„ ì…ë ¥ (KRW)" style="width:60%;padding:10px;border-radius:8px;border:1px solid #333;background:#0c121a;color:#fff;">
<button class="btn" onclick="doSearch()">ê²€ìƒ‰</button>
</header>

<main class="wrap">
<section class="box"><b>âš¡ SPARK TOP10</b><div id="spark">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div></section>
<section class="box"><b>ğŸ”¥ ULTRA ì‹œê·¸ë„</b><div id="ultra">ì„ íƒ ì‹œ í‘œì‹œ</div></section>
<section class="box"><b>ğŸ” ê²€ìƒ‰ ê²°ê³¼</b><div id="search">ê²€ìƒ‰ì–´ ì…ë ¥ í›„ í‘œì‹œ</div></section>
</main>

<script>
const API_BASE="https://satoshi-proxy.mujukno1.workers.dev/api";

function roundTickKRW(p){if(p>=2000000)return Math.round(p/1000)*1000;if(p>=1000000)return Math.round(p/500)*500;if(p>=500000)return Math.round(p/100)*100;if(p>=100000)return Math.round(p/50)*50;if(p>=10000)return Math.round(p/10)*10;if(p>=1000)return Math.round(p/5)*5;if(p>=100)return Math.round(p/1)*1;if(p>=10)return Math.round(p/0.1)*0.1;if(p>=1)return Math.round(p/0.01)*0.01;return Math.round(p/0.001)*0.001;}

async function loadSpark(){
  const e=document.getElementById("spark");
  try{
    const r=await fetch(`${API_BASE}/spark/top10`);const d=await r.json();
    e.innerHTML=d.items.map(x=>`<div class="item"><div>${x.name} (${x.market})<br><small>${x.comment} Â· ì˜ˆì—´ê°•ë„ ${x.spark_score}</small></div><div class="mono gain">${x.expected_gain}</div></div>`).join("");
  }catch{e.textContent="SPARK ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨";}
}

async function doSearch(){
  const q=document.getElementById("q").value.trim();
  const e=document.getElementById("search");
  if(!q){e.textContent="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.";return;}
  try{
    const r=await fetch(`${API_BASE}/markets?q=${encodeURIComponent(q)}`);const d=await r.json();
    e.innerHTML=d.items.map(x=>`<div class="item"><div>${x.korean_name} (${x.market})</div><button class="btn" onclick="pick('${x.market}')">ì„ íƒ</button></div>`).join("");
  }catch{e.textContent="ê²€ìƒ‰ ì‹¤íŒ¨";}
}

async function pick(m){
  const e=document.getElementById("ultra");
  e.textContent="ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦";
  const r=await fetch(`${API_BASE}/ultra/signal?market=${m}`);const d=await r.json();
  if(!d.ok){e.textContent="ì‹ í˜¸ ì—†ìŒ";return;}
  const C=3720,tp1=roundTickKRW(C*(1+d.signal.expected_up_pct/100*0.6)),tp2=roundTickKRW(C*(1+d.signal.expected_up_pct/100)),sl=roundTickKRW(C*(1-d.signal.expected_down_pct/100));
  e.innerHTML=`<div>í˜„ì¬ê°€ ${C}ì›<br>ìµì ˆ ${tp1}/${tp2}ì›<br>ì†ì ˆ ${sl}ì›<br>ìœ„í—˜ë„ ${d.signal.risk}</div><div class="mono">${d.comment}</div>`;
}

loadSpark();
</script>
</body>
</html>
