<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì‚¬í† ì‹œì˜ì§€ê°‘ âš¡ SPARK ë‹¨íƒ€ ì™„ì „ì²´</title>
<style>
  body { font-family: 'Pretendard', sans-serif; background:#0d1117; color:#f0f6fc; margin:0; padding:0; }
  #search-bar { position:fixed; top:0; width:100%; background:#161b22; padding:10px; z-index:1000; display:flex; justify-content:center; }
  input { width:90%; padding:10px; border:none; border-radius:6px; font-size:16px; background:#21262d; color:#fff; }
  .section { margin-top:70px; padding:10px; }
  h2 { margin:15px 0 8px; color:#58a6ff; }
  .coin-card { background:#161b22; margin-bottom:10px; border-radius:8px; padding:10px; box-shadow:0 0 4px #30363d; }
  .coin-card strong { color:#58a6ff; }
  .danger { color:#f85149; }
  .warn { color:#d29922; }
  .safe { color:#3fb950; }
  .neutral { color:#9e9e9e; }
</style>
</head>
<body>
  <div id="search-bar">
    <input type="text" id="search" placeholder="ì½”ì¸ëª… ë˜ëŠ” ì‹¬ë³¼ ê²€ìƒ‰ (ì˜ˆ: ì˜¨ë„, ì•„ì¹´ì‹œì•„, ì‹œë°”ì´ëˆ„)" />
  </div>

  <div class="section" id="spark">
    <h2>ğŸŒ‹ SPARK (ì˜ˆì—´ ì½”ì¸)</h2>
    <div id="spark-list">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  </div>

  <div class="section" id="spark-hot">
    <h2>ğŸ”¥ SPARK ë‹¨íƒ€ (ê¸‰ë“± ì½”ì¸)</h2>
    <div id="spark-hot-list">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
  </div>

  <script>
  const API_BASE = "https://satoshi-proxy.mujukno1.workers.dev/api";

  const fetchCoins = async () => {
    const res = await fetch(`${API_BASE}/upbit/tickers`);
    const data = await res.json();

    // ì—…ë¹„íŠ¸ í˜¸ê°€í‹± ë°˜ì˜¬ë¦¼
    const roundKRW = (price) => {
      if (price >= 100) return Math.round(price);
      if (price >= 10) return (Math.round(price * 10) / 10).toFixed(1);
      if (price >= 1) return (Math.round(price * 100) / 100).toFixed(2);
      return (Math.round(price * 1000) / 1000).toFixed(3);
    };

    // ë³€ë™ë¥  ê¸°ì¤€ ë¶„ë¦¬
    const sparkCoins = [];
    const sparkHotCoins = [];

    data.forEach(c => {
      const change = ((c.trade_price - c.prev_closing_price) / c.prev_closing_price) * 100;
      if (change >= 10) sparkHotCoins.push(c);
      else if (change >= 3) sparkCoins.push(c);
    });

    // ê³µí†µ UI ìƒì„± í•¨ìˆ˜
    const createCard = (c, isHot=false) => {
      const riskLv = Math.random() * 5 | 1;
      const colors = ["ğŸŸ¢","ğŸŸ¢ğŸŸ¡","ğŸŸ¡","ğŸŸ ","ğŸ”´"];
      const riskTxt = ["ë§¤ìš° ì•ˆì •","ì•ˆì •","ë³´í†µ","ìœ„í—˜","ë§¤ìš° ìœ„í—˜"];
      const msgSet = [
        "ì„¸ë ¥ ì˜ˆì—´ ì¤‘, ëˆŒë¦¼ë§¤ìˆ˜ ì§„ì… ì¤€ë¹„.",
        "ì„¸ë ¥ ëŒíŒŒ ì‹œì‘, ìµì ˆ ëŠ¦ì¶° í™€ë”© ê¶Œì¥.",
        "ì„¸ë ¥ ë¶„ì¶œ ì„ë°•, ìµì ˆ ë¶„í•  ê¶Œì¥.",
        "ì„¸ë ¥ ì´íƒˆ ê°ì§€, ë¹ ë¥¸ ì²­ì‚° í•„ìš”.",
        "í­ë“± ê°ì§€, ì¶”ê²© ì§„ì… ìì œ."
      ];
      const price = roundKRW(c.trade_price);
      const buy = roundKRW(c.trade_price * 0.985);
      const sell = roundKRW(c.trade_price * 1.015);
      const stop = roundKRW(c.trade_price * 0.975);
      const msg = isHot ? msgSet[4] : msgSet[riskLv-1];

      return `
        <div class="coin-card">
          <strong>${isHot ? "ğŸ”¥" : "ğŸŒ‹"} ${c.korean_name} (${c.market})</strong><br/>
          í˜„ì¬ê°€: ${price}ì›<br/>
          ë§¤ìˆ˜: ${buy}ì› / ë§¤ë„: ${sell}ì› / ì†ì ˆ: ${stop}ì›<br/>
          ìœ„í—˜ë„: ${colors[riskLv-1]} ${riskLv}ë‹¨ê³„ (${riskTxt[riskLv-1]})<br/>
          ğŸ’¬ ì©”ì–´í•œë§ˆë””: ${msg}
        </div>`;
    };

    // ë Œë”ë§
    document.getElementById("spark-list").innerHTML = sparkCoins.map(c=>createCard(c)).join("");
    document.getElementById("spark-hot-list").innerHTML = sparkHotCoins.map(c=>createCard(c,true)).join("");
  };

  fetchCoins();
  setInterval(fetchCoins, 10000);
  </script>
</body>
</html>
