<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>쩔어지갑 전설판 ∞</title>
<style>
  body { background-color:#000; color:#fff; font-family:'Pretendard',sans-serif; margin:0; padding:0; }
  .header { text-align:center; padding:20px; font-size:22px; font-weight:bold; background:#111; border-bottom:1px solid #222; }
  .search-container { text-align:center; padding:15px; }
  input { width:70%; padding:10px; border:none; border-radius:5px; outline:none; font-size:16px; }
  table { width:95%; margin:15px auto; border-collapse:collapse; }
  th,td { padding:10px; text-align:center; border-bottom:1px solid #333; }
  .risk { padding:5px 10px; border-radius:5px; color:#fff; font-weight:bold; }
  .risk-1 { background:#00ff9d; }
  .risk-2 { background:#1abc9c; }
  .risk-3 { background:#f39c12; }
  .risk-4 { background:#e74c3c; }
  .risk-5 { background:#c0392b; }
  .footer { text-align:center; padding:10px; font-size:13px; color:#888; border-top:1px solid #222; }
</style>
</head>
<body>
<div class="header">쩔어지갑 ∞ 전설판 (실시간 매수·매도 타점)</div>
<div class="search-container">
  <input type="text" id="searchInput" placeholder="코인명 또는 심볼 입력 (예: 비트코인, BTC)" onkeyup="searchCoin(event)">
</div>

<table id="coinTable">
  <thead>
    <tr>
      <th>코인명</th><th>현재가</th><th>매수</th><th>매도</th><th>손절</th><th>위험도</th><th>쩔어결론</th>
    </tr>
  </thead>
  <tbody id="coinBody">
    <tr><td colspan="7">데이터 불러오는 중...</td></tr>
  </tbody>
</table>

<div class="footer">© 2025 쩔어지갑 ∞ | 업비트·온체인·김프 실시간 연동</div>

<script>
const coinBody = document.getElementById("coinBody");
const searchInput = document.getElementById("searchInput");
let socket = null;
let allCoins = {};

async function connectUpbit() {
  socket = new WebSocket("wss://api.upbit.com/websocket/v1");
  socket.onopen = () => {
    const msg = JSON.stringify([{ ticket: "test" }, { type: "ticker", codes: ["KRW-BTC","KRW-ETH","KRW-SOL","KRW-XRP","KRW-DOGE","KRW-SHIB","KRW-SPARK"] }]);
    socket.send(msg);
  };
  socket.onmessage = async (event) => {
    const data = await event.data.arrayBuffer();
    const text = new TextDecoder("utf-8").decode(data);
    const json = JSON.parse(text);
    const code = json.code;
    const price = json.trade_price;
    allCoins[code] = price;
    updateTable();
  };
}

function updateTable() {
  let html = "";
  const codes = Object.keys(allCoins);
  if (codes.length === 0) {
    coinBody.innerHTML = `<tr><td colspan="7">데이터 수신 대기중...</td></tr>`;
    return;
  }
  for (const code of codes) {
    const price = allCoins[code];
    const name = code.replace("KRW-","");
    const buy = (price * 0.995).toFixed(1);
    const sell = (price * 1.005).toFixed(1);
    const stop = (price * 0.985).toFixed(1);
    const riskLevel = calcRisk(price);
    const riskClass = `risk-${riskLevel}`;
    const comment = genComment(riskLevel);
    html += `<tr>
      <td>${name}</td>
      <td>${price.toLocaleString()}원</td>
      <td>${buy}</td>
      <td>${sell}</td>
      <td>${stop}</td>
      <td><span class="risk ${riskClass}">${riskLevel}</span></td>
      <td>${comment}</td>
    </tr>`;
  }
  coinBody.innerHTML = html;
}

function calcRisk(price) {
  if (price < 100) return 1;
  if (price < 1000) return 2;
  if (price < 10000) return 3;
  if (price < 100000) return 4;
  return 5;
}

function genComment(risk) {
  switch (risk) {
    case 1: return "저위험, 분할매수 구간";
    case 2: return "안정적, 매수 가능";
    case 3: return "중립, 관망 구간";
    case 4: return "고위험, 손절 유의";
    case 5: return "매도 주의, 세력 구간";
  }
}

function searchCoin(event) {
  const key = event.target.value.trim().toUpperCase();
  const match = Object.entries(allCoins).filter(([k]) => k.includes(key));
  if (match.length === 0) return;
  const [code, price] = match[0];
  const name = code.replace("KRW-","");
  const buy = (price * 0.995).toFixed(1);
  const sell = (price * 1.005).toFixed(1);
  const stop = (price * 0.985).toFixed(1);
  const riskLevel = calcRisk(price);
  const riskClass = `risk-${riskLevel}`;
  const comment = genComment(riskLevel);
  coinBody.innerHTML = `<tr>
      <td>${name}</td>
      <td>${price.toLocaleString()}원</td>
      <td>${buy}</td>
      <td>${sell}</td>
      <td>${stop}</td>
      <td><span class="risk ${riskClass}">${riskLevel}</span></td>
      <td>${comment}</td>
    </tr>`;
}

connectUpbit();
</script>
</body>
</html>
