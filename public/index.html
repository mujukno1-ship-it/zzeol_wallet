<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>쩔어지갑 — 타점 메모장</title>
<style>
body{margin:0;font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto}
.wrap{max-width:960px;margin:24px auto;padding:0 16px}
h1{font-size:18px;margin:0 0 10px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin:10px 0}
textarea{width:100%;min-height:380px;font:13px/1.5 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;border:1px solid #ddd;border-radius:10px;padding:12px}
button,select{padding:10px 12px;border-radius:10px;border:1px solid #ccc;background:#f7f7f7;cursor:pointer}
.small{color:#666;font-size:12px}
pre{background:#f4f4f4;border:1px solid #e5e5e5;padding:10px;border-radius:8px;overflow:auto}
</style>
</head>
<body>
<div class="wrap">
  <h1>📝 타점 메모장 (UI 손대지 않고 타점만 교체)</h1>
  <div class="row">
    <label>적용 전략 선택</label>
    <select id="mode">
      <option value="fixed">fixed (기본)</option>
      <option value="volatility">volatility (변동성 보정)</option>
      <option value="custom">custom (아래 코드 사용)</option>
    </select>
    <button id="saveMode">전략 저장</button>
    <span class="small">※ 메인에서 /strategies/loader.js가 이 값을 읽어 적용</span>
  </div>

  <p class="small">아래 코드로 <b>calcTradeLevels(price, changeRate)</b> 함수를 정의하세요. 반드시 <code>{buy, sell, stop}</code> 반환.</p>
  <pre>예시)
function calcTradeLevels(price, changeRate){
  const base = Math.abs(changeRate||0);
  const adj  = base>0.05?1.5:(base>0.02?1.2:1.0);
  return {
    buy:  Math.max(0, Math.floor(price*(1-0.012*adj)*100)/100),
    sell: Math.floor(price*(1+0.012*adj)*100)/100,
    stop: Math.max(0, Math.floor(price*(1-0.025*adj)*100)/100)
  };
}</pre>

  <textarea id="code"></textarea>
  <div class="row">
    <button id="saveCode">코드 저장</button>
    <button id="loadSample">샘플 불러오기</button>
    <span id="msg" class="small"></span>
  </div>
</div>
<script>
const STRATEGY_KEY='selectedStrategy';
const CUSTOM_CODE_KEY='customLevelsCode';

const mode = document.getElementById('mode');
const msg  = document.getElementById('msg');
const code = document.getElementById('code');

(function init(){
  mode.value = localStorage.getItem(STRATEGY_KEY) || 'fixed';
  code.value = localStorage.getItem(CUSTOM_CODE_KEY) || `function calcTradeLevels(price, changeRate){
  // 여기에 원하는 로직 작성
  return { buy: price*0.98, sell: price*1.02, stop: price*0.97 };
}`;
})();

document.getElementById('saveMode').onclick = function(){
  localStorage.setItem(STRATEGY_KEY, mode.value);
  msg.textContent = '전략이 저장되었습니다. (메인 새로고침 시 적용)';
  setTimeout(()=>msg.textContent='', 2000);
};

document.getElementById('saveCode').onclick = function(){
  localStorage.setItem(CUSTOM_CODE_KEY, code.value);
  localStorage.setItem(STRATEGY_KEY, 'custom'); // 코드 저장하면 custom으로 전환
  mode.value = 'custom';
  msg.textContent = '커스텀 코드 저장됨. (메인 새로고침 시 적용)';
  setTimeout(()=>msg.textContent='', 2500);
};

document.getElementById('loadSample').onclick = function(){
  code.value = `function calcTradeLevels(price, changeRate){
  const base = Math.abs(changeRate||0);
  const adj  = base>0.05?1.5:(base>0.02?1.2:1.0);
  return {
    buy:  Math.max(0, Math.floor(price*(1-0.012*adj)*100)/100),
    sell: Math.floor(price*(1+0.012*adj)*100)/100,
    stop: Math.max(0, Math.floor(price*(1-0.025*adj)*100)/100)
  };
}`;
};
</script>
</body>
</html>
