<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ì©”ì–´ì§€ê°‘ v7.3 ì•ˆì •íŒ ğŸ’</title>
<style>
  body { background:#0d0f14; color:#fff; font-family: Pretendard, sans-serif; margin:0; padding:0; }
  .container { max-width:1200px; margin:20px auto; padding:20px; }
  h1 { color:#00ffa0; text-align:center; }
  input { width:300px; padding:8px; border-radius:5px; border:none; margin-right:5px; }
  button { background:#00ffa0; color:#000; border:none; padding:8px 12px; border-radius:5px; cursor:pointer; }
  table { width:100%; border-collapse:collapse; margin-top:20px; }
  th, td { border-bottom:1px solid #222; text-align:center; padding:8px; }
  .up { color:#00ff88; } .down { color:#ff4b4b; }
  #result-box { background:#1a1d24; border-radius:10px; margin-top:15px; padding:10px; display:none; }
</style>
</head>
<body>
  <div class="container">
    <h1>ì©”ì–´ì§€ê°‘ v7.3 ì•ˆì •íŒ ğŸ’ (ê²€ìƒ‰ê²°ê³¼ ì‹¤ì‹œê°„ í‘œì‹œ)</h1>
    <div style="text-align:center;">
      <input id="search" placeholder="ì½”ì¸ëª… ë˜ëŠ” ì‹¬ë³¼ ì…ë ¥ (ì˜ˆ: ì´ë”ë¦¬ì›€ / ETH)" />
      <button onclick="searchCoin()">ê²€ìƒ‰</button>
      <button onclick="reset()">ì´ˆê¸°í™”</button>
    </div>

    <div id="result-box"></div>

    <h2>ğŸ”¥ ê¸‰ë“±ì½”ì¸ Top 10</h2>
    <table id="up-table">
      <thead>
        <tr><th>#</th><th>ì½”ì¸ëª…</th><th>í˜„ì¬ê°€</th><th>ë³€ë™ë¥ </th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>ğŸ’§ ê¸‰ë½ì½”ì¸ Top 10</h2>
    <table id="down-table">
      <thead>
        <tr><th>#</th><th>ì½”ì¸ëª…</th><th>í˜„ì¬ê°€</th><th>ë³€ë™ë¥ </th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const API_URL = "https://api.upbit.com/v1/ticker?markets=";
    const MARKETS_URL = "https://api.upbit.com/v1/market/all";
    let marketList = [];

    async function loadMarkets() {
      const res = await fetch(MARKETS_URL);
      marketList = await res.json();
    }

    async function fetchTicker(markets) {
      const res = await fetch(API_URL + markets.join(","));
      return await res.json();
    }

    async function renderCoins() {
      const krwMarkets = marketList.filter(m => m.market.startsWith("KRW-")).slice(0, 80);
      const tickers = await fetchTicker(krwMarkets.map(m => m.market));

      const up = tickers.filter(t => t.signed_change_rate > 0.05).sort((a,b) => b.signed_change_rate - a.signed_change_rate).slice(0,10);
      const down = tickers.filter(t => t.signed_change_rate < -0.05).sort((a,b) => a.signed_change_rate - b.signed_change_rate).slice(0,10);

      fillTable(up, "up-table", true);
      fillTable(down, "down-table", false);
    }

    function fillTable(list, tableId, isUp) {
      const tbody = document.querySelector(`#${tableId} tbody`);
      tbody.innerHTML = "";
      list.forEach((coin, i) => {
        const name = marketList.find(m => m.market === coin.market)?.korean_name || coin.market;
        const rate = (coin.signed_change_rate * 100).toFixed(2);
        const color = isUp ? "up" : "down";
        const risk = isUp ? "3(ì£¼ì˜)" : "2(ë³´í†µ)";
        const msg = isUp ? "ğŸš€ í­ë“± ì‹ í˜¸!" : "ğŸ’€ ë‚™í­ê²½ê³„";
        tbody.innerHTML += `
          <tr>
            <td>${i+1}</td>
            <td>${name} (${coin.market})</td>
            <td>${coin.trade_price.toLocaleString()}</td>
            <td class="${color}">${rate}%</td>
            <td>${(coin.trade_price * 0.995).toLocaleString()}</td>
            <td>${(coin.trade_price * 1.005).toLocaleString()}</td>
            <td>${(coin.trade_price * 0.985).toLocaleString()}</td>
            <td>${risk}</td>
            <td>${msg}</td>
          </tr>`;
      });
    }

    async function searchCoin() {
      const q = document.getElementById("search").value.trim();
      const box = document.getElementById("result-box");
      box.style.display = "none";
      if (!q) return alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");

      const found = marketList.find(m =>
        m.korean_name.includes(q) || m.market.includes(q.toUpperCase())
      );
      if (!found) {
        box.style.display = "block";
        box.innerHTML = `<p>âŒ ì½”ì¸ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
        return;
      }

      const res = await fetch(API_URL + found.market);
      const data = await res.json();
      const coin = data[0];
      const msg = `
        <p><strong>${found.korean_name}</strong> (${found.market})</p>
        <p>í˜„ì¬ê°€: ${coin.trade_price.toLocaleString()}ì›</p>
        <p>ë§¤ìˆ˜: ${(coin.trade_price * 0.995).toLocaleString()} / ë§¤ë„: ${(coin.trade_price * 1.005).toLocaleString()}</p>
        <p>ì†ì ˆ: ${(coin.trade_price * 0.985).toLocaleString()}</p>
        <p>ìœ„í—˜ë„: 1(ì•ˆì •)</p>
        <p>ì©”ì–´í•œë§ˆë””: ê´€ë§</p>
      `;
      box.innerHTML = msg;
      box.style.display = "block";
    }

    function reset() { location.reload(); }

    loadMarkets().then(renderCoins);
    setInterval(renderCoins, 3000);
  </script>
</body>
</html>
