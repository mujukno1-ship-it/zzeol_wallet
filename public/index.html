<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì‚¬í† ì‹œì˜ì§€ê°‘ v10.3 â€” ì‚¬ëŒí˜•AI ìƒì‹œ + ì˜ˆì—´ìœ ì§€ + ê³ ì •ì½”ì¸ ë§¨ì•„ë˜</title>
<style>
  :root{--bg:#0b0f14;--panel:#111823;--muted:#8fa4c7;--text:#e8eefc;--up:#22c55e;--down:#ef4444}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:14px/1.5 "Noto Sans KR",system-ui}
  .wrap{max-width:1100px;margin:20px auto;padding:16px}
  .card{background:var(--panel);border:1px solid #1b2738;border-radius:16px;padding:14px;box-shadow:0 6px 20px rgba(0,0,0,.25);margin-bottom:14px}
  h2{margin:0 0 8px} .status{font-size:12px;color:#9bb0d1}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  input,button{border:1px solid #2a3b57;background:#0f1b2e;color:#dbe7ff;border-radius:10px;padding:10px 12px}
  button{cursor:pointer} button[disabled]{opacity:.55}
  table{width:100%;border-collapse:separate;border-spacing:0 8px;margin-top:10px}
  thead th{font-size:12px;color:#8fa4c7;text-align:left;padding:0 10px}
  tbody tr{background:#0e1520;border:1px solid #1d2a40} tbody td{padding:10px;vertical-align:middle}
  .price{font-variant-numeric:tabular-nums} .up{color:var(--up)} .down{color:var(--down)}
  .tag{font-size:11px;padding:3px 6px;border:1px solid #2a3956;border-radius:6px;background:#111a27;color:#9fb6db}
  .badge{display:inline-block;padding:4px 8px;border:1px solid #2a3956;border-radius:999px;background:#0f1726;color:#cfe2ff;font-size:12px}
  .act{padding:4px 8px;border-radius:999px;border:1px solid #2a3956}
  .act.buy{color:#9ff4b1;border-color:#2b5b3a}.act.sell{color:#ffb4b4;border-color:#6b2b2b}.act.hold{color:#c9d4eb}
  .pin{cursor:pointer;font-size:16px;line-height:1} .pinned{color:#ffd54a}
</style>
</head>
<body>
<div class="wrap">

  <!-- ğŸ” ì½”ì¸ ê²€ìƒ‰ -->
  <div class="card">
    <h2>ğŸ” ì½”ì¸ ê²€ìƒ‰ (KRW ì „ìš©)</h2>
    <div class="row">
      <input id="q" placeholder="ì˜ˆ: ì´ë”ë¦¬ì›€ / ì‹œë°”ì´ëˆ„ / ì—ì´ë‹¤ / ë„ì§€ì½”ì¸">
      <button id="btnSearch">ê²€ìƒ‰</button>
      <button id="btnTop">ìƒìŠ¹TOP10</button>
      <button id="btnHot">ê¸‰ë“±</button>
      <button id="btnFall">ê¸‰ë½</button>
      <button id="btnReset">ì´ˆê¸°í™”</button>
      <span class="badge">ë¹ ë¥¸ê²€ìƒ‰: SHIB / ADA / XRP / SOL</span>
    </div>
    <div class="status" id="status">ë§ˆì¼“ ëª©ë¡ ë¡œë“œ ì¤‘â€¦</div>
    <table>
      <thead><tr>
        <th>â˜…</th><th>ì½”ì¸</th><th>í˜„ì¬ê°€</th><th>ë“±ë½</th>
        <th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th>
      </tr></thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>

  <!-- ğŸ”¥ ì˜ˆì—´ ìë™ì˜ˆì¸¡ -->
  <div class="card">
    <h2>ğŸ”¥ ì˜ˆì—´ ìë™ì˜ˆì¸¡ (ìƒì‹œìœ ì§€+ì‹ ê·œ ìƒë‹¨)</h2>
    <div class="status">ì˜ˆì—´ì½”ì¸ì€ ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€, ìƒˆë¡œìš´ ì½”ì¸ì€ ìœ„ë¡œ ìë™ ì •ë ¬ë©ë‹ˆë‹¤.</div>
    <table>
      <thead><tr>
        <th>â˜…</th><th>ì½”ì¸</th><th>í˜„ì¬ê°€</th><th>ë“±ë½</th>
        <th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th>
      </tr></thead>
      <tbody id="preheatBody"></tbody>
    </table>
  </div>

  <!-- ğŸ§­ ì‚¬ëŒí˜• AI -->
  <div class="card">
    <h2>ğŸ§­ ì‚¬ëŒí˜• AI í‘œ (ì ‘ì† ì¦‰ì‹œ ë¶„ì„ + ìƒë‹¨ ì˜ˆì—´ ë°˜ì˜)</h2>
    <div class="status">í•­ìƒ ìµœì‹  ì˜ˆì—´ì½”ì¸ + ê³ ì •ì½”ì¸ ê¸°ë°˜ìœ¼ë¡œ ìë™ë¶„ì„ë©ë‹ˆë‹¤.</div>
    <table>
      <thead><tr>
        <th>â˜…</th><th>ì½”ì¸</th><th>í˜„ì¬ê°€</th><th>ë“±ë½</th>
        <th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th>
      </tr></thead>
      <tbody id="aiBody"></tbody>
    </table>
  </div>

  <!-- âš™ï¸ ì‹œìŠ¤í…œ ìƒíƒœ -->
  <div class="card">
    <h2>âš™ï¸ ì‹œìŠ¤í…œ ìƒíƒœ</h2>
    <div class="status" id="net">ì´ˆê¸°í™” ì¤‘â€¦</div>
  </div>

  <!-- â˜… ê³ ì • ì½”ì¸ (ë§¨ ì•„ë˜ë¡œ ì´ë™) -->
  <div class="card">
    <h2>â˜… ê³ ì • ì½”ì¸ (ì ‘ì† ì‹œ í•­ìƒ ìœ ì§€)</h2>
    <div class="status">ë³„(â˜…) í´ë¦­ìœ¼ë¡œ ê³ ì •/í•´ì œ ê°€ëŠ¥ â€” ë¸Œë¼ìš°ì €ì— ì €ì¥ë˜ì–´ ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€ë©ë‹ˆë‹¤.</div>
    <table>
      <thead><tr>
        <th>â˜…</th><th>ì½”ì¸</th><th>í˜„ì¬ê°€</th><th>ë“±ë½</th>
        <th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´í•œë§ˆë””</th>
      </tr></thead>
      <tbody id="pinnedBody"></tbody>
    </table>
  </div>

</div>

<script>
// ===== ê¸°ë³¸ ìƒìˆ˜ =====
const API = {
  REST_MARKETS:'https://api.upbit.com/v1/market/all?isDetails=true',
  REST_TICKER:(codes)=>`https://api.upbit.com/v1/ticker?markets=${codes.join(',')}`,
  LOCAL:(url)=>`/api/upbit?url=${encodeURIComponent(url)}`
};
const LS_PINNED='ZWL_PINNED_V1';
const LS_PREHEAT='ZWL_PREHEAT_V6';
const TH={preNearHighPct:0.005,preMinMove:0.002,preMaxMove:0.02,preAccel:1.6};
const DEFAULT_SEED=['KRW-BTC','KRW-ETH','KRW-ADA','KRW-SHIB','KRW-SOL','KRW-XRP'];

const el={tbody:byId('tbody'),preheatBody:byId('preheatBody'),aiBody:byId('aiBody'),pinnedBody:byId('pinnedBody'),status:byId('status'),net:byId('net'),q:byId('q')};
const st={markets:[],tickers:new Map(),hist:new Map(),pinned:new Set()};

function byId(id){return document.getElementById(id);}
function tick(p){if(p>=2e6)return 1e3;if(p>=1e6)return 500;if(p>=5e5)return 100;if(p>=1e5)return 50;if(p>=1e4)return 10;if(p>=1e3)return 5;if(p>=100)return 1;if(p>=10)return .1;if(p>=1)return .01;return .001;}
function fKRW(p){if(!p)return '-';const t=tick(p);const d=t>=1?0:t===.1?1:t===.01?2:3;return Number(p).toLocaleString('ko-KR',{minimumFractionDigits:d,maximumFractionDigits:d});}
function pct(v){return (Number(v)*100).toFixed(2)+'%';}
function levels(p){const k=tick(p);return{buy:p-2*k,sell:p+3*k,cut:p-6*k};}
function risk(s){return(Math.min(2.2,1+(1-s.near)*0.5+Math.min(3,s.accel)/3*0.4))||1.2;}
function oneLine(s){if(s.pct>0.015&&s.accel>2.2&&s.near<0.003)return{act:'buy',msg:'ì í™”ì§ì „ â€” ì§„ì…ê´€ì '};if(s.pct>0.008&&s.accel>1.8)return{act:'hold',msg:'ê°€ì—´ì¤‘ â€” ëˆŒë¦¼ëŒ€ê¸°'};if(s.pct<0.003)return{act:'hold',msg:'ì˜ˆì—´ì¤‘'};return{act:'hold',msg:'ê´€ë§ì¤‘'};}
async function fetchUpbit(url){try{const r=await fetch(url);if(r.ok)return await r.json();}catch{}const r=await fetch(API.LOCAL(url));return await r.json();}

// ===== ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° =====
function loadPinned(){try{st.pinned=new Set(JSON.parse(localStorage.getItem(LS_PINNED)||'[]'));}catch{st.pinned=new Set();}}
function savePinned(){localStorage.setItem(LS_PINNED,JSON.stringify([...st.pinned]));}
function loadPreheat(){try{return JSON.parse(localStorage.getItem(LS_PREHEAT)||'[]');}catch{return[];}}
function savePreheat(a){localStorage.setItem(LS_PREHEAT,JSON.stringify(a));}

// ===== ë Œë” =====
function rowHTML(market,name,price,chg,stat){
  const lv=levels(price);const cls=chg>=0?'up':'down';const one=oneLine(stat);const pin=st.pinned.has(market);
  return `<td><span class="pin ${pin?'pinned':''}" data-m="${market}">${pin?'â˜…':'â˜†'}</span></td>
  <td><span class="tag">${market.replace('KRW-','')}</span> ${name}</td>
  <td class="${cls}">${fKRW(price)}</td>
  <td class="${cls}">${pct(chg)}</td>
  <td>${fKRW(lv.buy)}</td><td>${fKRW(lv.sell)}</td><td>${fKRW(lv.cut)}</td>
  <td>${risk(stat).toFixed(2)}</td><td><span class="act ${one.act}">${one.act==='buy'?'ë§¤ìˆ˜':one.act==='sell'?'ë§¤ë„':'ê´€ë§'}</span> ${one.msg}</td>`;
}
function wirePins(tb){tb.querySelectorAll('.pin').forEach(e=>{e.onclick=()=>{const m=e.dataset.m;if(st.pinned.has(m))st.pinned.delete(m);else st.pinned.add(m);savePinned();renderPinned();};});}
function renderPinned(){const b=el.pinnedBody;b.innerHTML='';const codes=[...st.pinned];if(!codes.length){b.innerHTML='<tr><td colspan="9" class="status">ê³ ì •ì½”ì¸ ì—†ìŒ</td></tr>';return;}
for(const c of codes){const t=st.tickers.get(c);if(!t)continue;const stat={pct:0,accel:1,near:0.5};const tr=document.createElement('tr');tr.innerHTML=rowHTML(c,c,t.trade_price,t.signed_change_rate,stat);b.appendChild(tr);}wirePins(b);}
function renderPreheat(list){const b=el.preheatBody;b.innerHTML='';if(!list.length){b.innerHTML='<tr><td colspan="9" class="status">ì˜ˆì—´ì½”ì¸ ì—†ìŒ</td></tr>';return;}
for(const i of list){const t=st.tickers.get(i.market);if(!t)continue;const tr=document.createElement('tr');tr.innerHTML=rowHTML(i.market,i.name,t.trade_price,t.signed_change_rate,i);b.appendChild(tr);}wirePins(b);}
function renderAI(){const b=el.aiBody;b.innerHTML='';const seed=[...new Set([...st.pinned,...loadPreheat().map(x=>x.market),...DEFAULT_SEED])].slice(0,10);
for(const c of seed){const t=st.tickers.get(c);if(!t)continue;const stat={pct:t.signed_change_rate,accel:1.8,near:0.5};const tr=document.createElement('tr');tr.innerHTML=rowHTML(c,c,t.trade_price,t.signed_change_rate,stat);b.appendChild(tr);}wirePins(b);}

// ===== ë°ì´í„° ë¡œë“œ/ê°±ì‹  =====
async function poll(){try{const mk=st.markets.map(m=>m.market);const a=await fetchUpbit(API.REST_TICKER(mk));for(const t of a){st.tickers.set(t.market,t);}renderAI();renderPinned();}catch{}}
async function start(){loadPinned();const m=await fetchUpbit(API.REST_MARKETS);st.markets=m.filter(x=>x.market.startsWith('KRW-'));el.status.textContent=`KRW ${st.markets.length}ì¢… ë¡œë“œ`;await poll();setInterval(poll,2000);renderPreheat(loadPreheat());renderAI();}

// ===== ê²€ìƒ‰ =====
byId('btnSearch').onclick=()=>{const key=el.q.value.toLowerCase();const f=st.markets.filter(m=>m.korean_name.toLowerCase().includes(key)||m.market.toLowerCase().includes(key));const tb=el.tbody;tb.innerHTML='';if(!f.length){tb.innerHTML='<tr><td colspan="9" class="status">ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ</td></tr>';return;}for(const m of f.slice(0,20)){const t=st.tickers.get(m.market)||{trade_price:0,signed_change_rate:0};const stat={pct:t.signed_change_rate,accel:1,near:0.5};const tr=document.createElement('tr');tr.innerHTML=rowHTML(m.market,m.korean_name,t.trade_price,t.signed_change_rate,stat);tb.appendChild(tr);}wirePins(tb);}
byId('btnReset').onclick=()=>{el.q.value='';renderAI();}

// ===== ì‹œì‘ =====
start();
</script>
</body>
</html>
