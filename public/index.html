<!-- ğŸ”¥ ì‚¬í† ì‹œì˜ì§€ê°‘ v11.0 ì™„ì „ì²´ (SPARK + ULTRA + AIì˜ˆì¸¡ + PrecisionBoost) -->
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì‚¬í† ì‹œì˜ì§€ê°‘ v11.0</title>
<style>
body{background:#0b0c10;color:#fff;font-family:'Pretendard',sans-serif;margin:0;overflow-x:hidden;}
header{position:fixed;top:0;width:100%;background:#101217;padding:10px;z-index:99;border-bottom:1px solid #222;text-align:center;}
#search{width:90%;max-width:480px;height:44px;border:none;border-radius:10px;background:#1b1d23;color:#fff;font-size:16px;padding:0 12px;outline:none;}
#results{width:90%;max-width:480px;background:#1a1c20;margin:6px auto;border-radius:10px;overflow:hidden;max-height:200px;transition:none;}
.item{padding:10px;border-bottom:1px solid #222;cursor:pointer;}
.item:hover{background:#2a2c30;}
.spark{margin-top:100px;text-align:center;}
.spark .title{font-size:18px;margin-bottom:4px;}
.spark .coin{display:inline-block;background:#191b20;padding:6px 10px;border-radius:10px;margin:3px;font-size:14px;}
.signal{width:90%;max-width:480px;background:#101217;margin:12px auto;padding:12px;border-radius:12px;line-height:1.6;border:1px solid #222;}
.comment{color:#f9d65c;font-style:italic;}
button.tp-chip,button.sl-chip{padding:6px 10px;border-radius:8px;border:1px solid #2a2e36;background:#171a20;color:#ddd;cursor:pointer;margin:2px;}
#tp-preview,#sl-preview{margin-top:5px;opacity:.9;font-size:14px}
</style>
</head>
<body>
<header>
<input id="search" placeholder="ì½”ì¸ ì´ë¦„ ë˜ëŠ” ì‹¬ë³¼ ì…ë ¥..." autocomplete="off">
<div id="results"></div>
</header>

<section class="spark">
  <div class="title">ğŸ”¥ SPARK TOP10 â€” ê¸‰ë“± ì‚¬ì „ ì˜ˆì—´ ê°ì§€</div>
  <div id="sparkList">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
</section>

<div id="signal" class="signal" style="display:none;"></div>

<script>
// =====================
// âš™ï¸ ì‚¬í† ì‹œì˜ì§€ê°‘ v11.0 ì™„ì „ì²´
// =====================
const API="https://satoshi-proxy.mujukno1.workers.dev/api";
const q=$id=>document.getElementById($id);
const search=q("search"),results=q("results"),spark=q("sparkList"),panel=q("signal");
results.style.transition="none";

// ğŸ” ê²€ìƒ‰
search.addEventListener("input",async e=>{
  const v=e.target.value.trim();if(!v){results.innerHTML="";return;}
  try{
    const r=await fetch(`${API}/search?q=${encodeURIComponent(v)}`);
    const d=await r.json();results.innerHTML=d.slice(0,5).map(c=>`
      <div class="item" data-s="${c.symbol}">${c.korean_name} (${c.symbol}) â€” ${c.price.toLocaleString()}ì›</div>`).join("");
  }catch{results.innerHTML=`<div class="item">ê²€ìƒ‰ ì˜¤ë¥˜</div>`;}
});

// SPARK
async function loadSpark(){
  try{
    const r=await fetch(`${API}/spark`);const d=await r.json();
    spark.innerHTML=d.map(c=>{
      const clr=c.score>=90?"#ff4d4d":c.score>=80?"#ff9900":"#777";
      return `<div class="coin" data-s="${c.symbol}">${c.korean_name} <span style="color:${clr}">(${c.score})</span></div>`;
    }).join("");
  }catch{spark.textContent="ì—°ê²° ì‹¤íŒ¨";}
}
loadSpark();setInterval(loadSpark,30000);

// í´ë¦­ â†’ ULTRA ì‹œê·¸ë„
document.addEventListener("click",async e=>{
  const t=e.target.closest(".coin,.item");if(!t)return;
  const sym=t.dataset.s;panel.style.display="block";panel.textContent="AI ë¶„ì„ì¤‘...";
  try{
    const r=await fetch(`${API}/ultra?symbol=${sym}`);const s=await r.json();window._last=s;
    panel.innerHTML=`<b>${s.korean_name} (${s.symbol})</b><br>
    í˜„ì¬ê°€: ${s.price}ì›<br>ë§¤ìˆ˜: ${s.buy1}ì› / ìµì ˆ: ${s.tp1}ì› / ì†ì ˆ: ${s.sl}ì›<br>
    ìƒìŠ¹í™•ë¥ : ${s.upProb}% / í•˜ë½í™•ë¥ : ${s.downProb}%<br>ìœ„í—˜ë„: ${s.risk}<br>
    <span class="comment">${s.comment}</span>`;
    renderTP_SL_Chips(s);
  }catch{panel.textContent="ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨";}
});

// ===== TP/SL ìë™ì¹© (ì˜ˆìƒ ìƒìŠ¹ë¥ Â·í•˜ë½ë¥ ) =====
function tick(price){
  if(price>=2000000)return 1000;
  if(price>=1000000)return 500;
  if(price>=500000)return 100;
  if(price>=100000)return 50;
  if(price>=10000)return 10;
  if(price>=1000)return 1;
  if(price>=100)return 0.1;
  if(price>=10)return 0.01;
  return 0.001;
}
function round(p,t,dir="nearest"){const v=p/t;return dir==="up"?Math.ceil(v)*t:dir==="down"?Math.floor(v)*t:Math.round(v)*t;}

function renderTP_SL_Chips(s){
  const base=s.price,tickSize=t(base);
  const pdiv=document.createElement("div");
  pdiv.innerHTML=`<hr><div>ëª©í‘œìˆ˜ìµë¥ (ìµì ˆ): ${[5,8,10,12,15].map(x=>`<button class='tp-chip' data-p='${x}'>${x}%</button>`).join("")}
  <input id='tp-in' type='number' min='1' max='100' step='0.5' placeholder='ì§ì ‘ì…ë ¥(%)'>
  <button id='tp-apply'>ì ìš©</button><div id='tp-preview'></div></div>
  <div style="margin-top:8px;">ì†ì ˆí­(í•˜ë½ë¥ ): ${[3,5,8,10].map(x=>`<button class='sl-chip' data-p='${x}'>-${x}%</button>`).join("")}
  <input id='sl-in' type='number' min='1' max='50' step='0.5' placeholder='ì§ì ‘ì…ë ¥(%)'>
  <button id='sl-apply'>ì ìš©</button><div id='sl-preview'></div></div>`;
  panel.appendChild(pdiv);

  function setTP(pct){const tp=round(base*(1+pct/100),tickSize,"up");
    panel.innerHTML=panel.innerHTML.replace(/ìµì ˆ:\s*[\d,\.]+ì›/,"ìµì ˆ: "+tp.toLocaleString()+"ì›");
    q("tp-preview").textContent=`â†’ ê¸°ëŒ€ +${pct}% ìµì ˆê°€: ${tp.toLocaleString()}ì›`; }
  function setSL(pct){const sl=round(base*(1-pct/100),tickSize,"down");
    panel.innerHTML=panel.innerHTML.replace(/ì†ì ˆ:\s*[\d,\.]+ì›/,"ì†ì ˆ: "+sl.toLocaleString()+"ì›");
    q("sl-preview").textContent=`â†’ ê¸°ëŒ€ -${pct}% ì†ì ˆê°€: ${sl.toLocaleString()}ì›`; }

  document.querySelectorAll(".tp-chip").forEach(b=>b.onclick=()=>setTP(+b.dataset.p));
  document.querySelectorAll(".sl-chip").forEach(b=>b.onclick=()=>setSL(+b.dataset.p));
  q("tp-apply").onclick=()=>{const v=+q("tp-in").value;if(v>0)setTP(v)};
  q("sl-apply").onclick=()=>{const v=+q("sl-in").value;if(v>0)setSL(v)};
}

// ========== AI ìƒìŠ¹Â·í•˜ë½í­ ì˜ˆì¸¡ í†µí•© ==========
async function predict(symbol){
  const r=await fetch(`${API}/predict?symbol=${symbol}`);
  return await r.json();
}
