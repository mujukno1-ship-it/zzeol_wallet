<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì©”ì–´ì§€ê°‘ Â· KRW ì‹¤ì‹œê°„ ì½”ì¸ íƒ€ì </title>
  <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval';">
  <style>
    body {
      background-color: #0b0b0b;
      color: #e6e6e6;
      font-family: "Pretendard", sans-serif;
      text-align: center;
      padding: 20px;
    }
    h2 { color: #fff; margin-bottom: 15px; }
    .box { margin: 15px auto; padding: 20px; border: 1px solid #333; border-radius: 10px; max-width: 700px; background: #111; }
    button {
      background: #222; color: #fff; border: none; padding: 8px 15px; margin: 3px; border-radius: 6px;
      cursor: pointer; transition: 0.2s;
    }
    button:hover { background: #555; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 10px; border-bottom: 1px solid #222; }
    th { background: #1b1b1b; }
    .highlight { color: #00ff88; font-weight: bold; }
    .warn { color: #ffcc00; }
    .danger { color: #ff4444; }
  </style>
</head>
<body>
  <h2>KRW ì½”ì¸ ê²€ìƒ‰ Â· ë§¤ìˆ˜/ë§¤ë„ íƒ€ì </h2>

  <div class="box">
    <input id="coinInput" type="text" placeholder="ì˜ˆ: ë¹„íŠ¸ì½”ì¸ ë˜ëŠ” BTC/KRW" />
    <button onclick="searchCoin()">ê²€ìƒ‰</button>
    <span id="status" class="warn">ì‹œìŠ¤í…œ: ëŒ€ê¸°</span>
    <span id="risk" class="warn">ìœ„í—˜ë„: -</span>
  </div>

  <div id="resultBox" class="box">
    <table>
      <thead><tr><th>ì§€í‘œ</th><th>ê°’</th><th>ì„¤ëª…</th></tr></thead>
      <tbody id="resultBody">
        <tr><td>ì½”ì¸</td><td id="coinName">-</td><td>í˜„ì¬ê°€ê²©/ë“±ë½</td></tr>
        <tr><td>í˜„ì¬ê°€</td><td id="price">-</td><td>ë§¤ìˆ˜/ë§¤ë„ íƒ€ì  ê¸°ì¤€</td></tr>
        <tr><td>ë“±ë½</td><td id="change">-</td><td>ì „ì¼ ëŒ€ë¹„ ë“±ë½ë¥ </td></tr>
        <tr><td>ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„</td><td id="kimchi">-</td><td>ì—…ë¹„íŠ¸ KRW-BTC vs ì½”ì¸ë² ì´ìŠ¤ BTC-USD</td></tr>
        <tr><td>ì˜¨ì²´ì¸ ìê¸ˆíë¦„</td><td id="onchain">-</td><td>Stablecoin ìˆœìœ ì…/ìœ ì¶œ</td></tr>
        <tr><td>ë§¤ìˆ˜ íƒ€ì </td><td id="buy">-</td><td>ì¶”ì²œ ë§¤ìˆ˜ê°€ê²©</td></tr>
        <tr><td>ë§¤ë„ íƒ€ì </td><td id="sell">-</td><td>ì¶”ì²œ ë§¤ë„ê°€ê²©</td></tr>
        <tr><td>ì†ì ˆ ë¼ì¸</td><td id="cut">-</td><td>ìœ„í—˜ ê´€ë¦¬ ê¸°ì¤€ ì†ì ˆê°€</td></tr>
      </tbody>
    </table>
    <div id="zzeolMsg" style="margin-top:15px; color:#00bfff; font-weight:600;"></div>
  </div>

  <script>
    const API_BASE = "https://satoshi-proxy.mujukno1.workers.dev"; // âœ… Cloudflare Worker API ê²½ë¡œ
    const statusEl = document.getElementById('status');
    const riskEl = document.getElementById('risk');
    const msgEl = document.getElementById('zzeolMsg');

    async function searchCoin() {
      const coin = document.getElementById("coinInput").value.trim().toUpperCase();
      if (!coin) return alert("ì½”ì¸ëª…ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: BTC, ETH, SHIB)");
      statusEl.textContent = "ì‹œìŠ¤í…œ: ë°ì´í„° ìš”ì²­ ì¤‘...";
      try {
        const res = await fetch(`${API_BASE}/summary?market=${coin}-KRW`);
        if (!res.ok) throw new Error("API í˜¸ì¶œ ì‹¤íŒ¨");
        const data = await res.json();

        document.getElementById("coinName").textContent = coin;
        document.getElementById("price").textContent = `${data.price?.toLocaleString()} ì›`;
        document.getElementById("change").textContent = `${data.change}%`;
        document.getElementById("kimchi").textContent = `${data.kimchiPremium || "-"}%`;
        document.getElementById("onchain").textContent = data.onchainFlow || "ì •ìƒ";

        // ë§¤ìˆ˜Â·ë§¤ë„Â·ì†ì ˆ íƒ€ì  ê³„ì‚° (ìƒ˜í”Œ)
        const base = Number(data.price || 0);
        const buy = Math.floor(base * 0.985);
        const sell = Math.floor(base * 1.015);
        const cut = Math.floor(base * 0.97);
        document.getElementById("buy").textContent = buy.toLocaleString();
        document.getElementById("sell").textContent = sell.toLocaleString();
        document.getElementById("cut").textContent = cut.toLocaleString();

        // ìœ„í—˜ë„ íŒë‹¨
        let risk = "ë³´í†µ", color = "warn";
        if (data.change > 5) { risk = "ì£¼ì˜"; color = "danger"; }
        if (data.change < -3) { risk = "ë‚®ìŒ"; color = "highlight"; }
        riskEl.className = color;
        riskEl.textContent = `ìœ„í—˜ë„: ${risk}`;

        // ì©”ì–´í•œë§ˆë”” (AI ìŠ¤íƒ€ì¼ ë¬¸êµ¬)
        let msg = "ì‹œì¥ì€ ì•ˆì •ì ì…ë‹ˆë‹¤.";
        if (risk === "ì£¼ì˜") msg = "ê¸‰ë“± ìœ„í—˜, ë¶„í• ë§¤ë„ë¡œ ëŒ€ì‘í•˜ì„¸ìš”.";
        else if (risk === "ë‚®ìŒ") msg = "ì¡°ì • ë§ˆë¬´ë¦¬ ë‹¨ê³„, ì €ì  ë§¤ìˆ˜ ìœ íš¨.";
        msgEl.textContent = `ğŸ’¬ ì©”ì–´í•œë§ˆë””: ${msg}`;

        statusEl.textContent = "ì‹œìŠ¤í…œ: OK";
      } catch (err) {
        console.error(err);
        statusEl.textContent = "ì‹œìŠ¤í…œ: ì˜¤ë¥˜";
        msgEl.textContent = "âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨. ì„œë²„ ì ê²€ ì¤‘ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
      }
    }
  </script>
</body>
</html>
