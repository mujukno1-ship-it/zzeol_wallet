<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>사토시의지갑 v13.1 안정판</title>
<style>
body{font-family:'Pretendard',sans-serif;background:#0a0a0a;color:#fff;margin:0;padding:0;text-align:center}
header{position:fixed;top:0;width:100%;background:#111;padding:10px 0;z-index:1000}
#search{width:90%;max-width:500px;padding:10px;font-size:16px;border:none;border-radius:8px;outline:none}
#spark-container,#ultra-container{margin-top:80px}
.card{background:#1a1a1a;border-radius:12px;margin:10px auto;padding:10px;width:90%;max-width:600px;text-align:left}
.chip{display:inline-block;padding:4px 8px;border-radius:8px;margin-right:6px;font-size:13px}
.chip.buy{background:#007aff}
.chip.sell{background:#ff3b30}
.chip.sl{background:#444}
.chip.risk{background:#888}
h2{margin:10px 0;color:#0ff}
.no-motion{transition:none!important;animation:none!important}
</style>
</head>
<body class="no-motion">
<header>
  <input id="search" placeholder="코인명 또는 마켓코드 (예: 시바이누, KRW-SHIB)" />
</header>

<div id="spark-container"></div>
<div id="ultra-container"></div>

<script>
const API_BASE = 'https://satoshi-proxy.mujukno1.workers.dev'; // ✅ 연동 확정

// ================= 스파크 TOP10 =================
async function loadSparkTop() {
  try {
    const res = await fetch(`${API_BASE}/spark/top`);
    const data = await res.json();
    const container = document.getElementById('spark-container');
    container.innerHTML = '<h2>🔥 SPARK TOP10</h2>' +
      data.map(c=>`<div class="card">
        <b>${c.korean_name}</b> (${c.market})<br>
        예열강도: ${c.spark_score}% / 상승확률: ${c.prob}%<br>
        예상상승률: +${c.expected_gain}% / 위험도: ${c.risk_level}
      </div>`).join('');
  } catch(e) {
    document.getElementById('spark-container').innerHTML = '<div class="card">SPARK 데이터 불러오기 실패</div>';
  }
}

// ================= ULTRA 시그널 =================
async function loadUltra(market) {
  try {
    const res = await fetch(`${API_BASE}/ultra?market=${market}`);
    const d = await res.json();
    const c = document.getElementById('ultra-container');
    c.innerHTML = `<h2>💎 ${d.korean_name || market} 실시간 시그널</h2>
      <div class="card">
        <div>현재가: ${d.price}원</div>
        <div class="chip buy">매수 ${d.buy1}원</div>
        <div class="chip sell">익절 ${d.tp1}원 / ${d.tp2}원</div>
        <div class="chip sl">손절 ${d.sl}원</div>
        <div class="chip risk">위험도 ${d.risk_level}</div>
        <div>쩔어한마디: ${d.comment || '데이터 분석중...'}</div>
      </div>`;
  } catch(e) {
    document.getElementById('ultra-container').innerHTML = '<div class="card">ULTRA 데이터 불러오기 실패</div>';
  }
}

// ================= 검색 이벤트 =================
document.getElementById('search').addEventListener('keydown',e=>{
  if(e.key==='Enter'){
    const val=e.target.value.trim();
    if(!val)return;
    let market=val.toUpperCase().startsWith('KRW-')?val.toUpperCase():`KRW-${val.toUpperCase()}`;
    loadUltra(market);
  }
});

// ================= 초기 실행 =================
loadSparkTop();
</script>
</body>
</html>
