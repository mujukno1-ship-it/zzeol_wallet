<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì©”ì–´ì§„ê° âˆ ì „ì„¤íŒ 10.x</title>
<style>
  :root { --bg:#0e1217; --card:#151a21; --text:#e6edf3; --muted:#9aa4b2; --good:#2bd576; --bad:#ff6767; --warn:#f7b955; --chip:#243043;}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:14px/1.6 system-ui,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,sans-serif}
  .wrap{max-width:1120px;margin:28px auto;padding:0 16px}
  .row{display:grid;gap:12px}
  .grid-2{grid-template-columns:1fr 1fr}
  .grid-3{grid-template-columns:1fr 1fr 1fr}
  .card{background:var(--card);padding:16px;border-radius:12px;box-shadow:0 0 0 1px rgba(255,255,255,.03) inset}
  h2{margin:0 0 10px;font-size:18px}
  .muted{color:var(--muted)}
  .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:var(--chip);color:#cfe3ff;font-size:12px;margin-left:8px}
  .rowline{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  input[type=text]{width:100%;padding:12px 14px;border-radius:10px;background:#0d131a;color:#dfe7ef;border:1px solid #2a3340;outline:none}
  button{padding:10px 14px;border-radius:10px;border:1px solid #2a3340;background:#0d131a;color:#dfe7ef;cursor:pointer}
  button:hover{border-color:#3e4a5c}
  table{width:100%;border-collapse:collapse}
  th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,.05);text-align:right}
  th:first-child,td:first-child{text-align:left}
  .good{color:var(--good)} .bad{color:var(--bad)} .warn{color:var(--warn)}
  .kbd{background:#0d131a;border:1px solid #2a3340;border-bottom-color:#1b2430;padding:2px 6px;border-radius:6px}
  .right{float:right}
</style>
</head>
<body>
<div class="wrap">
  <div class="row">
    <div class="card">
      <div class="rowline">
        <h2>ê²€ìƒ‰ <span class="pill" id="ver">ì „ì„¤íŒ 10.x</span></h2>
        <span class="muted">ì—…ë¹„íŠ¸ í˜¸ê°€ë‹¨ìœ„Â·ê¹€í”„Â·ì˜¨ì²´ì¸Â·ì‹œê·¸ë„ ì—°ë™</span>
        <span class="pill" id="apiStatus">API ì—°ê²°: í™•ì¸ì¤‘â€¦</span>
      </div>
      <div class="rowline" style="margin-top:8px;gap:8px">
        <input id="q" type="text" placeholder="ì˜ˆ) ë¹„íŠ¸ì½”ì¸, ì´ë”ë¦¬ì›€, ì´ë”ë¦¬ì›€ í´ë˜ì‹, ë„ì§€, ì‹œë°”ì´ëˆ„â€¦" />
        <button id="btnSearch">ê²€ìƒ‰</button>
        <button id="btnReset" class="muted">ì´ˆê¸°í™”</button>
      </div>
      <div id="searchResult" class="muted" style="margin-top:8px">ê²€ìƒ‰ í›„ ê²°ê³¼ê°€ ì—¬ê¸° í‘œì‹œë©ë‹ˆë‹¤.</div>
    </div>
  </div>

  <div class="row grid-2" style="margin-top:12px">
    <div class="card" id="box-premium">
      <h2>ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„ (BTC)</h2>
      <div id="premBody" class="muted">-</div>
    </div>
    <div class="card">
      <div class="rowline">
        <h2>ì˜¨ì²´ì¸ TVL (ETH)</h2><button class="right" id="btnTvlAuto">ìë™ ë¡¤ë°±</button>
      </div>
      <div id="tvlBody" class="muted">-</div>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <div class="rowline"><h2>âš¡ SPARK (ê¸‰ë“± ê°ì§€ Â· ìƒë‹¨ ê³ ì • TOP 10)</h2><span class="pill">í˜„ì¬ê°€Â·ë§¤ìˆ˜Â·ë§¤ë„Â·ì†ì ˆÂ·ìœ„í—˜ë„Â·ì©”ì–´ê²°ë¡  í¬í•¨</span></div>
    <div id="sparkBody" class="muted">ë¡œë”© ì¤‘â€¦</div>
  </div>

  <div class="card" style="margin-top:12px">
    <h2>ğŸ’¬ ì©”ì–´ í•œë§ˆë””</h2>
    <div id="oneLiner" class="muted">ìƒë‹¨ ì§€í–¥ êµ¬ê°„, ë¶„í•  ë§¤ë„ ìœ ë¦¬</div>
  </div>

  <p class="muted" style="margin:24px 8px 16px">Â© 2025 ì©”ì–´ì§„ê° âˆ | ì—…ë¹„íŠ¸Â·ì˜¨ì²´ì¸Â·ê¹€í”„ ì‹¤ì‹œê°„ ì—°ë™</p>
</div>

<script>
const API_BASE = "https://satoshi-proxy.mujukno1.workers.dev"; // â† ì—¬ê¸°ë§Œ ë³¸ì¸ ì›Œì»¤ URLë¡œ!

// í•œê¸€ëª… ë§¤í•‘ (ê²€ìƒ‰ìš©)
const KOR = {
  "ë¹„íŠ¸ì½”ì¸":"BTC","ë¹„íŠ¸ ì½”ì¸":"BTC","btc":"BTC","bitcoin":"BTC",
  "ì´ë”ë¦¬ì›€":"ETH","eth":"ETH","ethereum":"ETH",
  "ì´ë”ë¦¬ì›€ í´ë˜ì‹":"ETC","í´ë˜ì‹":"ETC","etc":"ETC",
  "ë¦¬í”Œ":"XRP","xrp":"XRP","ë„ì§€":"DOGE","ë„ì§€ì½”ì¸":"DOGE","doge":"DOGE",
  "ì—ì´ë‹¤":"ADA","ada":"ADA","ì†”ë¼ë‚˜":"SOL","sol":"SOL","ì•„ë°œë€ì²´":"AVAX","avax":"AVAX",
  "í´ë¦¬ê³¤":"MATIC","matic":"MATIC","ì‹œë°”ì´ëˆ„":"SHIB","ì‹œë°”":"SHIB","shib":"SHIB",
  "ë¹„íŠ¸ì½”ì¸ìºì‹œ":"BCH","bch":"BCH","ì•„í†°":"ATOM","atom":"ATOM",
};

// ì—…ë¹„íŠ¸ í˜¸ê°€ë‹¨ìœ„(í”„ë¡ì‹œì™€ ë™ì¼)
function tickSize(p){
  p=+p||0;
  if (p>=2000000) return 1000;
  if (p>=1000000) return 500;
  if (p>=500000) return 100;
  if (p>=100000) return 50;
  if (p>=10000) return 10;
  if (p>=1000) return 1;
  if (p>=100) return 0.1;
  if (p>=10) return 0.01;
  if (p>=1) return 0.001;
  return 0.0001;
}
function roundTick(p){const t=tickSize(p);return Math.round(p/t)*t}
function n(p){return (p||0).toLocaleString("ko-KR")}
function pct(p){return (p>0?"+":"") + (p||0).toFixed(2) + " %"}

// API ìƒíƒœ
(async () => {
  try{
    const r = await fetch(API_BASE+"/api/health");
    if (!r.ok) throw 0;
    const j = await r.json();
    document.querySelector("#apiStatus").textContent = "API ì—°ê²°: ì •ìƒ";
  }catch{
    document.querySelector("#apiStatus").textContent = "API ì—°ê²°: ì‹¤íŒ¨";
  }
})();

// ê¹€í”„(BTC)
async function loadPremium(){
  const r = await fetch(API_BASE+"/api/premium?symbol=BTC");
  const j = await r.json();
  if (!j.ok) {document.querySelector("#premBody").textContent="ì˜¤ë¥˜"; return;}
  document.querySelector("#premBody").innerHTML = `
    ì—…ë¹„íŠ¸ KRW: <b>${n(j.upbitPrice)} ì›</b><br>
    ê¸€ë¡œë²Œ USD: ${n(j.globalUsd)} USD<br>
    USD/KRW: ${n(j.usdkrw)}<br>
    í”„ë¦¬ë¯¸ì—„(%): <b class="${j.premiumPct>=0?'bad':'good'}">${pct(j.premiumPct)}</b><br>
    <span class="muted">ì†ŒìŠ¤: ${j.src.global} / ${j.src.fx} / Upbit</span>
  `;
}
loadPremium();

// TVL(ETH)
async function loadTVL(sym="ETH"){
  const r = await fetch(API_BASE+`/api/onchain?symbol=${encodeURIComponent(sym)}`);
  const j = await r.json();
  const el = document.querySelector("#tvlBody");
  if (!j.ok){ el.textContent="ì˜¤ë¥˜"; return;}
  el.innerHTML = `
    TVL: <b>${n(j.tvl)} USD</b><br>
    ì²´ì¸: ${j.chain}<br>
    <span class="muted">${j.source}</span>
  `;
}
loadTVL();
document.querySelector("#btnTvlAuto").addEventListener("click", ()=>loadTVL("ETH"));

// SPARK
async function loadSpark(){
  const r = await fetch(API_BASE+"/api/spark");
  const j = await r.json();
  const el = document.querySelector("#sparkBody");
  if (!j.ok){ el.textContent="SPARK ë¡œë”© ì˜¤ë¥˜"; return;}
  const rows = j.rows;
  if (!rows.length){ el.textContent="ë°ì´í„° ì—†ìŒ"; return;}
  el.innerHTML = `
    <table>
      <thead><tr>
        <th>ì½”ì¸</th><th>í˜„ì¬ê°€</th><th>60m</th><th>ë§¤ìˆ˜</th><th>ë§¤ë„</th><th>ì†ì ˆ</th><th>ìœ„í—˜ë„</th><th>ì©”ì–´ê²°ë¡ </th>
      </tr></thead>
      <tbody>
        ${rows.map(r=>`
          <tr>
            <td>${r.symbol}</td>
            <td>${n(r.price)}ì›</td>
            <td class="${r.chg60m>=0?'good':'bad'}">${pct(r.chg60m)}</td>
            <td>${n(r.buy)}</td>
            <td>${n(r.sell)}</td>
            <td>${n(r.stop)}</td>
            <td>${r.risk}</td>
            <td>${r.verdict}</td>
          </tr>`).join("")}
      </tbody>
    </table>
  `;
}
loadSpark();

// ê²€ìƒ‰
function toSymbol(q){
  q=(q||"").trim().toLowerCase();
  if (KOR[q]) return KOR[q];
  if (/^[a-z]{2,6}$/i.test(q)) return q.toUpperCase();
  return "";
}
async function runSearch(){
  const q = document.querySelector("#q").value;
  const sym = toSymbol(q);
  const out = document.querySelector("#searchResult");
  if (!sym){ out.textContent="ê²€ìƒ‰ ì‹¤íŒ¨: HTTP 429"; return;}

  // ê¹€í”„/ì˜¨ì²´ì¸/ê°„ì´ íƒ€ì 
  const [pm, tvl] = await Promise.allSettled([
    fetch(API_BASE+`/api/premium?symbol=${sym}`).then(r=>r.json()),
    fetch(API_BASE+`/api/onchain?symbol=${sym}`).then(r=>r.json()),
  ]);
  let pbody = "-", tbody = "-";
  if (pm.status==="fulfilled" && pm.value?.ok){
    const j=pm.value;
    pbody = `í˜„ì¬ê°€(ì—…ë¹„íŠ¸): <b>${n(j.upbitPrice)}ì›</b> / ê¸€ë¡œë²ŒUSD: ${n(j.globalUsd)} / í”„ë¦¬ë¯¸ì—„: <b class="${j.premiumPct>=0?'bad':'good'}">${pct(j.premiumPct)}</b>`;
    // ê°„ë‹¨ íƒ€ì 
    const buy = roundTick(j.upbitPrice*0.998);
    const sell = roundTick(j.upbitPrice*1.004);
    const stop = roundTick(j.upbitPrice*0.99);
    const risk = Math.min(5, Math.max(1, Math.round(Math.abs(j.premiumPct)/1.2)));
    const verdict = j.premiumPct>1 ? "ë§¤ë„ ì£¼ì˜, ì„¸ë ¥ êµ¬ê°„" : (j.premiumPct<-1 ? "ë§¤ìˆ˜ ê´€ë§, ë¶„í•  ì§„ì…" : "ì¤‘ë¦½");
    out.innerHTML = `
      <b>${q}</b> (${sym}) â†’ í˜„ì¬ê°€: <b>${n(j.upbitPrice)}ì›</b> Â· ë§¤ìˆ˜: ${n(buy)} Â· ë§¤ë„: ${n(sell)} Â· ì†ì ˆ: ${n(stop)} Â· ìœ„í—˜ë„: ${risk} Â·
      <span class="muted">ê²°ë¡ : ${verdict}</span>
    `;
  } else {
    out.textContent = "ê²€ìƒ‰ ì‹¤íŒ¨: HTTP 429";
  }
}
document.querySelector("#btnSearch").addEventListener("click", runSearch);
document.querySelector("#btnReset").addEventListener("click", ()=>{document.querySelector("#q").value="";document.querySelector("#searchResult").textContent="ì´ˆê¸°í™”ë¨";});
</script>
</body>
</html>
